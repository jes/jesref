<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.10" />
<title>Remap Extending G code</title>
<link rel="stylesheet" href="..//asciidoc.css" type="text/css" />


<link rel="stylesheet" href="..//linuxcnc.css" type="text/css" />
<script type="text/javascript" src="..//asciidoc.js"></script>
<script type="text/javascript">
/*<![CDATA[*/
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="book">
<div id="header">
<h1>Remap Extending G code</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="cha:remap">1. Introduction: Extending the RS274NGC Interpreter by Remapping Codes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_a_definition_remapping_codes">1.1. A Definition: Remapping Codes</h3>
<div class="paragraph"><p>By <em>remapping codes</em> we mean one of the following:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
define the semantics of new - that is, currently unallocated - M- or G-codes
</p>
</li>
<li>
<p>
redefine the semantics of a - currently limited - set of existing codes.
</p>
</li>
</ol></div>
</div>
<div class="sect2">
<h3 id="_why_would_you_want_to_extend_the_rs274ngc_interpreter">1.2. Why would you want to extend the RS274NGC Interpreter?</h3>
<div class="paragraph"><p>The set of codes (M,G,T,S,F) currently understood by the RS274NGC
interpreter is fixed and cannot be extended by configuration options.</p></div>
<div class="paragraph"><p>In particular, some of these codes implement a fixed sequence of steps
to be executed. While some of these, like M6, can be moderately
configured by activating or skipping some of these steps through ini
file options, overall the behavior is fairly rigid. So - if your
are happy with this situation, then this manual section is not for you.</p></div>
<div class="paragraph"><p>In many cases, this means that supporting a non <em>out of the box</em>
configuration or machine is either cumbersome or impossible, or
requires resorting to changes at the <em>C/C+\+</em> language level. The latter
is unpopular for good reasons - changing internals requires in-depth
understanding of interpreter internals, and moreover brings its own
set of support issues. While it is conceivable that certain patches
might make their way into the main LinuxCNC distribution, the result of
this approach is a hodge-podge of special-case solutions.</p></div>
<div class="paragraph"><p>A good example for this deficiency is tool change support in LinuxCNC:
while random tool changers are well supported, it is next to impossible
to reasonably define a configuration for a manual-tool change machine
with, for example, an automatic tool length offset switch being
visited after a tool change, and offsets set accordingly. Also, while a
patch for a very specific rack tool changer exists, it has not found
its way back into the main code base.</p></div>
<div class="paragraph"><p>However, many of these things may be fixed by using an O-word
procedure instead of a built in code - whenever the - insufficient -
built in code is to be executed, call the O-word procedure
instead. While possible, it is cumbersome - it requires source-editing
of NGC programs, replacing all calls to the deficient code by a an
O-word procedure call.</p></div>
<div class="paragraph"><p>In it&#8217;s simplest form a remapped code isn&#8217;t much more than a
spontaneous call to an O-word procedure. This happens behind the scenes
- the procedure is visible at the configuration level, but not at the
NGC program level.</p></div>
<div class="paragraph"><p>Generally, the behavior of a remapped code may be defined in the following ways:</p></div>
<div class="ulist"><ul>
<li>
<p>
you define a O-word subroutine which implements the desired behavior
</p>
</li>
<li>
<p>
alternatively, you may employ a Python function which extends the interpreter&#8217;s behavior.
</p>
</li>
</ul></div>
<div class="paragraph"><div class="title">How to glue things together</div><p>M- and G-codes, and O-words subroutine calls have some fairly different syntax.</p></div>
<div class="paragraph"><p>O-word procedures, for example, take positional parameters
with a specific syntax like so:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">o&lt;test&gt; call</span></span> <span style="font-weight: bold"><span style="color: #000000">[</span></span><span style="color: #993399">1.234</span><span style="font-weight: bold"><span style="color: #000000">]</span></span> <span style="font-weight: bold"><span style="color: #000000">[</span></span><span style="color: #993399">4.65</span><span style="font-weight: bold"><span style="color: #000000">]</span></span></tt></pre></div></div>
<div class="paragraph"><p>whereas M- or G-codes typically take required or optional <em>word</em>
parameters. For instance, G76 (threading) requires the P,Z,I,J and K
words, and optionally takes the R,Q,H, E and L words.</p></div>
<div class="paragraph"><p>So it isn&#8217;t simply enough to say <em>whenever you encounter code X, please
call procedure Y</em> - at least some checking and conversion of parameters
needs to happen. This calls for some <em>glue code</em> between the new code,
and its corresponding NGC procedure to execute before passing control
to the NGC procedure.</p></div>
<div class="paragraph"><p>This glue code is impossible to write as an O-word procedure itself
since the RS274NGC language lacks the introspective capabilities and
access into interpreter internal data structures to achieve the
required effect. Doing the glue code in - again - <em>C/C+\+</em> would be an
inflexible and therefore unsatisfactory solution.</p></div>
<div class="paragraph"><div class="title">How Embedded Python fits in</div><p>To make a simple situation easy and a complex situation solvable, the
glue issue is addressed as follows:</p></div>
<div class="ulist"><ul>
<li>
<p>
for simple situations, a built-in glue procedure (<code>argspec</code>) covers most
common parameter passing requirements
</p>
</li>
<li>
<p>
for remapping T,M6,M61,S,F there is some standard Python glue which should
cover most situations, see <a href="remap.html#remap:standard-glue">Standard Glue</a>
</p>
</li>
<li>
<p>
for more complex situations, one can write your own Python glue to implement
new behavior.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Embedded Python functions in the Interpreter started out as glue code,
but turned out very useful well beyond that. Users familiar with
Python will likely find it easier to write remapped codes, glue,
O-word procedures etc in pure Python, without resorting to the
somewhat cumbersome RS274NGC language at all.</p></div>
<div class="paragraph"><div class="title">A Word on Embedded Python</div><p>Many people are familiar with <em>extending</em> the Python interpreter by
<em>C/C++</em> modules, and this is heavily used in LinuxCNC to access Task,
HAL and and Interpreter internals from Python scripts. <em>Extending
Python</em> basically means: your Python script executes as <em>it is in the
driver seat</em>, and may access non-Python code by importing and using
extension modules written in <em>C/C+\+</em>. Examples for this are the LinuxCNC
<code>hal</code>, <code>gcode</code> and <code>emc</code> modules.</p></div>
<div class="paragraph"><p>Embedded Python is a bit different and and less commonly known: The
main program is written in C/C++ and may use Python like a
subroutine. This is powerful extension mechanism and the basis for the
<em>scripting extensions</em> found in many successful software
packages. Embedded Python code may access <em>C/C+\+</em> variables and
functions through a similar extension module method.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="remap:getting-started">2. Getting started</h2>
<div class="sectionbody">
<div class="paragraph"><p>Defining a code involves the following steps:</p></div>
<div class="ulist"><ul>
<li>
<p>
pick a code - either use an unallocated code, or redefine an existing code
</p>
</li>
<li>
<p>
deciding how parameters are handled
</p>
</li>
<li>
<p>
decide if and how results are handled
</p>
</li>
<li>
<p>
decide about the execution sequencing.
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="_builtin_remaps">2.1. Builtin Remaps</h3>
<div class="paragraph"><p>There are currently two complete python-only remaps that are available in stdglue.py.<br /></p></div>
<div class="ulist"><ul>
<li>
<p>
ignore_m6
</p>
</li>
<li>
<p>
index_lathe_tool_with_wear
</p>
</li>
</ul></div>
<div class="paragraph"><p>These are meant for use with lathe.<br />
lathes don&#8217;t use M6 to index the tools, they use the T command.<br />
This remap also adds wear offsets to the tool offset.<br />
ie. T201 would index to tool 2 (with tool 2&#8217;s tool offset) and adds wear offset 1.<br />
In the tool table, tools numbers above 10000 are wear offsets.<br />
ie in the tool table, tool 10001 would be wear offset 1.<br /></p></div>
<div class="paragraph"><p>Here is what you need in the INI to use them:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">[RS274NGC]</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">REMAP</span></span><span style="font-weight: bold"><span style="color: #000000">=</span></span><span style="color: #009900">T python=index_lathe_tool_with_wear</span>
<span style="font-weight: bold"><span style="color: #0000FF">REMAP</span></span><span style="font-weight: bold"><span style="color: #000000">=</span></span><span style="color: #009900">M6 python=ignore_m6</span>

<span style="font-weight: bold"><span style="color: #000000">[PYTHON]</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># where to find the Python code:</span></span>

<span style="font-style: italic"><span style="color: #9A1900"># code specific for this configuration</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">PATH_PREPEND</span></span><span style="font-weight: bold"><span style="color: #000000">=</span></span><span style="color: #009900">./</span>

<span style="font-style: italic"><span style="color: #9A1900"># generic support code - make sure this actually points to python-stdglue</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">PATH_APPEND</span></span><span style="font-weight: bold"><span style="color: #000000">=</span></span><span style="color: #009900">../../nc_files/remap_lib/python-stdglue/</span>

<span style="font-style: italic"><span style="color: #9A1900"># import the following Python module</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">TOPLEVEL</span></span><span style="font-weight: bold"><span style="color: #000000">=</span></span><span style="color: #009900">toplevel.py</span>

<span style="font-style: italic"><span style="color: #9A1900"># the higher the more verbose tracing of the Python plugin</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">LOG_LEVEL </span></span><span style="font-weight: bold"><span style="color: #000000">=</span></span><span style="color: #009900"> 0</span></tt></pre></div></div>
<div class="paragraph"><p>You must also add the required python file in your configuration folder.<br /></p></div>
<div class="paragraph"><p><a href="remap.html#remap:upgrading-an-existing">Upgrade an existing configuration</a></p></div>
</div>
<div class="sect2">
<h3 id="_picking_a_code">2.2. Picking a code</h3>
<div class="paragraph"><p>Note that currently only a few existing codes may be redefined,
whereas there are many <em>free</em> codes which might be made available by
remapping. When developing a redefined existing code, it might be a
good idea to start with an unallocated G- or M-code so both the
existing and new behavior can be exercised. When done, redefine the
existing code to use your remapping setup.</p></div>
<div class="ulist"><ul>
<li>
<p>
the current set of unused M-codes open to user definition can be found
<a href="remap.html#remap:unallocated-m-codes">here</a>,
</p>
</li>
<li>
<p>
unallocated G-codes are listed <a href="remap.html#remap:unallocated-g-codes">here</a>.
</p>
</li>
<li>
<p>
Existing codes which may be remapped are listed <a href="remap.html#remap:remappable-codes">here</a>.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="remap:parameter-handling">2.3. Parameter handling</h3>
<div class="paragraph"><p>Let&#8217;s assume the new code will be defined by an NGC procedure, and needs
some parameters, some of which might be required, others might be
optional. We have the following options to feed values to the
procedure:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
extracting words from the current block  and pass them to the
  procedure as parameters (like <code>X22.34</code> or <code>P47</code>)
</p>
</li>
<li>
<p>
referring to <a href="../gcode/overview.html#gcode:ini-hal-params">ini file variables</a>
</p>
</li>
<li>
<p>
referring to global variables (like <code>#2200 = 47.11</code> or
   <code>#&lt;_global_param&gt; = 315.2</code>
</p>
</li>
</ol></div>
<div class="paragraph"><p>The first method is preferred for parameters of dynamic nature, , like
positions. You need to define which words on the current block have
any meaning for your new code, and specify how that is passed to the
NGC procedure. Any easy way is to use the
<a href="remap.html#_the_argspec_parameter">argspec statement</a>. A custom prolog might
provide better error messages.</p></div>
<div class="paragraph"><p>Using to ini file variables is most useful for referring to setup
information for your machine, for instance a fixed position like a
tool-length sensor position. The advantage of this method is that the
parameters are fixed for your configuration regardless which NGC file
you&#8217;re currently executing.</p></div>
<div class="paragraph"><p>Referring to global variables is always possible, but they are easily
overlooked.</p></div>
<div class="paragraph"><p>Note there&#8217;s a limited supply of words which may be used as
parameters, so one might need to fall back to the second and third
methods if many parameters are needed.</p></div>
</div>
<div class="sect2">
<h3 id="remap:handling-results">2.4. Handling results</h3>
<div class="paragraph"><p>Your new code might succeed or fail, for instance if passed an invalid
parameter combination. Or you might choose to <em>just execute</em> the
procedure and disregard results, in which case there isn&#8217;t much work to do.</p></div>
<div class="paragraph"><p>Epilog handlers help in processing results of remap procedures - see
the reference section.</p></div>
</div>
<div class="sect2">
<h3 id="remap:execution-sequencing">2.5. Execution sequencing</h3>
<div class="paragraph"><p>Executable G-code words are classified into <a href="../gcode/overview.html#gcode:modal-groups">modal groups</a>, which also defines their relative execution behavior.</p></div>
<div class="paragraph"><p>If a  G-code block  contains several executable words on a line, these
words are executed in a predefined <a href="../gcode/overview.html#gcode:order-of-execution">order of execution</a>, not in the order they appear in block.</p></div>
<div class="paragraph"><p>When you define a new executable code, the interpreter does not yet
know where your code fits into this scheme. For this
reason, you need to choose an appropriate modal group for your code to
execute in.</p></div>
</div>
<div class="sect2">
<h3 id="_an_minimal_example_remapped_code">2.6. An minimal example remapped code</h3>
<div class="paragraph"><p>To give you an idea how the pieces fit together, let&#8217;s explore a
fairly minimal but complete remapped code definition. We choose an
unallocated M-code and add the following option to the ini file:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">[RS274NGC]</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">REMAP</span></span><span style="font-weight: bold"><span style="color: #000000">=</span></span><span style="color: #009900">M400  modalgroup=10 argspec=Pq ngc=myprocedure</span></tt></pre></div></div>
<div class="paragraph"><p>In a nutshell, this means:</p></div>
<div class="ulist"><ul>
<li>
<p>
The <code>M400</code> code takes a required parameter <code>P</code> and an optional
  parameter <code>Q</code>. Other words in the current block are ignored with
  respect to the <code>M400</code> code. If the <code>P</code> word is not present, fail
  execution with an error.
</p>
</li>
<li>
<p>
when an <code>M400</code> code is encountered, execute <code>myprocedure.ngc</code>  along
the other <a href="../gcode/overview.html#gcode:modal-groups">modal group</a> 10 M-codes as per
<a href="../gcode/overview.html#gcode:order-of-execution">order of execution</a>.
</p>
</li>
<li>
<p>
the value of <code>P</code>, and <code>Q</code> are available in the procedure as local
   named parameters. The may be referred to  as <code>#&lt;P&gt;</code> and <code>#&lt;Q&gt;</code>. The
   procedure may test whether the <code>Q</code> word was present with the
   <a href="../gcode/overview.html#gcode:functions"><code>EXISTS</code></a> built in function.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The file <code>myprocedure.ngc</code> is expected to exists in the <code>[DISPLAY]NC_FILES</code> or
<code>[RS274NGC]SUBROUTINE_PATH</code> directory.</p></div>
<div class="paragraph"><p>A detailed discussion of REMAP parameters is found in the reference
section below.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_remapping">3. Configuring Remapping</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_remap_statement">3.1. The REMAP statement</h3>
<div class="paragraph"><p>To remap a code, define it using the <code>REMAP</code> option in
<code>RS274NG</code> section of your ini file. Use one <code>REMAP</code> line per remapped code.</p></div>
<div class="paragraph"><p>The syntax of the <code>REMAP</code> is:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>REMAP=</code><em>&lt;code&gt;</em> <em>&lt;options&gt;</em>
</dt>
<dd>
<p>
    where <em>&lt;code&gt;</em> may be one of <code>T</code>,<code>M6</code>,<code>M61</code>,<code>S</code>,<code>F</code> (existing codes) or any of the
    unallocated <a href="remap.html#remap:unallocated-m-codes">M-codes</a> or <a href="remap.html#remap:unallocated-g-codes">G-codes</a>.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>It is an error to omit the <em>&lt;code&gt;</em> parameter.</p></div>
<div class="paragraph"><p>The options of the REMAP statement are separated by whitespace. The options are
keyword-value pairs and currently are:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>modalgroup=</code><em>&lt;modal group&gt;</em>
</dt>
<dd>
<div class="dlist"><dl>
<dt class="hdlist1">
G-codes
</dt>
<dd>
<p>
the only currently supported modal group is 1, which
        is also the default value if no group is given. Group 1 means
        <em>execute alongside other G-codes</em>.
</p>
</dd>
<dt class="hdlist1">
M-codes
</dt>
<dd>
<p>
currently supported modal groups are:
        5,6,7,8,9,10. If no modalgroup is give, it defaults to 10
        (<em>execute after all other words in the block</em>).
</p>
</dd>
<dt class="hdlist1">
T,S,F
</dt>
<dd>
<p>
for these the modal group is fixed and any
  <code>modalgroup=</code> option is ignored.
</p>
</dd>
</dl></div>
</dd>
<dt class="hdlist1">
<code>argspec=</code><em>&lt;argspec&gt;</em>
</dt>
<dd>
<p>
  See <a href="remap.html#_the_argspec_parameter">description of the argspec   parameter options</a>. Optional.
</p>
</dd>
<dt class="hdlist1">
<code>ngc=</code><em>&lt;ngc_basename&gt;</em>
</dt>
<dd>
<p>
   Basename of an O-word subroutine file name. Do not specify an
   .ngc extension. Searched for in the directories specified in
   the directory specified in <code>[DISPLAY]PROGRAM_PREFIX</code>, then in
   <code>[RS274NGC]SUBROUTINE_PATH</code>. Mutually exclusive with
   <code>python=</code>. It is an error to omit both <code>ngc=</code> and  <code>python=</code>.
</p>
</dd>
<dt class="hdlist1">
<code>python=</code><em>&lt;Python function name&gt;</em>
</dt>
<dd>
<p>
  Instead of calling an ngc O-word procedure call a Python
  function. The function is expected to be defined in the
  <code>module_basename.oword</code>
  module. Mutually exclusive with <code>ngc=</code>.
</p>
</dd>
<dt class="hdlist1">
<code>prolog=</code><em>&lt;Python function name&gt;</em>
</dt>
<dd>
<p>
  Before executing an ngc procedure, call this Python function.
  The function is expected to be defined in the
  <code>module_basename.remap</code>
  module. Optional.
</p>
</dd>
<dt class="hdlist1">
<code>epilog=</code><em>&lt;Python function name&gt;</em>
</dt>
<dd>
<p>
  After executing an ngc procedure, call this Python function.
  The function is expected to be defined in the
  <code>module_basename.remap</code>
  module. Optional.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>The <code>python</code>, <code>prolog</code> and <code>epilog</code> options require the Python
Interpreter plugin to be <a href="remap.html#remap:embedded-python">configured</a>, and
appropriate Python functions to be defined there so they can be
referred to with these options.</p></div>
<div class="paragraph"><p>The syntax for defining a new code, and redefining an existing code is
identical.</p></div>
</div>
<div class="sect2">
<h3 id="_useful_remap_option_combinations">3.2. Useful REMAP option combinations</h3>
<div class="paragraph"><p>Note that while many combinations of argspec options are possible, not
all of them make sense. The following combinations are useful idioms:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>argspec=</code><em>&lt;words&gt;</em> <code>ngc=</code><em>&lt;procname&gt;</em> <code>modalgroup=</code><em>&lt;group&gt;</em>
</dt>
<dd>
<p>
    The recommended way to call an NGC procedure with a standard argspec parameter
    conversion. Used if argspec is good enough. Note it&#8217;s not good
    enough for remapping the Tx and M6/M61 tool change codes.
</p>
</dd>
<dt class="hdlist1">
<code>prolog=</code><em>&lt;pythonprolog&gt;</em> <code>ngc=</code><em>&lt;procname&gt;</em> <code>epilog=</code><em>&lt;pythonepilog&gt;</em> <code>modalgroup=</code><em>&lt;group&gt;</em>
</dt>
<dd>
<p>
    Call a Python prolog function to take any preliminary steps, then call the NGC
    procedure. When done, call the Python epilog function to do any
    cleanup or result extraction work which cannot be handled in G-code.
    The most flexible way of remapping a code to an NGC procedure,
    since almost all of the Interpreter internal variables, and some
    internal functions may be accessed from the prolog and epilog
    handlers. Also, a longer rope to hang yourselves.
</p>
</dd>
<dt class="hdlist1">
<code>python=</code><em>&lt;pythonfunction&gt;</em> <code>modalgroup=</code><em>&lt;group&gt;</em>
</dt>
<dd>
<p>
    Directly call to a Python function without any argument conversion.
    The most powerful way of remapping a code and going straight to
    Python. Use this if you don&#8217;t need an NGC procedure, or NGC is
    just getting in your way.
</p>
</dd>
<dt class="hdlist1">
<code>argspec=</code><em>&lt;words&gt;</em> <code>python=</code><em>&lt;pythonfunction&gt;</em> <code>modalgroup=</code><em>&lt;group&gt;</em>
</dt>
<dd>
<p>
    Convert the argspec words and pass them to a Python function as
    keyword argument dictionary. Use it when you&#8217;re too lazy to
    investigate words passed on the block yourself.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Note that if all you want to achieve is to call some Python code from
G-code, there is the somewhat easier way of
<a href="#remap:python-o-word-procs">calling Python functions like O-word procedures</a>.</p></div>
</div>
<div class="sect2">
<h3 id="_the_argspec_parameter">3.3. The argspec parameter</h3>
<div class="paragraph"><p>The argument specification (keyword <code>argspec</code>) describes required and
optional words to be passed to an ngc procedure, as well as optional
preconditions for that code to execute.</p></div>
<div class="paragraph"><p>An argspec consists of 0 or more  characters of the class
 <code>[@A-KMNP-Za-kmnp-z^&gt;]</code> . It can by empty (like <code>argspec=</code>).</p></div>
<div class="paragraph"><p>An empty argspec, or no argspec argument at all implies the remapped
code does not receive  any parameters from the block. It will ignore
any extra parameters present.</p></div>
<div class="paragraph"><p>Note that RS274NGC rules still apply - for instance you may use axis
words (eg X,Y,Z) only in the context of a G-code.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>ABCDEFGHIJKMPQRSTUVWXYZ</code>
</dt>
<dd>
<p>
  Defines a required word parameter: an uppercase letter specifies that
  the corresponding word <strong>must</strong>
  be present in the current block. The word`s value will be
  passed as a local named parameter with a corresponding name.
  If the <code>@</code> character is
  present in the argspec, it will be passed as positional
  parameter, see below.
</p>
</dd>
<dt class="hdlist1">
<code>abcdefghijkmpqrstuvwxyz</code>
</dt>
<dd>
<p>
  Defines an optional word parameter: a lowercase letter specifies that
  the corresponding word <strong>may</strong> be present in the current block.
  If the word is present, the word&#8217;s value will be
  passed as a local named parameter. If the <code>@</code> character is
  present in the argspec, it will be passed as positional
  parameter, see below.
</p>
</dd>
<dt class="hdlist1">
<code>@</code>
</dt>
<dd>
<p>
  The <code>@</code> (at-sign) tells argspec to pass words as positional
  parameters, in the order defined following the <code>@</code>
  option. Note that when using positional parameter passing,
  a procedure cannot tell whether a word was present or not, see
  example below.
</p>
</dd>
</dl></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">this helps with packaging existing NGC procedures as remapped
codes. Existing procedures do expect positional parameters. With the
<code>@</code> option, you can avoid rewriting them to refer to local named
parameters.</td>
</tr></table>
</div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>^</code>
</dt>
<dd>
<p>
  The <code>^</code> (caret) character specifies that the current
  spindle speed must be greater than zero (spindle running),
  otherwise the code fails with an appropriate error message.
</p>
</dd>
<dt class="hdlist1">
<code>&gt;</code>
</dt>
<dd>
<p>
  The <code>&gt;</code> (greater-than) character specifies that the current
  feed must be greater than zero, otherwise the code fails with
  an appropriate error message.
</p>
</dd>
<dt class="hdlist1">
<code>n</code>
</dt>
<dd>
<p>
  The <code>n</code> (greater-than) character specifies to pass the current
  line number in the `n`local named parameter.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>By default, parameters are passed  as local named parameter to an NGC
procedure. These local parameters appear as <em>already set</em> when the
procedure starts executing, which is different from existing semantics
(local variables start out with value 0.0 and need to be explicitly
assigned a value).</p></div>
<div class="paragraph"><p>Optional word parameters may be tested for presence by the <code>EXISTS(#&lt;word&gt;)</code> idiom.</p></div>
<div class="paragraph"><div class="title">Example for named parameter passing to NGC procedures</div><p>Assume the code is defined as</p></div>
<div class="paragraph"><p><code>REMAP=M400  modalgroup=10 argspec=Pq ngc=m400</code></p></div>
<div class="paragraph"><p>and <code>m400.ngc</code> looks as follows:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">o&lt;m400&gt; sub</span></span>
<span style="font-style: italic"><span style="color: #9A1900">(P is required since it's uppercase in the argspec)</span></span>
<span style="font-style: italic"><span style="color: #9A1900">(debug, P word=</span></span><span style="color: #009900">#&lt;P&gt;</span><span style="font-style: italic"><span style="color: #9A1900">)</span></span>
<span style="font-style: italic"><span style="color: #9A1900">(the q argspec is optional since its lowercase in the argspec. Use as follows:)</span></span>
<span style="font-weight: bold"><span style="color: #000080">o100 if</span></span> <span style="font-weight: bold"><span style="color: #000000">[EXISTS[</span></span><span style="color: #009900">#&lt;q&gt;</span><span style="font-weight: bold"><span style="color: #000000">]]</span></span>
    <span style="font-style: italic"><span style="color: #9A1900">(debug, Q word set: </span></span><span style="color: #009900">#&lt;q&gt;</span><span style="font-style: italic"><span style="color: #9A1900">)</span></span>
<span style="font-weight: bold"><span style="color: #000080">o100 endif</span></span>
<span style="font-weight: bold"><span style="color: #000080">o&lt;m400&gt; endsub</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">M2</span></span></tt></pre></div></div>
<div class="ulist"><ul>
<li>
<p>
executing <code>M400</code> will fail with the message
  <code>user-defined M400: missing: P</code>
</p>
</li>
<li>
<p>
executing <code>M400 P123</code> will display <code>P word=123.000000</code>
</p>
</li>
<li>
<p>
executing <code>M400 P123 Q456</code> will display <code>P word=123.000000</code> and <code>Q word set: 456.000000</code>
</p>
</li>
</ul></div>
<div class="paragraph"><div class="title">Example for positional parameter passing to NGC procedures</div><p>Assume the code is defined as</p></div>
<div class="paragraph"><p><code>REMAP=M410  modalgroup=10 argspec=@PQr ngc=m410</code></p></div>
<div class="paragraph"><p>and <code>m410.ngc</code> looks as follows:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">o&lt;m410&gt; sub</span></span>
<span style="font-style: italic"><span style="color: #9A1900">(debug, [1]=</span></span><span style="color: #009900">#1</span><span style="font-style: italic"><span style="color: #9A1900"> [2]=</span></span><span style="color: #009900">#2</span><span style="font-style: italic"><span style="color: #9A1900"> [3]=</span></span><span style="color: #009900">#3</span><span style="font-style: italic"><span style="color: #9A1900">)</span></span>
<span style="font-weight: bold"><span style="color: #000080">o&lt;m410&gt; endsub</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">M2</span></span></tt></pre></div></div>
<div class="ulist"><ul>
<li>
<p>
executing <code>M410 P10</code> will display <code>m410.ngc: [1]=10.000000 [2]=0.000000</code>
</p>
</li>
<li>
<p>
executing <code>M410 P10 Q20</code> will display <code>m410.ngc: [1]=10.000000 [2]=20.000000</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>NB: you lose the capability to distinguish more than one optional
parameter word, and you cannot tell whether an optional parameter was
present but had the value 0, or was not present at all.</p></div>
<div class="paragraph"><div class="title">Simple example for named parameter passing to a Python function</div><p>It&#8217;s possible to define new codes <em>without</em> any NGC procedure. Here&#8217;s
a simple first example, a more complex one can be found in the next
section.</p></div>
<div class="paragraph"><p>Assume the code is defined as</p></div>
<div class="paragraph"><p><code>REMAP=G88.6 modalgroup=1  argspec=XYZp  python=g886</code></p></div>
<div class="paragraph"><p>This instructs the interpreter to execute the Python function <code>g886</code>
in the <code>module_basename.remap</code> module
which might look like so:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">from</span></span> interpreter <span style="font-weight: bold"><span style="color: #000080">import</span></span> INTERP_OK
<span style="font-weight: bold"><span style="color: #000080">from</span></span> emccanon <span style="font-weight: bold"><span style="color: #000080">import</span></span> MESSAGE

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">g886</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #990000">**</span>words<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> key <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> words<span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #000000">MESSAGE</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"word '%s' = %f"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>key<span style="color: #990000">,</span> words<span style="color: #990000">[</span>key<span style="color: #990000">]))</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> words<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">has_key</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'p'</span><span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #000000">MESSAGE</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"the P word was present"</span><span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #000000">MESSAGE</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"comment on this line: '%s'"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>self<span style="color: #990000">.</span>blocks<span style="color: #990000">[</span>self<span style="color: #990000">.</span>remap_level<span style="color: #990000">].</span>comment<span style="color: #990000">))</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> INTERP_OK</tt></pre></div></div>
<div class="paragraph"><p>Try this with out with:
  g88.6 x1 y2 z3
  g88.6 x1 y2 z3 p33 (a comment here)</p></div>
<div class="paragraph"><p>You&#8217;ll notice the gradual introduction of the embedded Python
environment - see <a href="remap.html#remap:programming-embedded-python">here</a> for details.  Note that
with Python remapping functions, it make no sense to have Python
prolog or epilog functions since it&#8217;s executing a Python function in
the first place.</p></div>
<div class="paragraph"><div class="title">Advanced example: Remapped codes in pure Python</div><p>The <code>interpreter</code> and <code>emccanon</code> modules expose most of the Interpreter
and some Canon internals, so many things which  so far required coding in
<em>C/C+\+</em> can be now be done in Python.</p></div>
<div class="paragraph"><p>The following example is based on the <code>nc_files/involute.py</code> script -
but canned as a G-code with some parameter extraction and checking. It
also demonstrates calling the interpreter recursively (see <code>self.execute()</code>).</p></div>
<div class="paragraph"><p>Assuming a definition like so (NB: this does not use argspec):</p></div>
<div class="paragraph"><p><code>REMAP=G88.1 modalgroup=1  py=involute</code></p></div>
<div class="paragraph"><p>The <code>involute</code> function in <code>python/remap.py</code> listed below does all
word extraction from the current block directly. Note that interpreter
errors can be translated to Python exceptions. Remember this is
<em>readahead time</em> - execution time errors cannot be trapped this way.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> sys
<span style="font-weight: bold"><span style="color: #000080">import</span></span> traceback
<span style="font-weight: bold"><span style="color: #000080">from</span></span> math <span style="font-weight: bold"><span style="color: #000080">import</span></span> sin<span style="color: #990000">,</span>cos

<span style="font-weight: bold"><span style="color: #000080">from</span></span> interpreter <span style="font-weight: bold"><span style="color: #000080">import</span></span> <span style="color: #990000">*</span>
<span style="font-weight: bold"><span style="color: #000080">from</span></span> emccanon <span style="font-weight: bold"><span style="color: #000080">import</span></span> MESSAGE
<span style="font-weight: bold"><span style="color: #000080">from</span></span> util <span style="font-weight: bold"><span style="color: #000080">import</span></span> lineno<span style="color: #990000">,</span> call_pydevd
<span style="font-style: italic"><span style="color: #9A1900"># raises InterpreterException if execute() or read() fails</span></span>
throw_exceptions <span style="color: #990000">=</span> <span style="color: #993399">1</span>

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">involute</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #990000">**</span>words<span style="color: #990000">):</span>
<span style="font-style: italic"><span style="color: #9A1900">    """ remap function with raw access to Interpreter internals """</span></span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>debugmask <span style="color: #990000">&amp;</span> <span style="color: #993399">0x20000000</span><span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #000000">call_pydevd</span></span><span style="color: #990000">()</span> <span style="font-style: italic"><span style="color: #9A1900"># USER2 debug flag</span></span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #000000">equal</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>feed_rate<span style="color: #990000">,</span><span style="color: #993399">0.0</span><span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"feedrate &gt; 0 required"</span>

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #000000">equal</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>speed<span style="color: #990000">,</span><span style="color: #993399">0.0</span><span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"spindle speed &gt; 0 required"</span>

    plunge <span style="color: #990000">=</span> <span style="color: #993399">0.1</span> <span style="font-style: italic"><span style="color: #9A1900"># if Z word was given, plunge - with reduced feed</span></span>

    <span style="font-style: italic"><span style="color: #9A1900"># inspect controlling block for relevant words</span></span>
    c <span style="color: #990000">=</span> self<span style="color: #990000">.</span>blocks<span style="color: #990000">[</span>self<span style="color: #990000">.</span>remap_level<span style="color: #990000">]</span>
    x0 <span style="color: #990000">=</span> c<span style="color: #990000">.</span>x_number <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> c<span style="color: #990000">.</span>x_flag <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #993399">0</span>
    y0 <span style="color: #990000">=</span> c<span style="color: #990000">.</span>y_number <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> c<span style="color: #990000">.</span>y_flag <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #993399">0</span>
    a  <span style="color: #990000">=</span> c<span style="color: #990000">.</span>p_number <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> c<span style="color: #990000">.</span>p_flag <span style="font-weight: bold"><span style="color: #0000FF">else</span></span> <span style="color: #993399">10</span>
    old_z <span style="color: #990000">=</span> self<span style="color: #990000">.</span>current_z

    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>debugmask <span style="color: #990000">&amp;</span> <span style="color: #993399">0x10000000</span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"x0=%f y0=%f a=%f old_z=%f"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>x0<span style="color: #990000">,</span>y0<span style="color: #990000">,</span>a<span style="color: #990000">,</span>old_z<span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
        <span style="font-style: italic"><span style="color: #9A1900">#self.execute("G3456")  # would raise InterpreterException</span></span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">execute</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"G21"</span><span style="color: #990000">,</span><span style="font-weight: bold"><span style="color: #000000">lineno</span></span><span style="color: #990000">())</span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">execute</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"G64 P0.001"</span><span style="color: #990000">,</span><span style="font-weight: bold"><span style="color: #000000">lineno</span></span><span style="color: #990000">())</span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">execute</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"G0 X%f Y%f"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>x0<span style="color: #990000">,</span>y0<span style="color: #990000">),</span><span style="font-weight: bold"><span style="color: #000000">lineno</span></span><span style="color: #990000">())</span>

        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> c<span style="color: #990000">.</span>z_flag<span style="color: #990000">:</span>
            feed <span style="color: #990000">=</span> self<span style="color: #990000">.</span>feed_rate
            self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">execute</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"F%f G1 Z%f"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>feed <span style="color: #990000">*</span> plunge<span style="color: #990000">,</span> c<span style="color: #990000">.</span>z_number<span style="color: #990000">),</span><span style="font-weight: bold"><span style="color: #000000">lineno</span></span><span style="color: #990000">())</span>
            self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">execute</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"F%f"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>feed<span style="color: #990000">),</span><span style="font-weight: bold"><span style="color: #000000">lineno</span></span><span style="color: #990000">())</span>

        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> i <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="font-weight: bold"><span style="color: #000000">range</span></span><span style="color: #990000">(</span><span style="color: #993399">100</span><span style="color: #990000">):</span>
            t <span style="color: #990000">=</span> i<span style="color: #990000">/</span><span style="color: #993399">10</span><span style="color: #990000">.</span>
            x <span style="color: #990000">=</span> x0 <span style="color: #990000">+</span> a <span style="color: #990000">*</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">cos</span></span><span style="color: #990000">(</span>t<span style="color: #990000">)</span> <span style="color: #990000">+</span> t <span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">sin</span></span><span style="color: #990000">(</span>t<span style="color: #990000">))</span>
            y <span style="color: #990000">=</span> y0 <span style="color: #990000">+</span> a <span style="color: #990000">*</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">sin</span></span><span style="color: #990000">(</span>t<span style="color: #990000">)</span> <span style="color: #990000">-</span> t <span style="color: #990000">*</span> <span style="font-weight: bold"><span style="color: #000000">cos</span></span><span style="color: #990000">(</span>t<span style="color: #990000">))</span>
            self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">execute</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"G1 X%f Y%f"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>x<span style="color: #990000">,</span>y<span style="color: #990000">),</span><span style="font-weight: bold"><span style="color: #000000">lineno</span></span><span style="color: #990000">())</span>

        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> c<span style="color: #990000">.</span>z_flag<span style="color: #990000">:</span> <span style="font-style: italic"><span style="color: #9A1900"># retract to starting height</span></span>
            self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">execute</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"G0 Z%f"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>old_z<span style="color: #990000">),</span><span style="font-weight: bold"><span style="color: #000000">lineno</span></span><span style="color: #990000">())</span>

    <span style="font-weight: bold"><span style="color: #0000FF">except</span></span> InterpreterException<span style="color: #990000">,</span>e<span style="color: #990000">:</span>
        msg <span style="color: #990000">=</span> <span style="color: #FF0000">"%d: '%s' - %s"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>e<span style="color: #990000">.</span>line_number<span style="color: #990000">,</span>e<span style="color: #990000">.</span>line_text<span style="color: #990000">,</span> e<span style="color: #990000">.</span>error_message<span style="color: #990000">)</span>
  <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> msg

    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> INTERP_OK</tt></pre></div></div>
<div class="paragraph"><p>The examples described so far can be found in
<em>configs/sim/axis/remap/getting-started</em> with complete working
configurations.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="remap:upgrading-an-existing">4. Upgrading an existing configuration for remapping</h2>
<div class="sectionbody">
<div class="paragraph"><p>The minimal prerequisites for using <code>REMAP</code> statements are as follows:</p></div>
<div class="ulist"><ul>
<li>
<p>
the Python plug in must be activated by specifying a
 <code>[PYTHON]TOPLEVEL=&lt;path-to-toplevel-script&gt;</code> in the ini file.
</p>
</li>
<li>
<p>
the toplevel script needs to import the <code>remap</code> module, which can be
 initially empty, but the import needs to be in place.
</p>
</li>
<li>
<p>
The Python interpreter needs to find the remap.py module above, so
 the path to the directory where your Python modules live needs to be
 added with  <code>[PYTHON]PATH_APPEND=&lt;path-to-your-local-Python-directory&gt;</code>
</p>
</li>
<li>
<p>
Recommended: import the <code>stdglue</code> handlers in the <code>remap</code> module. In
 this case Python also needs to find <code>stdglue.py</code> - we just copy it
 from the distribution so you can make local changes as
 needed. Depending on your installation the path to <code>stdglue.py</code> might
 vary.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Assuming your configuration lives under <code>/home/user/xxx</code> and the ini
file is <code>/home/user/xxx/xxx.ini</code>, execute the following commands.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ cd /home/user/xxx
$ mkdir python
$ cd python
$ cp /usr/share/linuxcnc/ncfiles/remap_lib/python-stdglue/stdglue<span style="color: #990000">.</span>py <span style="color: #990000">.</span>
$ echo <span style="color: #FF0000">'from stdglue import *'</span> <span style="color: #990000">&gt;</span>remap<span style="color: #990000">.</span>py
$ echo <span style="color: #FF0000">'import remap'</span> <span style="color: #990000">&gt;</span>toplevel<span style="color: #990000">.</span>py</tt></pre></div></div>
<div class="paragraph"><p>Now edit <code>/home/user/xxx/xxx.ini</code> and add the following:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">[PYTHON]</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">TOPLEVEL</span></span><span style="font-weight: bold"><span style="color: #000000">=</span></span><span style="color: #009900">/home/user/xxx/python/toplevel.py</span>
<span style="font-weight: bold"><span style="color: #0000FF">PATH_APPEND</span></span><span style="font-weight: bold"><span style="color: #000000">=</span></span><span style="color: #009900">/home/user/xxx/python</span></tt></pre></div></div>
<div class="paragraph"><p>Now verify that LinuxCNC comes up with no error messages - from a
terminal window execute:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>$ cd /home/user/xxx
$ linuxcnc xxx<span style="color: #990000">.</span>ini</tt></pre></div></div>
</div>
</div>
<div class="sect1">
<h2 id="_remapping_tool_change_related_codes_t_m6_m61">5. Remapping tool change-related codes: T, M6, M61</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview">5.1. Overview</h3>
<div class="paragraph"><p>If you are unfamiliar with LinuxCNC internals, first read the
<a href="remap.html#remap:how-tool-change-currently-works">How tool change currently works</a> section (dire but necessary).</p></div>
<div class="paragraph"><p>Note than when remapping an existing code, we completely disable
<a href="#remap:interpreter-action-on-m6">this codes' built in functionality</a>
of the interpreter.</p></div>
<div class="paragraph"><p>So our remapped code will need to do a bit more
than just generating some commands to move the machine as we like - it
will also need to replicate those steps from this sequence which are
needed to keep the interpreter and task happy.</p></div>
<div class="paragraph"><p>However, this does <strong>not</strong> affect the processing of
tool change-related commands in task and iocontrol. This means when we
execute <a href="#remap:send-tool-load-msg">step 6b</a> this will still cause
<a href="#remap:iocontrol-action-on-load">iocontrol to do its thing</a>.</p></div>
<div class="paragraph"><p>Decisions, decisions:</p></div>
<div class="ulist"><ul>
<li>
<p>
Do we want to use an O-word procedure or do it all in Python code?
</p>
</li>
<li>
<p>
Is the iocontrol HAL sequence (tool-prepare/tool-prepared and
 tool-change/tool-changed pins) good enough or do we need a different kind
 of HAL interaction for our tool changer (for example: more HAL pins
 involved with a  different interaction sequence)?
</p>
</li>
</ul></div>
<div class="paragraph"><p>Depending on the answer, we have four different scenarios:</p></div>
<div class="ulist"><ul>
<li>
<p>
When using an O-word procedure, we need prolog and epilog functions
</p>
</li>
<li>
<p>
if using all Python code and no O-word procedure, a Python function
is enough
</p>
</li>
<li>
<p>
when using the iocontrol pins, our O-word procedure or Python code
will contain mostly moves
</p>
</li>
<li>
<p>
when we need a more complex interaction than offered by iocontrol,
we need to completely define our own interaction, using <code>motion.digital*</code> and
<code>motion.analog*</code> pins, and essentially ignore the iocontrol pins by
looping them.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">If you hate O-word procedures and love Python, you&#8217;re free to do it
all in Python, in which case you would just have a <code>python=&lt;function&gt;</code>
spec in the REMAP statement. But assuming most folks would be interested in
using O-word procedures because they are more familiar with that, we&#8217;ll do
that as the  first example.</td>
</tr></table>
</div>
<div class="paragraph"><p>So the overall approach for our first example will be:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
we&#8217;d like to do as much as possible with G-code in an O-word
procedure for flexibility. That includes all HAL interaction which
would normally be handled by iocontrol - because we rather would want to do
clever things with moves, probes, HAL pin I/O and so forth.
</p>
</li>
<li>
<p>
we&#8217;ll try to minimize Python code to the extent needed  to keep the interpreter happy,
and cause task to actually do anything. That will go into the
<code>prolog</code> and <code>epilog</code> Python functions.
</p>
</li>
</ol></div>
</div>
<div class="sect2">
<h3 id="_understanding_the_role_of_iocontrol_with_remapped_tool_change_codes">5.2. Understanding the role of iocontrol with remapped tool change codes</h3>
<div class="paragraph"><p>Iocontrol provides two HAL interaction sequences we might or might not
use:</p></div>
<div class="ulist"><ul>
<li>
<p>
when the NML message queued by a SELECT_POCKET() canon command is
executed, this triggers the "raise tool-prepare and wait for
tool-prepared to become high" HAL sequence in iocontrol, besides
setting the XXXX pins
</p>
</li>
<li>
<p>
when the NML message queued by the CHANGE_TOOL() canon command is
executed, this triggers the  "raise tool-change and wait for
tool-changed to become high" HAL sequence in iocontrol, besides
setting the XXXX pins
</p>
</li>
</ul></div>
<div class="paragraph"><p>What you need to decide is whether the existing iocontrol HAL sequences
are sufficient to drive your changer. Maybe you need a different
interaction sequence - for instance more HAL  pins, or maybe a more
complex interaction. Depending on the answer, we might continue to use the existing
iocontrol HAL sequences, or define our own ones.</p></div>
<div class="paragraph"><p>For the sake of documentation, we&#8217;ll disable these  iocontrol
sequences, and roll our own - the result will look and feel like the
existing interaction, but now we have complete control over them
because they are executed in our own O-word procedure.</p></div>
<div class="paragraph"><p>So what we&#8217;ll do is use some <code>motion.digital-*</code> and <code>motion.analog-*</code>
pins, and the associated <code>M62</code> .. <code>M68</code> commands to do our own HAL
interaction in our O-word procedure, and those will effectively
replace the iocontrol <em>tool-prepare/tool-prepared</em> and
<em>tool-change/tool-changed</em> sequences. So we&#8217;ll define our pins
replacing existing iocontrol pins functionally, and go ahead and make
the iocontrol interactions a loop. We&#8217;ll use the following
correspondence in our example:</p></div>
<div class="paragraph"><p>Iocontrol pin correspondence in the examples</p></div>
<div class="tableblock">
<table rules="none"
width="60%"
frame="hsides"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">iocontrol.0 pin  </th>
<th align="left" valign="top">motion pin</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">tool-prepare</p></td>
<td align="left" valign="top"><p class="table">digital-out-00</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">tool-prepared</p></td>
<td align="left" valign="top"><p class="table">digital-in-00</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">tool-change</p></td>
<td align="left" valign="top"><p class="table">digital-out-01</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">tool-changed</p></td>
<td align="left" valign="top"><p class="table">digital-in-01</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">tool-prep-number</p></td>
<td align="left" valign="top"><p class="table">analog-out-00</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">tool-prep-pocket</p></td>
<td align="left" valign="top"><p class="table">analog-out-01</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">tool-number</p></td>
<td align="left" valign="top"><p class="table">analog-out-02</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Let us assume you want to redefine the M6 command, and replace it by
an O-word procedure, but other than that things <em>should continue to
work</em>.</p></div>
<div class="paragraph"><p>So what our O-word procedure would do is to replace the steps
<a href="#remap:interpreter-action-on-m6">outlined here</a>. Looking through
these steps you&#8217;ll find that NGC code can be used for most of them,
but not all. So the stuff NGC cant handle will be done in Python prolog
and epilog functions.</p></div>
</div>
<div class="sect2">
<h3 id="_specifying_the_m6_replacement">5.3. Specifying the M6 replacement</h3>
<div class="paragraph"><p>To convey the idea, we just replace the built in M6 semantics with our
own. Once that works, you may go ahead and place any actions you see
fit into the O-word procedure.</p></div>
<div class="paragraph"><p>Going through the <a href="#remap:interpreter-action-on-m6">steps</a>, we find:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
check for T command already executed - <strong>execute in Python prolog</strong>
</p>
</li>
<li>
<p>
check for cutter compensation being active - <strong>execute in Python prolog</strong>
</p>
</li>
<li>
<p>
stop the spindle if needed - <strong>can be done in NGC</strong>
</p>
</li>
<li>
<p>
quill up - <strong>can be done in NGC</strong>
</p>
</li>
<li>
<p>
if TOOL_CHANGE_AT_G30 was set:
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
move the A, B and C indexers if applicable - <strong>can be done in NGC</strong>
</p>
</li>
<li>
<p>
generate rapid move to the G30 position - <strong>can be done in NGC</strong>
</p>
</li>
</ol></div>
</li>
<li>
<p>
send a CHANGE_TOOL Canon command to task  - <strong>execute in Python epilog</strong>
</p>
</li>
<li>
<p>
set the numberer parameters 5400-5413 according to the new tool - <strong>execute in Python epilog</strong>
</p>
</li>
<li>
<p>
signal to task to stop calling the interpreter for readahead until
tool change complete - <strong>execute in Python epilog</strong>
</p>
</li>
</ol></div>
<div class="paragraph"><p>So we need a prolog, and an epilog. Lets assume our ini file incantation of the M6 remap looks as follows:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>REMAP=M6   modalgroup=6  prolog=change_prolog ngc=change epilog=change_epilog</code></pre>
</div></div>
<div class="paragraph"><p>So the prolog covering steps 1 and 2 would look like so - we decide to
pass a few variables to the remap procedure which can be inspected and
changed there, or used in a message. Those are: <code>tool_in_spindle</code>,
<code>selected_tool</code> (tool numbers) and their respective pockets
<code>current_pocket</code> and <code>selected_pocket</code>:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">change_prolog</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #990000">**</span>words<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>selected_pocket <span style="color: #990000">&lt;</span> <span style="color: #993399">0</span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"M6: no tool prepared"</span>

        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>cutter_comp_side<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"Cannot change tools with cutter radius compensation on"</span>

        self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #FF0000">"tool_in_spindle"</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> self<span style="color: #990000">.</span>current_tool
        self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #FF0000">"selected_tool"</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> self<span style="color: #990000">.</span>selected_tool
        self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #FF0000">"current_pocket"</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> self<span style="color: #990000">.</span>current_pocket
        self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #FF0000">"selected_pocket"</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> self<span style="color: #990000">.</span>selected_pocket
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> INTERP_OK
    <span style="font-weight: bold"><span style="color: #0000FF">except</span></span> Exception<span style="color: #990000">,</span> e<span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"M6/change_prolog: %s"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>e<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>You will find that most prolog functions look very similar: first test
that all preconditions for executing the code hold, then prepare the
environment - inject variables and/or do any preparatory processing
steps which cannot easily be done in NGC code; then hand off to the
NGC procedure by returning INTERP_OK.</p></div>
<div class="paragraph"><p>Our first iteration of the O-word procedure is unexciting - just
verify we got parameters right, and signal success by returning a
positive value; steps 3-5 would eventually be covered here (see
<a href="../gcode/overview.html#gcode:ini-hal-params">here</a> for the variables referring
to ini file settings):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">O&lt;change&gt; sub</span></span>
<span style="font-style: italic"><span style="color: #9A1900">(debug, change: current_tool=</span></span><span style="color: #009900">#&lt;current_tool&gt;</span><span style="font-style: italic"><span style="color: #9A1900">)</span></span>
<span style="font-style: italic"><span style="color: #9A1900">(debug, change: selected_pocket=</span></span><span style="color: #009900">#&lt;selected_pocket&gt;</span><span style="font-style: italic"><span style="color: #9A1900">)</span></span>
<span style="font-style: italic"><span style="color: #9A1900">;</span></span>
<span style="font-style: italic"><span style="color: #9A1900">; insert any g-code which you see fit here, eg:</span></span>
<span style="font-style: italic"><span style="color: #9A1900">; G0  #&lt;_ini[setup]tc_x&gt;  #&lt;_ini[setup]tc_y&gt;  #&lt;_ini[setup]tc_z&gt;</span></span>
<span style="font-style: italic"><span style="color: #9A1900">;</span></span>
<span style="font-weight: bold"><span style="color: #000080">O&lt;change&gt; endsub</span></span> <span style="font-weight: bold"><span style="color: #000000">[</span></span><span style="color: #993399">1</span><span style="font-weight: bold"><span style="color: #000000">]</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">m2</span></span></tt></pre></div></div>
<div class="paragraph"><p>Assuming success of <code>change.ngc</code>, we need to mop up steps 6-8:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">change_epilog</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #990000">**</span>words<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>return_value <span style="color: #990000">&gt;</span> <span style="color: #993399">0.0</span><span style="color: #990000">:</span>
            <span style="font-style: italic"><span style="color: #9A1900"># commit change</span></span>
            self<span style="color: #990000">.</span>selected_pocket <span style="color: #990000">=</span>  <span style="font-weight: bold"><span style="color: #000000">int</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #FF0000">"selected_pocket"</span><span style="color: #990000">])</span>
            emccanon<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">CHANGE_TOOL</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>selected_pocket<span style="color: #990000">)</span>
            <span style="font-style: italic"><span style="color: #9A1900"># cause a sync()</span></span>
            self<span style="color: #990000">.</span>tool_change_flag <span style="color: #990000">=</span> True
            self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_tool_parameters</span></span><span style="color: #990000">()</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> INTERP_OK
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"M6 aborted (return code %.1f)"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>self<span style="color: #990000">.</span>return_value<span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">except</span></span> Exception<span style="color: #990000">,</span> e<span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"M6/change_epilog: %s"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>e<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>This replacement M6 is compatible with the built in code,
except steps 3-5 need to be filled in with your NGC code.</p></div>
<div class="paragraph"><p>Again, most epilogs have a common scheme: first, determine whether
things went right in the remap procedure, then do any commit and cleanup
actions which cant be done in NGC code.</p></div>
</div>
<div class="sect2">
<h3 id="_configuring_iocontrol_with_a_remapped_m6">5.4. Configuring iocontrol with a remapped M6</h3>
<div class="paragraph"><p>Note that the sequence of operations has changed: we do everything
required in the O-word procedure - including any HAL pin
setting/reading to get a changer going, and to acknowledge a tool
change - likely with <code>motion.digital-*</code> and <code>motion-analog-*</code> IO
pins. When we finally execute the <code>CHANGE_TOOL()</code> command, all
movements and HAL interactions are already completed.</p></div>
<div class="paragraph"><p>Normally only now iocontrol would do its thing as outlined
<a href="#remap:iocontrol-action-on-load">here</a>. However, we don&#8217;t need the
HAL pin wiggling anymore - all iocontrol is left to do is to accept
we&#8217;re done with prepare and change.</p></div>
<div class="paragraph"><p>This means that the corresponding iocontrol pins have no function any
more. Therefore, we configure iocontrol to immediately acknowledge a
change by configuring like so:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># loop change signals when remapping M6</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">net</span></span> <span style="font-weight: bold"><span style="color: #000000">tool-change-loop</span></span> <span style="color: #009900">iocontrol.0.tool-change</span> <span style="color: #009900">iocontrol.0.tool-changed</span></tt></pre></div></div>
<div class="paragraph"><p>If you for some reason want to remap <code>Tx</code> (prepare), the corresponding
iocontrol pins need to be looped as well.</p></div>
</div>
<div class="sect2">
<h3 id="_writing_the_change_and_prepare_o_word_procedures">5.5. Writing the change and prepare O-word procedures</h3>
<div class="paragraph"><p>The standard prologs and epilogs found in
<code>ncfiles/remap_lib/python-stdglue/stdglue.py</code> pass a few <em>exposed
parameters</em> to the remap procedure.</p></div>
<div class="paragraph"><p>An <em>exposed parameter</em> is a named local variable visible in a remap
procedure which corresponds to interpreter-internal variable which
is relevant for the current remap. Exposed parameters
are set up in the respective prolog, and inspected in the epilog. They
can be changed in the remap procedure and the change will be picked up
in the epilog. The exposed parameters for remappable built in codes are:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>T</code> (prepare_prolog): <code>#&lt;tool&gt;</code> , <code>#&lt;pocket&gt;</code>
</p>
</li>
<li>
<p>
<code>M6</code> (change_prolog): <code>#&lt;tool_in_spindle&gt;</code>, <code>#&lt;selected_tool&gt;</code>, <code>#&lt;current_pocket&gt;</code>, <code>#&lt;selected_pocket&gt;</code>
</p>
</li>
<li>
<p>
<code>M61</code> (settool_prolog): <code>#&lt;tool&gt;</code> , <code>#&lt;pocket&gt;</code>
</p>
</li>
<li>
<p>
<code>S</code> (setspeed_prolog):  <code>#&lt;speed&gt;</code>
</p>
</li>
<li>
<p>
<code>F</code> (setfeed_prolog):  <code>#&lt;feed&gt;</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>If you have specific needs for extra parameters to be made visible,
that can simply be added to the prolog - practically all of the
interpreter internals are visible to Python.</p></div>
</div>
<div class="sect2">
<h3 id="_making_minimal_changes_to_the_built_in_codes_including_code_m6_code">5.6. Making minimal changes to the built in codes, including <code>M6</code></h3>
<div class="paragraph"><p>Remember that normally remapping a code completely disables all internal
processing for that code.</p></div>
<div class="paragraph"><p>However, in some situations it might be sufficient to add a few codes around
the existing <code>M6</code> built in implementation, like a tool length probe,
but other than that retain the behavior of the built in <code>M6</code>.</p></div>
<div class="paragraph"><p>Since this might be a common scenario, the built in behavior of
remapped codes has been made available within the remap
procedure. The interpreter detects that you are referring to a
remapped code within the procedure which is supposed to redefine its
behavior. In this case, the built in behavior is used - this
currently is enabled for the set: <code>M6</code>, <code>M61</code>,<code>T</code>, <code>S</code>, <code>F</code>). Note
that otherwise referring to a code within its own remap procedure
would be a error - a <code>remapping recursion</code>.</p></div>
<div class="paragraph"><p>Slightly twisting a built in would look like so (in the case of <code>M6</code>):</p></div>
<div class="literalblock">
<div class="content">
<pre><code>REMAP=M6   modalgroup=6  ngc=mychange</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">o&lt;mychange&gt; sub</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">M6</span></span> <span style="font-style: italic"><span style="color: #9A1900">(use built in M6 behavior)</span></span>
<span style="font-style: italic"><span style="color: #9A1900">(.. move to tool length switch, probe and set tool length..)</span></span>
<span style="font-weight: bold"><span style="color: #000080">o&lt;mychange&gt; endsub</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">m2</span></span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">when redefining a built in code, <strong>do not specify any leading
zeroes in G- or M-codes</strong> - for example, say <code>REMAP=M1 ..</code>, not
<code>REMAP=M01 ...</code>.</td>
</tr></table>
</div>
<div class="paragraph"><p>See the <code>configs/sim/axis/remap/extend-builtins</code> directory for a complete
configuration which is the recommended starting point for own work
when extending built in codes.</p></div>
</div>
<div class="sect2">
<h3 id="_specifying_the_t_prepare_replacement">5.7. Specifying the T (prepare) replacement</h3>
<div class="paragraph"><p>If you&#8217;re confident with the  <a href="#remap:interpreter-action-on-t">default implementation</a>, you wouldn&#8217;t need to do this. But remapping is also a
way to work around deficiencies in the current implementation, for
instance to not block until the "tool-prepared" pin is set.</p></div>
<div class="paragraph"><p>What you could do, for instance, is:
- in a remapped T, just set the equivalent of the "tool-prepare" pin,
but <strong>not</strong> wait for "tool-prepared" here
- in the corresponding remapped M6, wait for the "tool-prepared" at
the very beginning of the O-word procedure.</p></div>
<div class="paragraph"><p>Again, the iocontrol tool-prepare/tool-prepared pins would be unused
and replaced by <code>motion.*</code> pins, so those would pins must be looped:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># loop prepare signals when remapping T</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">net</span></span> <span style="font-weight: bold"><span style="color: #000000">tool-prep-loop</span></span> <span style="color: #009900">iocontrol.0.tool-prepare</span> <span style="color: #009900">iocontrol.0.tool-prepared</span></tt></pre></div></div>
<div class="paragraph"><p>So, here&#8217;s the setup for a remapped T:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>REMAP=T  prolog=prepare_prolog epilog=prepare_epilog ngc=prepare</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">prepare_prolog</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,**</span>words<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
        cblock <span style="color: #990000">=</span> self<span style="color: #990000">.</span>blocks<span style="color: #990000">[</span>self<span style="color: #990000">.</span>remap_level<span style="color: #990000">]</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> cblock<span style="color: #990000">.</span>t_flag<span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"T requires a tool number"</span>

        tool  <span style="color: #990000">=</span> cblock<span style="color: #990000">.</span>t_number
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> tool<span style="color: #990000">:</span>
            <span style="color: #990000">(</span>status<span style="color: #990000">,</span> pocket<span style="color: #990000">)</span> <span style="color: #990000">=</span> self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">find_tool_pocket</span></span><span style="color: #990000">(</span>tool<span style="color: #990000">)</span>
            <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> status <span style="color: #990000">!=</span> INTERP_OK<span style="color: #990000">:</span>
                <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"T%d: pocket not found"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>tool<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span><span style="color: #990000">:</span>
            pocket <span style="color: #990000">=</span> <span style="color: #990000">-</span><span style="color: #993399">1</span> <span style="font-style: italic"><span style="color: #9A1900"># this is a T0 - tool unload</span></span>

        <span style="font-style: italic"><span style="color: #9A1900"># these variables will be visible in the ngc oword sub</span></span>
        <span style="font-style: italic"><span style="color: #9A1900"># as #&lt;tool&gt; and #&lt;pocket&gt; local variables, and can be</span></span>
        <span style="font-style: italic"><span style="color: #9A1900"># modified there - the epilog will retrieve the changed</span></span>
        <span style="font-style: italic"><span style="color: #9A1900"># values</span></span>
        self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #FF0000">"tool"</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> tool
        self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #FF0000">"pocket"</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> pocket

        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> INTERP_OK
    <span style="font-weight: bold"><span style="color: #0000FF">except</span></span> Exception<span style="color: #990000">,</span> e<span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"T%d/prepare_prolog: %s"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">int</span></span><span style="color: #990000">(</span>words<span style="color: #990000">[</span><span style="color: #FF0000">'t'</span><span style="color: #990000">]),</span> e<span style="color: #990000">)</span>
</tt></pre></div></div>
<div class="paragraph"><p>The minimal ngc prepare procedure again looks like so:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">o&lt;prepare&gt; sub</span></span>
<span style="font-style: italic"><span style="color: #9A1900">; returning a positive value to commit:</span></span>
<span style="font-weight: bold"><span style="color: #000080">o&lt;prepare&gt; endsub</span></span> <span style="font-weight: bold"><span style="color: #000000">[</span></span><span style="color: #993399">1</span><span style="font-weight: bold"><span style="color: #000000">]</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">m2</span></span></tt></pre></div></div>
<div class="paragraph"><p>And the epilog:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">prepare_epilog</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #990000">**</span>words<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>return_value <span style="color: #990000">&gt;</span> <span style="color: #993399">0</span><span style="color: #990000">:</span>
            self<span style="color: #990000">.</span>selected_tool <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">int</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #FF0000">"tool"</span><span style="color: #990000">])</span>
            self<span style="color: #990000">.</span>selected_pocket <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">int</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #FF0000">"pocket"</span><span style="color: #990000">])</span>
            emccanon<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">SELECT_POCKET</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>selected_pocket<span style="color: #990000">,</span> self<span style="color: #990000">.</span>selected_tool<span style="color: #990000">)</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> INTERP_OK
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span><span style="color: #990000">:</span>
            <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"T%d: aborted (return code %.1f)"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span><span style="font-weight: bold"><span style="color: #000000">int</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #FF0000">"tool"</span><span style="color: #990000">]),</span>self<span style="color: #990000">.</span>return_value<span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">except</span></span> Exception<span style="color: #990000">,</span> e<span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"T%d/prepare_epilog: %s"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>tool<span style="color: #990000">,</span>e<span style="color: #990000">)</span>
</tt></pre></div></div>
<div class="paragraph"><p>prepare_prolog and prepare_epilog are part of the <em>standard glue</em>
provided by <em>nc_files/remap_lib/python-stdglue/stdglue.py</em>.
This module is intended to cover most
standard remapping situations in a common way.</p></div>
</div>
<div class="sect2">
<h3 id="_error_handling_dealing_with_abort">5.8. Error handling: dealing with abort</h3>
<div class="paragraph"><p>The built in tool change procedure has some precautions for dealing
with a program abort (e.g. hitting Escape in Axis during a
change). Your remapped function has none of this, therefore some
explicit cleanup might be needed if a remapped code is aborted. In
particular, a remap procedure might establish modal settings which are
undesirable to have active after an abort. For instance, if your
remap procedure has motion codes (G0,G1,G38..) and the remap is
aborted, then the last modal code will remain active. However, you
very likely want to have any modal motion canceled when the remap is
aborted.</p></div>
<div class="paragraph"><p>The way to do this is by using the <code>[RS274NGC]ON_ABORT_COMMAND</code>
feature. This ini option specifies a O-word procedure call which is
executed if task for some reason aborts program execution.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">[RS274NGC]</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">ON_ABORT_COMMAND</span></span><span style="font-weight: bold"><span style="color: #000000">=</span></span><span style="color: #009900">O &lt;on_abort&gt; call</span></tt></pre></div></div>
<div class="paragraph"><p>The suggested on_abort procedure would look like so (adapt to
your needs):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">o&lt;on_abort&gt; sub</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">G54</span></span> <span style="font-style: italic"><span style="color: #9A1900">(origin offsets are set to the default)</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">G17</span></span> <span style="font-style: italic"><span style="color: #9A1900">(select XY plane)</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">G90</span></span> <span style="font-style: italic"><span style="color: #9A1900">(absolute)</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">G94</span></span> <span style="font-style: italic"><span style="color: #9A1900">(feed mode: units/minute)</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">M4</span></span><span style="color: #993399">8</span> <span style="font-style: italic"><span style="color: #9A1900">(set feed and speed overrides)</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">G40</span></span> <span style="font-style: italic"><span style="color: #9A1900">(cutter compensation off)</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">M5</span></span>  <span style="font-style: italic"><span style="color: #9A1900">(spindle off)</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">G80</span></span> <span style="font-style: italic"><span style="color: #9A1900">(cancel modal motion)</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">M9</span></span>  <span style="font-style: italic"><span style="color: #9A1900">(mist and coolant off)</span></span>

<span style="font-weight: bold"><span style="color: #000080">o&lt;on_abort&gt; endsub</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">m2</span></span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">Never use an <code>M2</code> in a O-word subroutine, including this
one. It will cause hard-to-find errors. For instance, using an <code>M2</code> in
a subroutine will not end the subroutine properly and will leave the
subroutine NGC file open, not your main program.</td>
</tr></table>
</div>
<div class="paragraph"><p>Make sure <code>on_abort.ngc</code> is along the interpreter search path
(recommended location: <code>SUBROUTINE_PATH</code> so as not to clutter your
<code>NC_FILES</code> directory with internal procedures). <code>on_abort</code> receives a
single parameter indicating the cause for calling the abort procedure,
which might be used for conditional cleanup.</p></div>
<div class="paragraph"><p>Statements in that procedure typically would assure that post-abort
any state has been cleaned up, like HAL pins properly reset. For an
example, see <code>configs/sim/axis/remap/rack-toolchange</code>.</p></div>
<div class="paragraph"><p>Note that terminating a remapped code by returning INTERP_ERROR from
the epilog (see previous section) will also cause the <code>on_abort</code> procedure
to be called.</p></div>
</div>
<div class="sect2">
<h3 id="_error_handling_failing_a_remapped_code_ngc_procedure">5.9. Error handling: failing a remapped code NGC procedure</h3>
<div class="paragraph"><p>If you determine in your handler procedure that some error condition
occurred, do not use <code>M2</code> to end your handler - see above:</p></div>
<div class="paragraph"><p>If displaying an operator error message and stopping the current program is
good enough, use the <code>(abort, &lt;message&gt;)</code> feature to terminate the handler with an
error message. Note that you can substitute numbered, named, ini and
HAL parameters in the text like
in this example (see also <code>tests/interp/abort-hot-comment/test.ngc</code>):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">o100 if</span></span> <span style="font-weight: bold"><span style="color: #000000">[</span></span>..<span style="font-weight: bold"><span style="color: #000000">]</span></span> <span style="font-style: italic"><span style="color: #9A1900">(some error condition)</span></span>
     <span style="font-style: italic"><span style="color: #9A1900">(abort, Bad Things! p42=#42 q=#&lt;q&gt; ini=#&lt;_ini[a]x&gt; pin=#&lt;_hal[component.pin])</span></span>
<span style="font-weight: bold"><span style="color: #000080">o100 endif</span></span></tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">ini and HAL variable expansion is optional and can be disabled in
the <a href="../config/ini-config.html#gcode:ini-features">INI file</a></td>
</tr></table>
</div>
<div class="paragraph"><p>If more fine grained recovery action is needed, use the idiom
laid out in the previous example:</p></div>
<div class="ulist"><ul>
<li>
<p>
define an epilog function, even if it&#8217;s just to signal an error
  condition
</p>
</li>
<li>
<p>
pass a negative value from the handler to signal
  the error
</p>
</li>
<li>
<p>
inspect the return value in the epilog function.
</p>
</li>
<li>
<p>
take any recovery action needed
</p>
</li>
<li>
<p>
return the error message string from the handler, which will set the
  interpreter error message and abort the program (pretty much like
  <code>(abort, message=</code>
</p>
</li>
</ul></div>
<div class="paragraph"><p>This error message will be displayed in the UI, and returning
INTERP_ERROR will cause this error handled like any other runtime error.</p></div>
<div class="paragraph"><p>Note that both <code>(abort, msg)</code> and returning INTERP_ERROR from an
epilog will cause any ON_ABORT handler to be called as well if defined
(see previous section).</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_remapping_other_existing_codes_s_m0_m1_m60">6. Remapping other existing codes: S, M0, M1, M60</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_automatic_gear_selection_be_remapping_s_set_spindle_speed">6.1. Automatic gear selection be remapping  S (set spindle speed)</h3>
<div class="paragraph"><p>A potential use for a remapped S code would be <em>automatic gear
selection</em> depending on speed. In the remap procedure one would test
for the desired speed attainable given the current gear setting, and
change gears appropriately if not.</p></div>
</div>
<div class="sect2">
<h3 id="_adjusting_the_behavior_of_m0_m1_m60">6.2. Adjusting the behavior of M0, M1, M60</h3>
<div class="paragraph"><p>A use case for remapping M0/M1 would be to customize the behavior of
the existing code. For instance, it could be desirable to turn off the
spindle, mist and flood during an M0 or M1 program pause, and turn
these settings back on when the program is resumed.</p></div>
<div class="paragraph"><p>For a complete example doing just that, see
<em>configs/sim/axis/remap/extend-builtins/</em>, which adapts M1 as laid out above.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_new_g_code_cycles">7. Creating new G-code cycles</h2>
<div class="sectionbody">
<div class="paragraph"><p>A G-code cycle as used here is meant to behave as follows:</p></div>
<div class="ulist"><ul>
<li>
<p>
On first invocation, the associated words are collected and the
G-code cycle is executed.
</p>
</li>
<li>
<p>
If subsequent lines just continue parameter words applicable to this
code, but no new G-code, the previous G code is re-executed with the
parameters changed accordingly.
</p>
</li>
</ul></div>
<div class="paragraph"><p>An example: Assume you have <code>G84.3</code> defined as remapped G code cycle
with the following ini segment (see <a href="remap.html#remap:cycle-stdglue">here</a> for
a detailed description of <code>cycle_prolog</code> and <code>cycle_epilog</code>):</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000000">[RS274NGC]</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># A cycle with an oword procedure: G84.3 &lt;X- Y- Z- Q- P-&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">REMAP</span></span><span style="font-weight: bold"><span style="color: #000000">=</span></span><span style="color: #009900">G84.3 argspec=xyzabcuvwpr prolog=cycle_prolog ngc=g843 epilog=cycle_epilog modalgroup=1</span></tt></pre></div></div>
<div class="paragraph"><p>Executing the following lines:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">g17</span></span>
<span style="font-style: italic"><span style="color: #9A1900">(1)</span></span>   <span style="font-weight: bold"><span style="color: #0000FF">g84</span></span><span style="color: #993399">.3</span> <span style="color: #FF6600">x</span><span style="color: #993399">1</span> <span style="color: #FF6600">y</span><span style="color: #993399">2</span> <span style="color: #FF6600">z</span><span style="color: #993399">3</span>  <span style="color: #FF6600">r</span><span style="color: #993399">1</span>
<span style="font-style: italic"><span style="color: #9A1900">(2)</span></span>   <span style="color: #FF6600">x</span><span style="color: #993399">3</span> <span style="color: #FF6600">y</span><span style="color: #993399">4</span> <span style="color: #FF6600">p</span><span style="color: #993399">2</span>
<span style="font-style: italic"><span style="color: #9A1900">(3)</span></span>   <span style="color: #FF6600">x</span><span style="color: #993399">6</span> <span style="color: #FF6600">y</span><span style="color: #993399">7</span> <span style="color: #FF6600">z</span><span style="color: #993399">5</span>
<span style="font-style: italic"><span style="color: #9A1900">(4)</span></span>   <span style="font-weight: bold"><span style="color: #0000FF">G80</span></span></tt></pre></div></div>
<div class="paragraph"><p>causes the following (note <em>R</em> is sticky, and <em>Z</em> is sticky since the plane is <em>XY</em>):</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<code>g843.ngc</code> is called with words x=1, y=2, z=3, r=1
</p>
</li>
<li>
<p>
<code>g843.ngc</code> is called with words x=3, y=4, z=3, p=2, r=1
</p>
</li>
<li>
<p>
<code>g843.ngc</code> is called with words x=6, y=7, z=3, r=1
</p>
</li>
<li>
<p>
The <code>G84.3</code> cycle is canceled.
</p>
</li>
</ol></div>
<div class="paragraph"><p>Besides creating new cycles, this provides an easy method for
repackaging existing G-codes which do not behave as cycles. For
instance, the <code>G33.1</code> Rigid Tapping code does not behave as a
cycle. With such a wrapper, a new code can be easily created which
uses <code>G33.1</code> but behaves as a cycle.</p></div>
<div class="paragraph"><p>See <em>configs/sim/axis/remap/cycle</em> for a complete example of this
feature. It contains two cycles, one with an NGC procedure like above,
and a cycle example using just Python.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="remap:embedded-python">8. Configuring  Embedded Python</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Python plugin serves both the interpreter, and task if so
configured, and hence has its own section <code>PYTHON</code> in the ini file.</p></div>
<div class="sect2">
<h3 id="_python_plugin_ini_file_configuration">8.1. Python plugin : ini file configuration</h3>
<div class="paragraph"><p><code>[PYTHON]</code></p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>TOPLEVEL=</code><em>&lt;filename&gt;</em>
</dt>
<dd>
<p>
  filename of the initial Python script to execute on
  startup. This script is responsible for setting up the package
  name structure, see below.
</p>
</dd>
<dt class="hdlist1">
<code>PATH_PREPEND=</code><em>&lt;directory&gt;</em>
</dt>
<dd>
<p>
  prepend this directory to <code>PYTHON_PATH</code>. A repeating
  group.
</p>
</dd>
<dt class="hdlist1">
<code>PATH_APPEND=</code><em>&lt;directory&gt;</em>
</dt>
<dd>
<p>
  append this directory to <code>PYTHON_PATH</code>. A repeating
  group.
</p>
</dd>
<dt class="hdlist1">
<code>LOG_LEVEL=</code><em>&lt;integer&gt;</em>
</dt>
<dd>
<p>
  log level of plugin-related actions. Increase this if you
  suspect problems. Can be very verbose.
</p>
</dd>
<dt class="hdlist1">
<code>RELOAD_ON_CHANGE</code>=<em>[0|1]</em>
</dt>
<dd>
<p>
  reload the <em>TOPLEVEL</em> script if the file was changed. Handy
  for debugging but currently incurs some runtime overhead. Turn
  this off for production configurations.
</p>
</dd>
<dt class="hdlist1">
<code>PYTHON_TASK</code>=<em>[0|1]</em>
</dt>
<dd>
<p>
  Start the Python task plug in. Experimental. See xxx.
</p>
</dd>
</dl></div>
</div>
<div class="sect2">
<h3 id="remap:executing-python-statements">8.2. Executing Python statements from the interpreter</h3>
<div class="paragraph"><p>For ad-hoc execution of commands the Python <em>hot comment</em> has been
added. Python output by default goes to stdout, so you need to start
LinuxCNC from a terminal window to see results. Example (eg. in the
MDI window):</p></div>
<div class="literalblock">
<div class="content">
<pre><code>;py,print 2*3</code></pre>
</div></div>
<div class="paragraph"><p>Note that the interpreter instance is available here as <code>self</code>, so you
could also run:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>;py,print self.tool_table[0].toolno</code></pre>
</div></div>
<div class="paragraph"><p>The <code>emcStatus</code> structure is accessible, too:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>;py,from emctask import *
;py,print emcstat.io.aux.estop</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="remap:programming-embedded-python">9. Programming Embedded Python in the RS274NGC Interpreter</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_python_plugin_namespace">9.1. The Python plugin namespace</h3>
<div class="paragraph"><p>The namespace is expected to be laid out as follows:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>oword</code>
</dt>
<dd>
<p>
  Any callables in this module are candidates for Python O-word
  procedures. Note that the Python <code>oword</code> module is checked
  <strong>before</strong> testing for a NGC procedure with the same name - in
  effect names in <code>oword</code> will hide NGC files of the same
  basename.
</p>
</dd>
<dt class="hdlist1">
<code>remap</code>
</dt>
<dd>
<p>
  Python callables referenced in an argspec <code>prolog</code>,<code>epilog</code> or
  <code>python</code> option are expected to be found here.
</p>
</dd>
<dt class="hdlist1">
<code>namedparams</code>
</dt>
<dd>
<p>
  Python funtcions int this module extend or redefine the namespace of
  predefined named parameters, see
  <a href="remap.html#remap:adding-predefined-named-parameters">adding predefined parameters</a>.
</p>
</dd>
<dt class="hdlist1">
<code>task</code>
</dt>
<dd>
<p>
  Task-related callables are expected here.
</p>
</dd>
</dl></div>
</div>
<div class="sect2">
<h3 id="_the_interpreter_as_seen_from_python">9.2. The Interpreter as seen from Python</h3>
<div class="paragraph"><p>The interpreter is an existing C++ class (<em>Interp</em>) defined in
<em>src/emc/rs274ngc</em>. Conceptually all <code>oword.&lt;function&gt;</code> and
<code>remap.&lt;function&gt;</code> Python calls are methods of this Interp class,
although there is no explicit Python definition of this class (it&#8217;s a
<em>Boost.Python</em> wrapper instance) and hence receive the as the first
parameter <code>self</code> which can be used to access internals.</p></div>
</div>
<div class="sect2">
<h3 id="_the_interpreter_code___init___code_and_code___delete___code_functions">9.3. The Interpreter <code>__init__</code> and <code>__delete__</code> functions</h3>
<div class="paragraph"><p>If the <code>TOPLEVEL</code>  module defines a function <code>__init__</code>, it will be
called once the interpreter is fully configured (ini file read, and
state synchronized with the world model).</p></div>
<div class="paragraph"><p>If the <code>TOPLEVEL</code>  module defines a function <code>__delete__</code>, it will be
called once before the interpreter is shutdown and after the persistent
parameters have been saved to the <code>PARAMETER_FILE</code>.</p></div>
<div class="paragraph"><p>Note_ at this time, the <code>__delete__</code> handler does not work for
interpreter instances created by importing the <code>gcode</code> module. If you
need an equivalent functionality there (which is quite unlikely),
please consider the Python <code>atexit</code> module.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># this would be defined in the TOPLEVEL module</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__init__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
    <span style="font-style: italic"><span style="color: #9A1900"># add any one-time initialization here</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>task<span style="color: #990000">:</span>
  <span style="font-style: italic"><span style="color: #9A1900"># this is the milltask instance of interp</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span><span style="color: #990000">:</span>
  <span style="font-style: italic"><span style="color: #9A1900"># this is a non-milltask instance of interp</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__delete__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
    <span style="font-style: italic"><span style="color: #9A1900"># add any cleanup/state saving actions here</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> self<span style="color: #990000">.</span>task<span style="color: #990000">:</span> <span style="font-style: italic"><span style="color: #9A1900"># as above</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">else</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span></tt></pre></div></div>
<div class="paragraph"><p>This function may be used to initialize any Python-side attributes
which might be needed later, for instance in remap or oword
functions, and save or restore state beyond what <code>PARAMETER_FILE</code> provides.</p></div>
<div class="paragraph"><p>If there are setup or cleanup actions which are to happen only in the
milltask Interpreter instance (as opposed to the interpreter instance
which sits in the <code>gcode</code> Python module and serves preview/progress
display purposes but nothing else), this can be tested for by
<a href="remap.html#remap:axis-preview-and-remapped-code-execution">evaluating <em>self.task</em></a>.</p></div>
<div class="paragraph"><p>An example use of <code>__init__</code> and <code>__delete__</code> can be found in
<em>configs/sim/axis/remap/cycle/python/toplevel.py</em> initialising attributes
needed to handle cycles in <em>ncfiles/remap_lib/python-stdglue/stdglue.py</em>
(and imported into <em>configs/sim/axis/remap/cycle/python/remap.py</em>).</p></div>
</div>
<div class="sect2">
<h3 id="_calling_conventions_ngc_to_python">9.4. Calling conventions: NGC to Python</h3>
<div class="paragraph"><p>Python code is called from NGC in the following situations:</p></div>
<div class="ulist"><ul>
<li>
<p>
during normal program execution:
</p>
<div class="ulist"><ul>
<li>
<p>
when an O-word call like <code>O&lt;proc&gt; call</code> is executed and the name
<code>oword.proc</code> is defined and callable
</p>
</li>
<li>
<p>
when a comment like <code>;py,&lt;Python statement&gt;</code> is executed
</p>
</li>
</ul></div>
</li>
<li>
<p>
during execution of a remapped code: any <code>prolog=</code>, <code>python=</code> and
  <code>epilog=</code> handlers.
</p>
</li>
</ul></div>
<div class="paragraph" id="remap:python-o-word-procs"><div class="title">Calling O-word Python subroutines</div><p>Arguments:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>self</code>
</dt>
<dd>
<p>
  the interpreter instance
</p>
</dd>
<dt class="hdlist1">
<code>*args</code>
</dt>
<dd>
<p>
    the list of actual positional parameters. Since the number
    of actual parameters may vary, it is best to use this style of declaration:
</p>
</dd>
</dl></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># this would be defined in the oword module</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">mysub</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #990000">*</span>args<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"number of parameters passed:"</span><span style="color: #990000">,</span> <span style="font-weight: bold"><span style="color: #000000">len</span></span><span style="color: #990000">(</span>args<span style="color: #990000">)</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> a <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> args<span style="color: #990000">:</span>
  <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> a</tt></pre></div></div>
<div class="paragraph"><div class="title">Return values of O-word Python subroutines</div><p>Just as NGC procedures may return values, so do O-word Python
subroutines. They are expected to either:</p></div>
<div class="ulist"><ul>
<li>
<p>
return no value (no <code>return</code> statement or the value <code>None</code>)
</p>
</li>
<li>
<p>
a float or int value
</p>
</li>
<li>
<p>
a string, this  means <em>this is an error message, abort the program</em>. Works like <code>(abort, msg)</code>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Any other return value type will raise a Python exception.</p></div>
<div class="paragraph"><p>In a calling NGC environment, the following predefined named parameters
are available:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>#&lt;_value&gt;</code>
</dt>
<dd>
<p>
        value returned by the last procedure called. Initialized
        to 0.0 on startup. Exposed in Interp as <code>self.return_value</code> (float).
</p>
</dd>
<dt class="hdlist1">
<code>#&lt;_value_returned&gt;</code>
</dt>
<dd>
<p>
        indicates the last procedure called did <code>return`or
        `endsub</code> with an explicit value. 1.0 if true. Set to 0.0 on each <code>call</code>. Exposed
        in Interp was  <code>self.value_returned</code> (int).
</p>
</dd>
</dl></div>
<div class="paragraph"><p>See also <code>tests/interp/value-returned</code> for an example.</p></div>
<div class="paragraph"><div class="title">Calling conventions for <em>prolog=</em> and <em>epilog=</em> subroutines</div><p>Arguments are:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>self</code>
</dt>
<dd>
<p>
  the interpreter instance
</p>
</dd>
<dt class="hdlist1">
<code>words</code>
</dt>
<dd>
<p>
  keyword parameter dictionary. If an argspec was present, words
  are collected from the current block accordingly and passed in
  the dictionary for  convenience (the words could as well be
  retrieved directly from the  calling block, but this requires
  more knowledge of interpreter internals). If no argspec was
  passed, or only optional values were specified and none of
  these was present in the calling block, this dict is
  empty. Word names are converted to lowercase.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Example call:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">minimal_prolog</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #990000">**</span>words<span style="color: #990000">):</span> <span style="font-style: italic"><span style="color: #9A1900"># in remap module</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="font-weight: bold"><span style="color: #000000">len</span></span><span style="color: #990000">(</span>words<span style="color: #990000">),</span><span style="color: #FF0000">" words passed"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> w <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> words<span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"%s: %s"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>w<span style="color: #990000">,</span> words<span style="color: #990000">[</span>w<span style="color: #990000">])</span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> words<span style="color: #990000">[</span><span style="color: #FF0000">'p'</span><span style="color: #990000">]</span> <span style="color: #990000">&lt;</span> <span style="color: #993399">78</span><span style="color: #990000">:</span> <span style="font-style: italic"><span style="color: #9A1900"># NB: could raise an exception if p were optional</span></span>
       <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"failing miserably"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> INTERP_OK</tt></pre></div></div>
<div class="paragraph"><p>Return values:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>INTERP_OK</code>
</dt>
<dd>
<p>
return this on success. You need to import this from
<code>interpreter</code>.
</p>
</dd>
<dt class="hdlist1">
<code>"a message text"</code>
</dt>
<dd>
<p>
returning a string from a handler means <em>this is
an error message, abort the program</em>. Works like <code>(abort, msg)</code>.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>.</p></div>
<div class="paragraph"><div class="title">Calling conventions for <em>python=</em> subroutines</div><p>Arguments are:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>self</code>
</dt>
<dd>
<p>
  the interpreter instance
</p>
</dd>
<dt class="hdlist1">
<code>words</code>
</dt>
<dd>
<p>
  keyword parameter dictionary. the same  kwargs dictionary as
  prologs and epilogs (see above).
</p>
</dd>
</dl></div>
<div class="paragraph"><p>The minimum <code>python=</code> function example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">useless</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span>  <span style="color: #990000">**</span>words<span style="color: #990000">):</span> <span style="font-style: italic"><span style="color: #9A1900"># in remap module</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> INTERP_OK</tt></pre></div></div>
<div class="paragraph"><p>Return values:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>INTERP_OK</code>
</dt>
<dd>
<p>
return this on success
</p>
</dd>
<dt class="hdlist1">
<code>"a message text"</code>
</dt>
<dd>
<p>
returning a string from a handler means <em>this is
an error message, abort the program</em>. Works like <code>(abort, msg)</code>.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>If the handler needs to execute a <em>queuebuster
operation</em> (tool change, probe, HAL pin reading) it is supposed
to suspend execution with the following statement:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>yield INTERP_EXECUTE_FINISH</code>
</dt>
<dd>
<p>
       This signals task to stop read ahead, execute all
       queued operations, execute the <em>queue-buster</em> operation,
       synchronize interpreter state with machine state, and then signal
  the interpreter to continue. At this point the function is
  resumed at the statement following the <code>yield ..</code> statement.
</p>
</dd>
</dl></div>
<div class="paragraph"><div class="title">Dealing with queue-buster: Probe, Tool change and waiting for a HAL pin</div><p>Queue busters interrupt a procedure at the point where such an
operation is called, hence the procedure needs to be restarted
after the interpreter synch(). When this happens the procedure needs to
know if it is restarted, and where to continue. The Python generator
method is used to deal with procedure restart.</p></div>
<div class="paragraph"><p>This demonstrates call continuation with a single point-of-restart:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">read_pin</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,*</span>args<span style="color: #990000">):</span>
    <span style="font-style: italic"><span style="color: #9A1900"># wait 5secs for digital-input 00 to go high</span></span>
    emccanon<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">WAIT</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">1</span><span style="color: #990000">,</span><span style="color: #993399">2</span><span style="color: #990000">,</span><span style="color: #993399">5.0</span><span style="color: #990000">)</span>
    <span style="font-style: italic"><span style="color: #9A1900"># cede control after executing the queue buster:</span></span>
    yield INTERP_EXECUTE_FINISH
    <span style="font-style: italic"><span style="color: #9A1900"># post-sync() execution resumes here:</span></span>
    pin_status <span style="color: #990000">=</span> emccanon<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">GET_EXTERNAL_DIGITAL_INPUT</span></span><span style="color: #990000">(</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">);</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"pin status="</span><span style="color: #990000">,</span>pin_status</tt></pre></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">The <em>yield</em> feature is fragile. The following restrictions
apply to the usage of <em>yield INTERP_EXECUTE_FINISH</em>:</td>
</tr></table>
</div>
<div class="ulist"><ul>
<li>
<p>
Python code executing a <em>yield INTERP_EXECUTE_FINISH</em> must be part
  of a remap procedure. Yield does not work in a Python oword procedure.
</p>
</li>
<li>
<p>
A Python remap subroutine containing <em>yield INTERP_EXECUTE_FINISH</em> statement may
not return a value, as with normal Python yield statements.
</p>
</li>
<li>
<p>
Code following a yield may not recursively call the interpreter, like with
  self.execute("&lt;mdi command&gt;"). This is an architectural restriction
  of the interpreter and is not fixable without a major redesign.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_calling_conventions_python_to_ngc">9.5. Calling conventions: Python to NGC</h3>
<div class="paragraph"><p>NGC code is executed from Python when:</p></div>
<div class="ulist"><ul>
<li>
<p>
the method <code>self.execute(&lt;NGC code&gt;[,&lt;line number&gt;])</code> is executed
</p>
</li>
<li>
<p>
during execution of a remapped code, if a <code>prolog=</code> function is
 defined, the NGC procedure given in <code>ngc=</code> is executed immediately
 thereafter.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The prolog handler does not call the handler, but it prepares its call
environment, for instance by setting up predefined local parameters.</p></div>
<div class="paragraph"><div class="title">Inserting parameters in a prolog, and retrieving  them in an epilog</div><p>Conceptually a prolog and an epilog execute at the same call level
like the O-word procedure, that is: after the subroutine call is set
up, and before the subroutine endsub or return.</p></div>
<div class="paragraph"><p>This means that any local variable created in a prolog will be a local
variable in the O-word procedure, and any local variables created in
the O-word procedure are still accessible when the epilog executes.</p></div>
<div class="paragraph"><p>The <code>self.params</code> array handles reading and setting numbered and named
parameters. If a named parameter begins with <code>_</code> (underscore), it is
assumed to be a global parameter; if not, it is local to the calling
procedure. Also, numbered parameters in the range 1..30 are treated
like local variables; their original values are restored on
return/endsub from an O-word procedure.</p></div>
<div class="paragraph"><p>Here is an example remapped code demonstrating insertion and
extraction of parameters into/from the O-word procedure:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>REMAP=m300 prolog=insert_param ngc=testparam epilog=retrieve_param modalgroup=10</code></pre>
</div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">insert_param</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #990000">**</span>words<span style="color: #990000">):</span> <span style="font-style: italic"><span style="color: #9A1900"># in the remap module</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"insert_param call level="</span><span style="color: #990000">,</span>self<span style="color: #990000">.</span>call_level
    self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #FF0000">"myname"</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">123</span>
    self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">345</span>
    self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span> <span style="color: #990000">=</span> <span style="color: #993399">678</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> INTERP_OK

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">retrieve_param</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #990000">**</span>words<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"retrieve_param call level="</span><span style="color: #990000">,</span>self<span style="color: #990000">.</span>call_level
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"#1="</span><span style="color: #990000">,</span> self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #993399">1</span><span style="color: #990000">]</span>
    <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"#2="</span><span style="color: #990000">,</span> self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #993399">2</span><span style="color: #990000">]</span>
    <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
        <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">"result="</span><span style="color: #990000">,</span> self<span style="color: #990000">.</span>params<span style="color: #990000">[</span><span style="color: #FF0000">"result"</span><span style="color: #990000">]</span>
    <span style="font-weight: bold"><span style="color: #0000FF">except</span></span> Exception<span style="color: #990000">,</span>e<span style="color: #990000">:</span>
  <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">"testparam forgot to assign #&lt;result&gt;"</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> INTERP_OK</tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">o&lt;testparam&gt; sub</span></span>
<span style="font-style: italic"><span style="color: #9A1900">(debug, call_level=</span></span><span style="color: #009900">#&lt;_call_level&gt;</span><span style="font-style: italic"><span style="color: #9A1900"> myname=</span></span><span style="color: #009900">#&lt;myname&gt;</span><span style="font-style: italic"><span style="color: #9A1900">)</span></span>
<span style="font-style: italic"><span style="color: #9A1900">; try commenting out the next line and run again</span></span>
<span style="color: #009900">#&lt;result&gt;</span> <span style="font-weight: bold"><span style="color: #000000">=</span></span> <span style="font-weight: bold"><span style="color: #000000">[</span></span><span style="color: #009900">#&lt;myname&gt;</span> <span style="font-weight: bold"><span style="color: #000000">*</span></span> <span style="color: #993399">3</span><span style="font-weight: bold"><span style="color: #000000">]</span></span>
<span style="color: #009900">#1</span> <span style="font-weight: bold"><span style="color: #000000">=</span></span> <span style="font-weight: bold"><span style="color: #000000">[</span></span><span style="color: #009900">#1</span> <span style="font-weight: bold"><span style="color: #000000">*</span></span> <span style="color: #993399">5</span><span style="font-weight: bold"><span style="color: #000000">]</span></span>
<span style="color: #009900">#2</span> <span style="font-weight: bold"><span style="color: #000000">=</span></span> <span style="font-weight: bold"><span style="color: #000000">[</span></span><span style="color: #009900">#2</span> <span style="font-weight: bold"><span style="color: #000000">*</span></span> <span style="color: #993399">3</span><span style="font-weight: bold"><span style="color: #000000">]</span></span>
<span style="font-weight: bold"><span style="color: #000080">o&lt;testparam&gt; endsub</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">m2</span></span></tt></pre></div></div>
<div class="paragraph"><p><code>self.params()</code> returns a list of all variable names currently defined.
Since <code>myname</code> is local, it goes away after the epilog finishes.</p></div>
<div class="paragraph"><div class="title">Calling the interpreter from Python</div><p>You can recursively call the interpreter from Python code as follows:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>self.execute(&lt;NGC code&gt;[,&lt;line number&gt;])</code></pre>
</div></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>  self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">execute</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"G1 X%f Y%f"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>x<span style="color: #990000">,</span>y<span style="color: #990000">))</span>
  self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">execute</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"O &lt;myprocedure&gt; call"</span><span style="color: #990000">,</span> currentline<span style="color: #990000">)</span></tt></pre></div></div>
<div class="paragraph"><p>You might want to test for the return value being <code>&lt;
INTERP_MIN_ERROR</code>. If you&#8217;re using lots of execute() statements, it&#8217;s
probably easier to trap InterpreterException as per below.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">The parameter insertion/retrieval method described in the previous section does not
work in this case. It is good enough for just executing simple NGC
commands or a procedure call and advanced introspection into the
procedure, and passing of local named parameters is not needed. The
recursive call feature is fragile.</td>
</tr></table>
</div>
<div class="paragraph"><div class="title">Interpreter Exception during execute()</div><p>if <code>interpreter.throw_exceptions</code> is nonzero (default 1), and self.execute() returns an error, the exception
<code>InterpreterException</code> is raised. InterpreterException has the
following attributes:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>line_number</code>
</dt>
<dd>
<p>
where the error occurred
</p>
</dd>
<dt class="hdlist1">
<code>line_text</code>
</dt>
<dd>
<p>
the NGC statement causing the error
</p>
</dd>
<dt class="hdlist1">
<code>error_message</code>
</dt>
<dd>
<p>
the interpreter&#8217;s error message
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Errors can be trapped in the following Pythonic way:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> interpreter
interpreter<span style="color: #990000">.</span>throw_exceptions <span style="color: #990000">=</span> <span style="color: #993399">1</span>
   <span style="color: #990000">...</span>
   <span style="font-weight: bold"><span style="color: #0000FF">try</span></span><span style="color: #990000">:</span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">execute</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"G3456"</span><span style="color: #990000">)</span>  <span style="font-style: italic"><span style="color: #9A1900">#  raise InterpreterException</span></span>

   <span style="font-weight: bold"><span style="color: #0000FF">except</span></span> InterpreterException<span style="color: #990000">,</span>e<span style="color: #990000">:</span>
        msg <span style="color: #990000">=</span> <span style="color: #FF0000">"%d: '%s' - %s"</span> <span style="color: #990000">%</span> <span style="color: #990000">(</span>e<span style="color: #990000">.</span>line_number<span style="color: #990000">,</span>e<span style="color: #990000">.</span>line_text<span style="color: #990000">,</span> e<span style="color: #990000">.</span>error_message<span style="color: #990000">)</span>
        <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> msg  <span style="font-style: italic"><span style="color: #9A1900"># replace builtin error message</span></span></tt></pre></div></div>
<div class="paragraph"><div class="title">Canon</div><p>The canon layer is practically all free functions. Example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">import</span></span> emccanon
<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">example</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,*</span>args<span style="color: #990000">):</span>
    <span style="color: #990000">....</span>
    emccanon<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">STRAIGHT_TRAVERSE</span></span><span style="color: #990000">(</span>line<span style="color: #990000">,</span>x0<span style="color: #990000">,</span>y0<span style="color: #990000">,</span>z0<span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    emccanon<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">STRAIGHT_FEED</span></span><span style="color: #990000">(</span>line<span style="color: #990000">,</span>x1<span style="color: #990000">,</span>y1<span style="color: #990000">,</span>z1<span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">,</span><span style="color: #993399">0</span><span style="color: #990000">)</span>
    <span style="color: #990000">...</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> INTERP_OK</tt></pre></div></div>
<div class="paragraph"><p>The actual canon functions are declared in <code>src/emc/nml_intf/canon.hh</code>
and implemented in <code>src/emc/task/emccanon.cc</code>.  The implementation of
the Python functions can be found in <code>src/emc/rs274ncg/canonmodule.cc</code>.</p></div>
</div>
<div class="sect2">
<h3 id="_built_in_modules">9.6. Built in modules</h3>
<div class="paragraph"><p>The following modules are built in:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<code>interpreter</code>
</dt>
<dd>
<p>
  exposes internals of the Interp class. See
   <code>src/emc/rs274ngc/interpmodule.cc</code>, and the
  <code>tests/remap/introspect</code> regression test.
</p>
</dd>
<dt class="hdlist1">
<code>emccanon</code>
</dt>
<dd>
<p>
  exposes most calls of  <code>src/emc/task/emccanon.cc</code>.
</p>
</dd>
<dt class="hdlist1">
<code>emctask</code>
</dt>
<dd>
<p>
  exposes the <code>emcStatus</code> class instance. See  <code>src/emc/task/taskmodule.cc</code>.
  Not present when using the <code>gcode</code> module used for user
  interfaces - only present in the milltask instance of the interpreter.
</p>
</dd>
</dl></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="remap:adding-predefined-named-parameters">10. Adding Predefined Named Parameters</h2>
<div class="sectionbody">
<div class="paragraph"><p>The interpreter comes with a set of predefined named parameters for
accessing internal state from the NGC language level. These parameters
are read-only and global, and hence cannot be assigned to.</p></div>
<div class="paragraph"><p>Additional parameters may be added by defining a function in the
<code>namedparams</code> module. The name of the function defines the name of the
new predefined named parameter, which now can be referenced in
arbitrary expressions.</p></div>
<div class="paragraph"><p>To add or redefine a named parameter:</p></div>
<div class="ulist"><ul>
<li>
<p>
add a <code>namedparams</code> module so it can be found by the interpreter
</p>
</li>
<li>
<p>
define new parameters by functions (see below). These functions
 receive <code>self</code> (the interpreter instance) as parameter and so can
 access aribtrary state. Arbitrary Python capabilities can be used to return a value.
</p>
</li>
<li>
<p>
import that module from the <code>TOPLEVEL</code> script
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># namedparams.py</span></span>
<span style="font-style: italic"><span style="color: #9A1900"># trivial example</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_pi</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #993399">3.1415926535</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #009900">#&lt;circumference&gt;</span> <span style="font-weight: bold"><span style="color: #000000">=</span></span> <span style="font-weight: bold"><span style="color: #000000">[</span></span><span style="color: #993399">2</span> <span style="font-weight: bold"><span style="color: #000000">*</span></span> <span style="color: #009900">#&lt;radius&gt;</span> <span style="font-weight: bold"><span style="color: #000000">*</span></span> <span style="color: #009900">#&lt;_pi&gt;</span><span style="font-weight: bold"><span style="color: #000000">]</span></span></tt></pre></div></div>
<div class="paragraph"><p>Functions in <code>namedparams.py</code> are expected to return a float or int
value. If a string is returned, this sets the interpreter error
message and aborts execution.</p></div>
<div class="paragraph"><p>Ònly functions with a leading underscore are added as parameters,
since this is the RS274NGC convention for globals.</p></div>
<div class="paragraph"><p>It is possible to redefine an existing predefined parameter by adding
a Python function of the same name to the <code>namedparams</code> module. In
this case, a warning is generated during startup.</p></div>
<div class="paragraph"><p>While the above example isnt terribly useful, note that pretty much
all of the interpreter internal state is accessible from Python, so
arbitrary predicates may be defined this way. For a slightly more
advanced example, see <code>tests/remap/predefined-named-params</code>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="remap:standard-glue">11. Standard Glue routines</h2>
<div class="sectionbody">
<div class="paragraph"><p>Since many remapping tasks are very similar, I&#8217;ve started collecting
working prolog and epilog routines in a single Python module. These
can currently be found in
<em>ncfiles/remap_lib/python-stdglue/stdglue.py</em> and provide the
following routines:</p></div>
<div class="sect2">
<h3 id="_t_code_prepare_prolog_code_and_code_prepare_epilog_code">11.1. T: <code>prepare_prolog</code> and <code>prepare_epilog</code></h3>
<div class="paragraph"><p>These wrap a NGC procedure for Tx Tool Prepare.</p></div>
<div class="paragraph"><div class="title">Actions of <code>prepare_prolog</code></div><p>The following parameters are made visible to the NGC procedure:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>#&lt;tool&gt;</code> - the parameter of the <code>T</code> word
</p>
</li>
<li>
<p>
<code>#&lt;pocket&gt;</code> - the corresponding pocket
</p>
</li>
</ul></div>
<div class="paragraph"><p>If tool number zero is requested (meaning Tool unload), the
corresponding pocket is passed as -1.</p></div>
<div class="paragraph"><p>It is an error if:</p></div>
<div class="ulist"><ul>
<li>
<p>
no tool number is given as T parameter
</p>
</li>
<li>
<p>
the tool cannot be found in the tool table.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Note that unless you set the <code>[EMCIO] RANDOM_TOOLCHANGER=1</code> parameter,
tool and pocket number are identical, and the pocket number from the
tool table is ignored. This is currently a restriction.</p></div>
<div class="ulist"><div class="title">Actions of <code>prepare_epilog</code></div><ul>
<li>
<p>
The NGC procedure is expected to return a positive value, otherwise
  and error message containing the return value is given and the
  interpreter aborts.
</p>
</li>
<li>
<p>
In case the NGC procedure executed the T command (which then refers
  to the built in T behavior), no further action is taken. This can be
  used for instance to minimally adjust the built in behavior be
  preceding or following it with some other statements.
</p>
</li>
<li>
<p>
Otherwise, the <code>#&lt;tool&gt;</code> and <code>#&lt;pocket&gt;</code> parameters are extracted
  from the subroutine&#8217;s parameter space. This means that the NGC
  procedure could change these values, and the epilog takes the
  changed values in account.
</p>
</li>
<li>
<p>
then, the Canon command <code>SELECT_POCKET(#&lt;pocket&gt;,#&lt;tool&gt;)</code> is executed.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_m6_code_change_prolog_code_and_code_change_epilog_code">11.2. M6: <code>change_prolog</code> and <code>change_epilog</code></h3>
<div class="paragraph"><p>These wrap a NGC procedure for M6 Tool Change.</p></div>
<div class="ulist"><div class="title">Actions of <code>change_prolog</code></div><ul>
<li>
<p>
The following three steps are applicable only if the <code>iocontrol-v2</code>
component is used:
</p>
<div class="ulist"><ul>
<li>
<p>
If parameter 5600 (fault indicator) is greater than zero, this indicates a Toolchanger
fault, which is handled as follows:
</p>
</li>
<li>
<p>
if parameter 5601 (error code) is negative, this indicates a hard
fault and the prolog aborts with an error message.
</p>
</li>
<li>
<p>
if parameter 5601 (error code) is greater equal zero, this indicates a soft
fault. An informational message is displayed and the prolog continues.
</p>
</li>
</ul></div>
</li>
<li>
<p>
If there was no preceding T command which caused a pocket to be
selected, the prolog aborts with an error message.
</p>
</li>
<li>
<p>
If cutter radius compensation is on, the prolog aborts with an error
message.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Then, the following parameters are exported to the NGC procedure:</p></div>
<div class="ulist"><ul>
<li>
<p>
<code>#&lt;tool_in_spindle&gt;</code> : the tool number of the currently loaded tool
</p>
</li>
<li>
<p>
<code>#&lt;selected_tool&gt;</code> : the tool number selected
</p>
</li>
<li>
<p>
<code>#&lt;selected_pocket&gt;</code> : the selected tool&#8217;s pocket number
</p>
</li>
</ul></div>
<div class="ulist"><div class="title">Actions of <code>change_epilog</code></div><ul>
<li>
<p>
The NGC procedure is expected to return a positive value, otherwise
  and error message containing the return value is given and the
  interpreter aborts.
</p>
</li>
<li>
<p>
If parameter 5600 (fault indicator) is greater than zero, this indicates a Toolchanger
fault, which is handled as follows (<code>iocontrol-v2</code>-only):
</p>
<div class="ulist"><ul>
<li>
<p>
if parameter 5601 (error code) is negative, this indicates a hard
fault and the epilog aborts with an error message.
</p>
</li>
<li>
<p>
if parameter 5601 (error code) is greater equal zero, this indicates a soft
fault. An informational message is displayed and the epilog continues.
</p>
</li>
</ul></div>
</li>
<li>
<p>
In case the NGC procedure executed the M6 command (which then refers
  to the built in M6 behavior), no further action is taken. This can be
  used for instance to minimally adjust the built in behavior be
  preceding or following it with some other statements.
</p>
</li>
<li>
<p>
Otherwise, the <code>#&lt;selected_pocket&gt;</code> parameter is extracted
  from the subroutine&#8217;s parameter space, and used to set the
  interpreter&#8217;s <code>current_pocket</code> variable. Again, the
  procedure could change this value, and the epilog takes the
  changed value in account.
</p>
</li>
<li>
<p>
then, the Canon command <code>CHANGE_TOOL(#&lt;selected_pocket&gt;)</code> is
  executed.
</p>
</li>
<li>
<p>
The new tool parameters (offsets, diameter etc) are set.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="remap:cycle-stdglue">11.3. G code Cycles: <code>cycle_prolog</code> and <code>cycle_epilog</code></h3>
<div class="paragraph"><p>These wrap a NGC procedure so it can act as a cycle, meaning the
motion code is retained after finishing execution. If the next line
just contains parameter words (e.g. new X,Y values), the code is
executed again with the new parameter words merged into the set of the
parameters given in the first invocation.</p></div>
<div class="paragraph"><p>These routines are designed to work in conjunction with an
<a href="remap.html#_the_argspec_parameter"><code>argspec=&lt;words&gt;</code> parameter</a>. While this is
easy to use, in a realistic scenario you would avoid argspec and do a
more thorough investigation of the block manually in order to give better
error messages.</p></div>
<div class="paragraph"><p>The suggested argspec is as follows:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">REMAP</span></span><span style="font-weight: bold"><span style="color: #000000">=</span></span><span style="color: #009900">G&lt;somecode&gt; argspec=xyzabcuvwqplr prolog=cycle_prolog ngc=&lt;ngc procedure&gt; epilog=cycle_epilog modalgroup=1</span></tt></pre></div></div>
<div class="paragraph"><p>This will permit <code>cycle_prolog</code> to determine the compatibility of any
axis words give in the block, see below.</p></div>
<div class="ulist"><div class="title">Actions of <code>cycle_prolog</code></div><ul>
<li>
<p>
Determine whether the words passed in from the current block fulfill
the conditions outlined under <a href="../gcode/g-code.html#gcode:canned-cycle-errors">Canned Cycle Errors</a>.
</p>
<div class="ulist"><ul>
<li>
<p>
export the axis words as <code>&lt;x&gt;</code>, <code>#&lt;y&gt;</code> etc; fail if axis words from
different groups (XYZ) (UVW) are used together, or any of (ABC) is given.
</p>
</li>
<li>
<p>
export <em>L-</em> as <code>#&lt;l&gt;</code>; default to 1 if not given.
</p>
</li>
<li>
<p>
export <em>P-</em> as <code>#&lt;p&gt;</code>; fail if p less than 0.
</p>
</li>
<li>
<p>
export <em>R-</em> as <code>#&lt;r&gt;</code>; fail if r not given, or less equal 0 if given.
</p>
</li>
<li>
<p>
fail if feed rate is zero, or inverse time feed or cutter
compensation is on.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Determine whether this is the first invocation of a cycle G code, if
so:
</p>
<div class="ulist"><ul>
<li>
<p>
Add the words passed in (as per argspec) into a set of sticky
parameters, which is retained across several invocations.
</p>
</li>
</ul></div>
</li>
<li>
<p>
If not (a continuation line with new parameters):
</p>
<div class="ulist"><ul>
<li>
<p>
merge the words passed in into the existing set of sticky
parameters.
</p>
</li>
</ul></div>
</li>
<li>
<p>
export the set of sticky parameters to the NGC procedure.
</p>
</li>
</ul></div>
<div class="ulist"><div class="title">Actions of <code>cycle_epilog</code></div><ul>
<li>
<p>
Determine if the current code was in fact a cycle, if so:
</p>
<div class="ulist"><ul>
<li>
<p>
retain the current motion mode so a continuation line without a
motion code will execute the same motion code.
</p>
</li>
</ul></div>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_s_set_speed_code_setspeed_prolog_code_and_code_setspeed_epilog_code">11.4. S (Set Speed) : <code>setspeed_prolog</code> and <code>setspeed_epilog</code></h3>
<div class="paragraph"><p>TBD</p></div>
</div>
<div class="sect2">
<h3 id="_f_set_feed_code_setfeed_prolog_code_and_code_setfeed_epilog_code">11.5. F (Set Feed) : <code>setfeed_prolog</code> and <code>setfeed_epilog</code></h3>
<div class="paragraph"><p>TBD</p></div>
</div>
<div class="sect2">
<h3 id="_m61_set_tool_number_code_settool_prolog_code_and_code_settool_epilog_code">11.6. M61 Set tool number : <code>settool_prolog</code> and <code>settool_epilog</code></h3>
<div class="paragraph"><p>TBD</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_remapped_code_execution">12. Remapped code execution</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ngc_procedure_call_environment_during_remaps">12.1. NGC procedure call environment during remaps</h3>
<div class="paragraph"><p>Normally, an O-word procedure is called with positional parameters.
This scheme is very limiting in particular in the presence of optional
parameters. Therefore, the calling convention has been extended to use
something remotely similar to the Python keyword arguments model.</p></div>
<div class="paragraph"><p>see  LINKTO gcode/main Subroutines: sub, endsub, return, call.</p></div>
</div>
<div class="sect2">
<h3 id="_nested_remapped_codes">12.2. Nested remapped codes</h3>
<div class="paragraph"><p>Remapped codes may be nested just like procedure calls - that is, a
remapped code whose NGC procedure refers to some other remapped code
will execute properly.</p></div>
<div class="paragraph"><p>The maximum nesting level remaps is currently 10.</p></div>
</div>
<div class="sect2">
<h3 id="_sequence_number_during_remaps">12.3. Sequence number  during remaps</h3>
<div class="paragraph"><p>Sequence numbers are propagated and restored like with O-word
calls. See <code>tests/remap/nested-remaps/word</code> for the regression test,
which shows sequence number tracking during nested remaps three levels
deep.</p></div>
</div>
<div class="sect2">
<h3 id="_debugging_flags">12.4. Debugging flags</h3>
<div class="paragraph"><p>The following flags are relevant for remapping and Python - related execution:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>EMC_DEBUG_OWORD             0x00002000  traces execution of O-word subroutines
EMC_DEBUG_REMAP             0x00004000  traces execution of remap-related code
EMC_DEBUG_PYTHON            0x00008000  calls to the Python plug in
EMC_DEBUG_NAMEDPARAM        0x00010000  trace named parameter access
EMC_DEBUG_PYTHON_TASK       0x00040000  trace the task Python plug in
EMC_DEBUG_USER1             0x10000000  user-defined - not interpreted by LinuxCNC
EMC_DEBUG_USER2             0x20000000  user-defined - not interpreted by LinuxCNC</code></pre>
</div></div>
<div class="paragraph"><p><em>or</em> these flags into the <code>[EMC]DEBUG</code> variable as needed. For a current
list of debug flags see <em>src/emc/nml_intf/debugflags.h</em>.</p></div>
</div>
<div class="sect2">
<h3 id="_debugging_embedded_python_code">12.5. Debugging Embedded Python code</h3>
<div class="paragraph"><p>Debugging of embedded Python code is harder than debugging normal
Python scripts, and only a limited supply of debuggers exists. A
working open-source based solution is to use the
<a href="http://www.eclipse.org">Eclipse IDE</a>, and the <a href="http://www.pydev.org">PydDev</a>
Eclipse plug in and its
<a href="http://pydev.org/manual_adv_remote_debugger.html">remote debugging
feature</a>.</p></div>
<div class="paragraph"><p>To use this approach:</p></div>
<div class="ulist"><ul>
<li>
<p>
install Eclipse via the the <em>Ubuntu Software Center</em> (choose first
selection)
</p>
</li>
<li>
<p>
install the PyDev plug in from the
<a href="http://pydev.org/updates">Pydev Update Site</a>
</p>
</li>
<li>
<p>
setup the LinuxCNC source tree as an Eclipse project
</p>
</li>
<li>
<p>
start the Pydev Debug Server in Eclipse
</p>
</li>
<li>
<p>
make sure the embedded Python code can find the <code>pydevd.py</code> module
which comes with that plug in - it&#8217;s buried somewhere deep under the
Eclipse install directory. Set the the <code>pydevd</code> variable in <code>util.py</code>
to reflect this directory location.
</p>
</li>
<li>
<p>
<code>import pydevd</code> in your Python module - see example <code>util.py</code> and <code>remap.py</code>
</p>
</li>
<li>
<p>
call <code>pydevd.settrace()</code> in your module at some point to connect to
the Eclipse Python debug server - here you can set breakpoints in your
code, inspect variables, step etc as usual.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content"><code>pydevd.settrace()</code> will block execution if Eclipse and the
Pydev debug server have not been started.</td>
</tr></table>
</div>
<div class="paragraph"><p>To cover the last two steps: the <code>o&lt;pydevd&gt;</code> procedure helps to get
into the debugger from MDI mode. See also the <code>call_pydevd</code> function
in <code>util.py</code> and its usage in <code>remap.involute</code> to set a breakpoint.</p></div>
<div class="paragraph"><p>Here&#8217;s a screen-shot of Eclipse/PyDevd debugging the <code>involute</code>
procedure from above:</p></div>
<div class="imageblock">
<div class="content">
<img src="images/debug_embedded_python.png" alt="Debugging with Eclipse" />
</div>
</div>
<div class="paragraph"><p>See the Python code in <code>configs/sim/axis/remap/getting-started/python</code> for details.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="remap:axis-preview-and-remapped-code-execution">13. Axis Preview and Remapped code execution</h2>
<div class="sectionbody">
<div class="paragraph"><p>For complete preview of a remapped code&#8217;s tool path some precautions
need to be taken. To understand what is going on, let&#8217;s review the
preview and execution process (this covers the Axis case, but others
are similar):</p></div>
<div class="paragraph"><p>First, note that there are <strong>two</strong> independent interpreter instances
involved:</p></div>
<div class="ulist"><ul>
<li>
<p>
one instance in the milltask program, which executes a program when
you hit the <em>Start</em> button, and actually makes the machine move
</p>
</li>
<li>
<p>
a second instance in the user interface whose primary purpose is to
generate the tool path preview. This one <em>executes</em> a program once it
is loaded, but it doesn&#8217;t actually cause machine movements.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Now assume that your remap procedure contains a G38 probe operation,
for example as part of a tool change with automatic tool length
touch off. If the probe fails, that would clearly be an error, so you&#8217;d
display a message and abort the program.</p></div>
<div class="paragraph"><p>Now, what about preview of this procedure?  At preview time, of course
it&#8217;s not known whether the probe succeeds or fails - but you would
likely want to see what the maximum depth of the probe is, and assume
it  succeeds and continues execution to
preview further movements. Also, there is no point in displaying a
<em>probe failed</em> message and aborting <strong>during preview</strong>.</p></div>
<div class="paragraph"><p>The way to address this issue is to test in your procedure whether it
executes in preview or execution mode. This can be checked for by
testing the <code>#&lt;_task&gt;</code> <a href="../gcode/overview.html#gcode:predefined-named-parameters">predefined named parameter</a> - it will be 1 during actual execution and 0 during
preview. See
<em>configs/sim/axis/remap/manual-toolchange-with-tool-length-switch/nc_subroutines/manual_change.ngc</em>
for a complete usage example.</p></div>
<div class="paragraph"><p>Within Embedded Python, the task instance can be checked for by
testing <em>self.task</em> - this will be 1 in the milltask instance, and 0
in the preview instance(s).</p></div>
</div>
</div>
<div class="sect1">
<h2 id="remap:remappable-codes">14. Remappable Codes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="remap:existing-codes">14.1. Existing codes which can be remapped</h3>
<div class="paragraph"><p>The current set of <strong>existing</strong> codes open to redefinition is:</p></div>
<div class="ulist"><ul>
<li>
<p>
Tx (Prepare)
</p>
</li>
<li>
<p>
M6 (Change tool)
</p>
</li>
<li>
<p>
M61 (Set tool number)
</p>
</li>
<li>
<p>
M0 (pause a running program temporarily)
</p>
</li>
<li>
<p>
M1 (pause a running program temporarily if the optional stop switch is on)
</p>
</li>
<li>
<p>
M60 (exchange pallet shuttles and then pause a running program temporarily)
</p>
</li>
<li>
<p>
S  (set spindle speed)
</p>
</li>
<li>
<p>
F  (set feed)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Note that the use of M61 currently requires the use of iocontrol-v2.</p></div>
</div>
<div class="sect2">
<h3 id="remap:unallocated-g-codes">14.2. Currently unallocated G-codes:</h3>
<div class="paragraph"><p>Currently unallocated G-codes (for remapping) must be selected from the blank
areas of the following tables. All the listed G-codes are already defined in
the current implementation of LinuxCNC and may <strong>not</strong> be used to remap new
G-codes. (Developers who add new G-codes to LinuxCNC are encouraged to also
add their new G-codes to these tables.)</p></div>
<div class="tableblock unbreakable">
<table rules="all"
style="margin-left:auto; margin-right:auto;"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 1. Table_of_Allocated_G-codes_00-09</caption>
<col width="16%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<thead>
<tr>
<th align="center" valign="top">#  </th>
<th align="left" valign="top">Gxx </th>
<th align="left" valign="top">Gxx.1</th>
<th align="left" valign="top">Gxx.2</th>
<th align="left" valign="top">Gxx.3</th>
<th align="left" valign="top">Gxx.4</th>
<th align="left" valign="top">Gxx.5</th>
<th align="left" valign="top">Gxx.6</th>
<th align="left" valign="top">Gxx.7</th>
<th align="left" valign="top">Gxx.8</th>
<th align="left" valign="top">Gxx.9</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top"><p class="table"><em>00</em></p></td>
<td align="left" valign="top"><p class="table"><code>G00</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>01</em></p></td>
<td align="left" valign="top"><p class="table"><code>G01</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>02</em></p></td>
<td align="left" valign="top"><p class="table"><code>G02</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>03</em></p></td>
<td align="left" valign="top"><p class="table"><code>G03</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>04</em></p></td>
<td align="left" valign="top"><p class="table"><code>G04</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>05</em></p></td>
<td align="left" valign="top"><p class="table"><code>G05</code></p></td>
<td align="left" valign="top"><p class="table"><code>G05.1</code></p></td>
<td align="left" valign="top"><p class="table"><code>G05.2</code></p></td>
<td align="left" valign="top"><p class="table"><code>G05.3</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>06</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>07</em></p></td>
<td align="left" valign="top"><p class="table"><code>G07</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>08</em></p></td>
<td align="left" valign="top"><p class="table"><code>G08</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>09</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock unbreakable">
<table rules="all"
style="margin-left:auto; margin-right:auto;"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 2. Table_of_Allocated_G-codes_10-19</caption>
<col width="16%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<thead>
<tr>
<th align="center" valign="top">#  </th>
<th align="left" valign="top">Gxx </th>
<th align="left" valign="top">Gxx.1</th>
<th align="left" valign="top">Gxx.2</th>
<th align="left" valign="top">Gxx.3</th>
<th align="left" valign="top">Gxx.4</th>
<th align="left" valign="top">Gxx.5</th>
<th align="left" valign="top">Gxx.6</th>
<th align="left" valign="top">Gxx.7</th>
<th align="left" valign="top">Gxx.8</th>
<th align="left" valign="top">Gxx.9</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top"><p class="table"><em>10</em></p></td>
<td align="left" valign="top"><p class="table"><code>G10</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>11</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>12</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>13</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>14</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>15</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>16</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>17</em></p></td>
<td align="left" valign="top"><p class="table"><code>G17</code></p></td>
<td align="left" valign="top"><p class="table"><code>G17.1</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>18</em></p></td>
<td align="left" valign="top"><p class="table"><code>G18</code></p></td>
<td align="left" valign="top"><p class="table"><code>G18.1</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>19</em></p></td>
<td align="left" valign="top"><p class="table"><code>G19</code></p></td>
<td align="left" valign="top"><p class="table"><code>G19.1</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock unbreakable">
<table rules="all"
style="margin-left:auto; margin-right:auto;"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 3. Table_of_Allocated_G-codes_20-29</caption>
<col width="16%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<thead>
<tr>
<th align="center" valign="top">#  </th>
<th align="left" valign="top">Gxx </th>
<th align="left" valign="top">Gxx.1</th>
<th align="left" valign="top">Gxx.2</th>
<th align="left" valign="top">Gxx.3</th>
<th align="left" valign="top">Gxx.4</th>
<th align="left" valign="top">Gxx.5</th>
<th align="left" valign="top">Gxx.6</th>
<th align="left" valign="top">Gxx.7</th>
<th align="left" valign="top">Gxx.8</th>
<th align="left" valign="top">Gxx.9</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top"><p class="table"><em>20</em></p></td>
<td align="left" valign="top"><p class="table"><code>G20</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>21</em></p></td>
<td align="left" valign="top"><p class="table"><code>G21</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>22</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>23</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>24</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>25</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>26</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>27</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>28</em></p></td>
<td align="left" valign="top"><p class="table"><code>G28</code></p></td>
<td align="left" valign="top"><p class="table"><code>G28.1</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>29</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock unbreakable">
<table rules="all"
style="margin-left:auto; margin-right:auto;"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 4. Table_of_Allocated_G-codes_30-39</caption>
<col width="16%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<thead>
<tr>
<th align="center" valign="top">#  </th>
<th align="left" valign="top">Gxx </th>
<th align="left" valign="top">Gxx.1</th>
<th align="left" valign="top">Gxx.2</th>
<th align="left" valign="top">Gxx.3</th>
<th align="left" valign="top">Gxx.4</th>
<th align="left" valign="top">Gxx.5</th>
<th align="left" valign="top">Gxx.6</th>
<th align="left" valign="top">Gxx.7</th>
<th align="left" valign="top">Gxx.8</th>
<th align="left" valign="top">Gxx.9</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top"><p class="table"><em>30</em></p></td>
<td align="left" valign="top"><p class="table"><code>G30</code></p></td>
<td align="left" valign="top"><p class="table"><code>G30.1</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>31</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>32</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>33</em></p></td>
<td align="left" valign="top"><p class="table"><code>G30</code></p></td>
<td align="left" valign="top"><p class="table"><code>G30.1</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>34</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>35</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>36</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>37</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>38</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>39</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock unbreakable">
<table rules="all"
style="margin-left:auto; margin-right:auto;"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 5. Table_of_Allocated_G-codes_40-49</caption>
<col width="16%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<thead>
<tr>
<th align="center" valign="top">#  </th>
<th align="left" valign="top">Gxx </th>
<th align="left" valign="top">Gxx.1</th>
<th align="left" valign="top">Gxx.2</th>
<th align="left" valign="top">Gxx.3</th>
<th align="left" valign="top">Gxx.4</th>
<th align="left" valign="top">Gxx.5</th>
<th align="left" valign="top">Gxx.6</th>
<th align="left" valign="top">Gxx.7</th>
<th align="left" valign="top">Gxx.8</th>
<th align="left" valign="top">Gxx.9</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top"><p class="table"><em>40</em></p></td>
<td align="left" valign="top"><p class="table"><code>G40</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>41</em></p></td>
<td align="left" valign="top"><p class="table"><code>G41</code></p></td>
<td align="left" valign="top"><p class="table"><code>G41.1</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>42</em></p></td>
<td align="left" valign="top"><p class="table"><code>G42</code></p></td>
<td align="left" valign="top"><p class="table"><code>G42.1</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>43</em></p></td>
<td align="left" valign="top"><p class="table"><code>G43</code></p></td>
<td align="left" valign="top"><p class="table"><code>G43.1</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>44</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>45</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>46</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>47</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>48</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>49</em></p></td>
<td align="left" valign="top"><p class="table"><code>G40</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock unbreakable">
<table rules="all"
style="margin-left:auto; margin-right:auto;"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 6. Table_of_Allocated_G-codes_50-59</caption>
<col width="16%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<thead>
<tr>
<th align="center" valign="top">#  </th>
<th align="left" valign="top">Gxx </th>
<th align="left" valign="top">Gxx.1</th>
<th align="left" valign="top">Gxx.2</th>
<th align="left" valign="top">Gxx.3</th>
<th align="left" valign="top">Gxx.4</th>
<th align="left" valign="top">Gxx.5</th>
<th align="left" valign="top">Gxx.6</th>
<th align="left" valign="top">Gxx.7</th>
<th align="left" valign="top">Gxx.8</th>
<th align="left" valign="top">Gxx.9</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top"><p class="table"><em>50</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>51</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>52</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>53</em></p></td>
<td align="left" valign="top"><p class="table"><code>G53</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>54</em></p></td>
<td align="left" valign="top"><p class="table"><code>G54</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>55</em></p></td>
<td align="left" valign="top"><p class="table"><code>G55</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>56</em></p></td>
<td align="left" valign="top"><p class="table"><code>G56</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>57</em></p></td>
<td align="left" valign="top"><p class="table"><code>G57</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>58</em></p></td>
<td align="left" valign="top"><p class="table"><code>G58</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>59</em></p></td>
<td align="left" valign="top"><p class="table"><code>G59</code></p></td>
<td align="left" valign="top"><p class="table"><code>G59.1</code></p></td>
<td align="left" valign="top"><p class="table"><code>G59.2</code></p></td>
<td align="left" valign="top"><p class="table"><code>G59.3</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock unbreakable">
<table rules="all"
style="margin-left:auto; margin-right:auto;"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 7. Table_of_Allocated_G-codes_60-69</caption>
<col width="16%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<thead>
<tr>
<th align="center" valign="top">#  </th>
<th align="left" valign="top">Gxx </th>
<th align="left" valign="top">Gxx.1</th>
<th align="left" valign="top">Gxx.2</th>
<th align="left" valign="top">Gxx.3</th>
<th align="left" valign="top">Gxx.4</th>
<th align="left" valign="top">Gxx.5</th>
<th align="left" valign="top">Gxx.6</th>
<th align="left" valign="top">Gxx.7</th>
<th align="left" valign="top">Gxx.8</th>
<th align="left" valign="top">Gxx.9</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top"><p class="table"><em>60</em></p></td>
<td align="left" valign="top"><p class="table"><code>G60</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>61</em></p></td>
<td align="left" valign="top"><p class="table"><code>G61</code></p></td>
<td align="left" valign="top"><p class="table"><code>G61.1</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>62</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>63</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>64</em></p></td>
<td align="left" valign="top"><p class="table"><code>G64</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>65</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>66</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>67</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>68</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>69</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock unbreakable">
<table rules="all"
style="margin-left:auto; margin-right:auto;"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 8. Table_of_Allocated_G-codes_70-79</caption>
<col width="16%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<thead>
<tr>
<th align="center" valign="top">#  </th>
<th align="left" valign="top">Gxx </th>
<th align="left" valign="top">Gxx.1</th>
<th align="left" valign="top">Gxx.2</th>
<th align="left" valign="top">Gxx.3</th>
<th align="left" valign="top">Gxx.4</th>
<th align="left" valign="top">Gxx.5</th>
<th align="left" valign="top">Gxx.6</th>
<th align="left" valign="top">Gxx.7</th>
<th align="left" valign="top">Gxx.8</th>
<th align="left" valign="top">Gxx.9</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top"><p class="table"><em>70</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>71</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>72</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>73</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>74</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>75</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>76</em></p></td>
<td align="left" valign="top"><p class="table"><code>G76</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>77</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>78</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>79</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock unbreakable">
<table rules="all"
style="margin-left:auto; margin-right:auto;"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 9. Table_of_Allocated_G-codes_80-89</caption>
<col width="16%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<thead>
<tr>
<th align="center" valign="top">#  </th>
<th align="left" valign="top">Gxx </th>
<th align="left" valign="top">Gxx.1</th>
<th align="left" valign="top">Gxx.2</th>
<th align="left" valign="top">Gxx.3</th>
<th align="left" valign="top">Gxx.4</th>
<th align="left" valign="top">Gxx.5</th>
<th align="left" valign="top">Gxx.6</th>
<th align="left" valign="top">Gxx.7</th>
<th align="left" valign="top">Gxx.8</th>
<th align="left" valign="top">Gxx.9</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top"><p class="table"><em>80</em></p></td>
<td align="left" valign="top"><p class="table"><code>G80</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>81</em></p></td>
<td align="left" valign="top"><p class="table"><code>G81</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>82</em></p></td>
<td align="left" valign="top"><p class="table"><code>G82</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>83</em></p></td>
<td align="left" valign="top"><p class="table"><code>G83</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>84</em></p></td>
<td align="left" valign="top"><p class="table"><code>G84</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>85</em></p></td>
<td align="left" valign="top"><p class="table"><code>G85</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>86</em></p></td>
<td align="left" valign="top"><p class="table"><code>G86</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>87</em></p></td>
<td align="left" valign="top"><p class="table"><code>G87</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>88</em></p></td>
<td align="left" valign="top"><p class="table"><code>G88</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>89</em></p></td>
<td align="left" valign="top"><p class="table"><code>G89</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="tableblock unbreakable">
<table rules="all"
style="margin-left:auto; margin-right:auto;"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 10. Table_of_Allocated_G-codes_90-99</caption>
<col width="16%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<thead>
<tr>
<th align="center" valign="top">#  </th>
<th align="left" valign="top">Gxx </th>
<th align="left" valign="top">Gxx.1</th>
<th align="left" valign="top">Gxx.2</th>
<th align="left" valign="top">Gxx.3</th>
<th align="left" valign="top">Gxx.4</th>
<th align="left" valign="top">Gxx.5</th>
<th align="left" valign="top">Gxx.6</th>
<th align="left" valign="top">Gxx.7</th>
<th align="left" valign="top">Gxx.8</th>
<th align="left" valign="top">Gxx.9</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top"><p class="table"><em>90</em></p></td>
<td align="left" valign="top"><p class="table"><code>G90</code></p></td>
<td align="left" valign="top"><p class="table"><code>G90.1</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>91</em></p></td>
<td align="left" valign="top"><p class="table"><code>G91</code></p></td>
<td align="left" valign="top"><p class="table"><code>G91.1</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>92</em></p></td>
<td align="left" valign="top"><p class="table"><code>G92</code></p></td>
<td align="left" valign="top"><p class="table"><code>G92.1</code></p></td>
<td align="left" valign="top"><p class="table"><code>G92.2</code></p></td>
<td align="left" valign="top"><p class="table"><code>G92.3</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>93</em></p></td>
<td align="left" valign="top"><p class="table"><code>G93</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>94</em></p></td>
<td align="left" valign="top"><p class="table"><code>G94</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>95</em></p></td>
<td align="left" valign="top"><p class="table"><code>G95</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>96</em></p></td>
<td align="left" valign="top"><p class="table"><code>G96</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>97</em></p></td>
<td align="left" valign="top"><p class="table"><code>G97</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>98</em></p></td>
<td align="left" valign="top"><p class="table"><code>G98</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>99</em></p></td>
<td align="left" valign="top"><p class="table"><code>G99</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="remap:unallocated-m-codes">14.3. Currently unallocated M-codes:</h3>
<div class="paragraph"><p>These M-codes are currently undefined in the current implementation of LinuxCNC
and may be used to define new M-codes. (Developers who define new M-codes in
LinuxCNC are encouraged to remove them from this table.)</p></div>
<div class="tableblock unbreakable">
<table rules="all"
style="margin-left:auto; margin-right:auto;"
width="90%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 11. Table_of_Unallocated_M-codes_00-99</caption>
<col width="16%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<col width="8%" />
<thead>
<tr>
<th align="center" valign="top">#     </th>
<th align="left" valign="top">Mx0 </th>
<th align="left" valign="top">Mx1 </th>
<th align="left" valign="top">Mx2 </th>
<th align="left" valign="top">Mx3 </th>
<th align="left" valign="top">Mx4 </th>
<th align="left" valign="top">Mx5 </th>
<th align="left" valign="top">Mx6 </th>
<th align="left" valign="top">Mx7 </th>
<th align="left" valign="top">Mx8 </th>
<th align="left" valign="top">Mx9</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" valign="top"><p class="table"><em>00-09</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>10-19</em></p></td>
<td align="left" valign="top"><p class="table"><code>M10</code></p></td>
<td align="left" valign="top"><p class="table"><code>M11</code></p></td>
<td align="left" valign="top"><p class="table"><code>M12</code></p></td>
<td align="left" valign="top"><p class="table"><code>M13</code></p></td>
<td align="left" valign="top"><p class="table"><code>M14</code></p></td>
<td align="left" valign="top"><p class="table"><code>M15</code></p></td>
<td align="left" valign="top"><p class="table"><code>M16</code></p></td>
<td align="left" valign="top"><p class="table"><code>M17</code></p></td>
<td align="left" valign="top"><p class="table"><code>M18</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>20-29</em></p></td>
<td align="left" valign="top"><p class="table"><code>M20</code></p></td>
<td align="left" valign="top"><p class="table"><code>M21</code></p></td>
<td align="left" valign="top"><p class="table"><code>M22</code></p></td>
<td align="left" valign="top"><p class="table"><code>M23</code></p></td>
<td align="left" valign="top"><p class="table"><code>M24</code></p></td>
<td align="left" valign="top"><p class="table"><code>M25</code></p></td>
<td align="left" valign="top"><p class="table"><code>M26</code></p></td>
<td align="left" valign="top"><p class="table"><code>M27</code></p></td>
<td align="left" valign="top"><p class="table"><code>M28</code></p></td>
<td align="left" valign="top"><p class="table"><code>M29</code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>30-39</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code>M31</code></p></td>
<td align="left" valign="top"><p class="table"><code>M32</code></p></td>
<td align="left" valign="top"><p class="table"><code>M33</code></p></td>
<td align="left" valign="top"><p class="table"><code>M34</code></p></td>
<td align="left" valign="top"><p class="table"><code>M35</code></p></td>
<td align="left" valign="top"><p class="table"><code>M36</code></p></td>
<td align="left" valign="top"><p class="table"><code>M37</code></p></td>
<td align="left" valign="top"><p class="table"><code>M38</code></p></td>
<td align="left" valign="top"><p class="table"><code>M39</code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>40-49</em></p></td>
<td align="left" valign="top"><p class="table"><code>M40</code></p></td>
<td align="left" valign="top"><p class="table"><code>M41</code></p></td>
<td align="left" valign="top"><p class="table"><code>M42</code></p></td>
<td align="left" valign="top"><p class="table"><code>M43</code></p></td>
<td align="left" valign="top"><p class="table"><code>M44</code></p></td>
<td align="left" valign="top"><p class="table"><code>M45</code></p></td>
<td align="left" valign="top"><p class="table"><code>M46</code></p></td>
<td align="left" valign="top"><p class="table"><code>M47</code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>50-59</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code>M54</code></p></td>
<td align="left" valign="top"><p class="table"><code>M55</code></p></td>
<td align="left" valign="top"><p class="table"><code>M56</code></p></td>
<td align="left" valign="top"><p class="table"><code>M57</code></p></td>
<td align="left" valign="top"><p class="table"><code>M58</code></p></td>
<td align="left" valign="top"><p class="table"><code>M59</code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>60-69</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>70-79</em></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code></code></p></td>
<td align="left" valign="top"><p class="table"><code>M74</code></p></td>
<td align="left" valign="top"><p class="table"><code>M75</code></p></td>
<td align="left" valign="top"><p class="table"><code>M76</code></p></td>
<td align="left" valign="top"><p class="table"><code>M77</code></p></td>
<td align="left" valign="top"><p class="table"><code>M78</code></p></td>
<td align="left" valign="top"><p class="table"><code>M79</code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>80-89</em></p></td>
<td align="left" valign="top"><p class="table"><code>M80</code></p></td>
<td align="left" valign="top"><p class="table"><code>M81</code></p></td>
<td align="left" valign="top"><p class="table"><code>M82</code></p></td>
<td align="left" valign="top"><p class="table"><code>M83</code></p></td>
<td align="left" valign="top"><p class="table"><code>M84</code></p></td>
<td align="left" valign="top"><p class="table"><code>M85</code></p></td>
<td align="left" valign="top"><p class="table"><code>M86</code></p></td>
<td align="left" valign="top"><p class="table"><code>M87</code></p></td>
<td align="left" valign="top"><p class="table"><code>M88</code></p></td>
<td align="left" valign="top"><p class="table"><code>M89</code></p></td>
</tr>
<tr>
<td align="center" valign="top"><p class="table"><em>90-99</em></p></td>
<td align="left" valign="top"><p class="table"><code>M90</code></p></td>
<td align="left" valign="top"><p class="table"><code>M91</code></p></td>
<td align="left" valign="top"><p class="table"><code>M92</code></p></td>
<td align="left" valign="top"><p class="table"><code>M93</code></p></td>
<td align="left" valign="top"><p class="table"><code>M94</code></p></td>
<td align="left" valign="top"><p class="table"><code>M95</code></p></td>
<td align="left" valign="top"><p class="table"><code>M96</code></p></td>
<td align="left" valign="top"><p class="table"><code>M97</code></p></td>
<td align="left" valign="top"><p class="table"><code>M98</code></p></td>
<td align="left" valign="top"><p class="table"><code>M99</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>All M-codes from <code>M100</code> to <code>M199</code> are user-defined M-codes already,
and should not be remapped.</p></div>
<div class="paragraph"><p>All M-codes from <code>M200</code> to <code>M999</code> are available for remapping.</p></div>
</div>
<div class="sect2">
<h3 id="_readahead_time_and_execution_time">14.4. readahead time and execution time</h3>
<div class="paragraph"><p>foo</p></div>
</div>
<div class="sect2">
<h3 id="_plugin_pickle_hack">14.5. plugin/pickle hack</h3>
<div class="paragraph"><p>foo</p></div>
</div>
<div class="sect2">
<h3 id="_module_methods_classes_etc_reference">14.6. Module, methods, classes, etc reference</h3>
<div class="paragraph"><p>foo</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_extending_task_execution">15. Introduction: Extending Task Execution</h2>
<div class="sectionbody">
<div class="paragraph"><p>foo</p></div>
<div class="sect2">
<h3 id="_why_would_you_want_to_change_task_execution">15.1. Why would you want to change Task Execution?</h3>
<div class="paragraph"><p>foo</p></div>
</div>
<div class="sect2">
<h3 id="_a_diagram_task_interp_iocontrol_ui">15.2. A diagram: task, interp, iocontrol, UI (??)</h3>
<div class="paragraph"><p>foo</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_models_of_task_execution">16. Models of Task execution</h2>
<div class="sectionbody">
<div class="paragraph"><p>foo</p></div>
<div class="sect2">
<h3 id="_traditional_iocontrol_iocontrolv2_execution">16.1. Traditional iocontrol/iocontrolv2 execution</h3>
<div class="paragraph"><p>foo</p></div>
</div>
<div class="sect2">
<h3 id="_redefining_io_procedures">16.2. Redefining IO procedures</h3>
<div class="paragraph"><p>foo</p></div>
</div>
<div class="sect2">
<h3 id="_execution_time_python_procedures">16.3. Execution-time Python procedures</h3>
<div class="paragraph"><p>foo</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_a_short_survey_of_linuxcnc_program_execution">17. A short survey of LinuxCNC program execution</h2>
<div class="sectionbody">
<div class="paragraph"><p>To understand remapping of codes it might be helpful to survey the
execution  of task and interpreter as far as it relates to remapping.</p></div>
<div class="sect2">
<h3 id="_interpreter_state">17.1. Interpreter state</h3>
<div class="paragraph"><p>Conceptually, the interpreter&#8217;s state consist of variables which fall into
the following categories:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
configuration information (typically from INI file)
</p>
</li>
<li>
<p>
the <em>World model</em> - a representation of actual machine state
</p>
</li>
<li>
<p>
modal state and settings
</p>
</li>
<li>
<p>
interpreter execution state
</p>
</li>
</ol></div>
<div class="paragraph"><p>(3) refers to state which is <em>carried over</em> between executing
individual NGC codes - for instance, once the spindle is turned on and
the speed is set, it remains at this setting until turned off. The
same goes for many codes, like feed, units, motion modes (feed or
rapid)  and so forth.</p></div>
<div class="paragraph"><p>(4) holds information about the block currently executed, whether we
are in a subroutine, interpreter variables etc.</p></div>
<div class="paragraph"><p>Most of this state is aggregated in a - fairly unsystematic -
<code>structure _setup</code> (see interp_internals.hh).</p></div>
</div>
<div class="sect2">
<h3 id="_task_and_interpreter_interaction_queuing_and_read_ahead">17.2. Task and Interpreter interaction, Queuing and Read-Ahead</h3>
<div class="paragraph"><p>The task part of LinuxCNC is responsible for coordinating actual machine
commands - movement, HAL interactions and so forth. It does not by
itself handle the RS274NGC language. To do so, task calls upon the
interpreter to parse and execute the next command - either from MDI or
the current file.</p></div>
<div class="paragraph"><p>The interpreter execution generates canonical machine operations, which
actually move something. These are, however, not immediately executed but
put on a queue. The actual execution of these codes happens in the task
part of LinuxCNC: canon commands are pulled off that interpreter queue,
and executed resulting in actual machine movements.</p></div>
<div class="paragraph"><p>This means that typically the interpreter is far ahead of the actual
execution of commands - the parsing of the program might well be
finished before any noticeable movement starts. This behavior is
called <em>read-ahead</em>.</p></div>
</div>
<div class="sect2">
<h3 id="_predicting_the_machine_position">17.3. Predicting the machine position</h3>
<div class="paragraph"><p>To compute canonical machine operations in advance during read ahead,
the interpreter must be able to predict the machine position after
each line of Gcode, and that is not always possible.</p></div>
<div class="paragraph"><p>Let&#8217;s look at a simple example program which does relative moves
(G91), and assume the machine starts at x=0,y=0,z=0. Relative moves
imply that the outcome of the next move relies on the position of the
previous one:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">N10</span></span> <span style="font-weight: bold"><span style="color: #0000FF">G91</span></span>
<span style="font-style: italic"><span style="color: #9A1900">N20</span></span> <span style="font-weight: bold"><span style="color: #0000FF">G0</span></span> <span style="color: #FF6600">X</span><span style="color: #993399">10</span> <span style="color: #FF6600">Y</span><span style="font-weight: bold"><span style="color: #000000">-</span></span><span style="color: #993399">5</span> <span style="color: #FF6600">Z</span><span style="color: #993399">20</span>
<span style="font-style: italic"><span style="color: #9A1900">N30</span></span> <span style="font-weight: bold"><span style="color: #0000FF">G1</span></span> <span style="color: #FF6600">Y</span><span style="color: #993399">20</span> <span style="color: #FF6600">Z</span><span style="font-weight: bold"><span style="color: #000000">-</span></span><span style="color: #993399">5</span>
<span style="font-style: italic"><span style="color: #9A1900">N40</span></span> <span style="font-weight: bold"><span style="color: #0000FF">G0</span></span> <span style="color: #FF6600">Z</span><span style="color: #993399">30</span>
<span style="font-style: italic"><span style="color: #9A1900">N50</span></span> <span style="font-weight: bold"><span style="color: #0000FF">M2</span></span></tt></pre></div></div>
<div class="paragraph"><p>Here the interpreter can clearly predict machine positions for each line:</p></div>
<div class="paragraph"><p>After N20: x=10 y=-5 z=20; after N30: x=10 y=15 z=15; after N40: x=10 y=15 z=45</p></div>
<div class="paragraph"><p>and so can parse the whole program and generate canonical operations
well in advance.</p></div>
</div>
<div class="sect2">
<h3 id="_queue_busters_break_position_prediction">17.4. Queue-busters break position prediction</h3>
<div class="paragraph"><p>However, complete read ahead is only possible when the
interpreter can predict the position impact for <strong>every</strong> line in the
program in advance. Let&#8217;s look at a modified example:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900">N10</span></span> <span style="font-weight: bold"><span style="color: #0000FF">G91</span></span>
<span style="font-style: italic"><span style="color: #9A1900">N20</span></span> <span style="font-weight: bold"><span style="color: #0000FF">G0</span></span> <span style="color: #FF6600">X</span><span style="color: #993399">10</span> <span style="color: #FF6600">Y</span><span style="font-weight: bold"><span style="color: #000000">-</span></span><span style="color: #993399">5</span> <span style="color: #FF6600">Z</span><span style="color: #993399">20</span>
<span style="font-style: italic"><span style="color: #9A1900">N30</span></span> <span style="font-weight: bold"><span style="color: #0000FF">G38.3</span></span> <span style="color: #FF6600">Z</span><span style="font-weight: bold"><span style="color: #000000">-</span></span><span style="color: #993399">10</span>
<span style="font-style: italic"><span style="color: #9A1900">N40</span></span><span style="font-weight: bold"><span style="color: #000080"> O100 if</span></span> <span style="font-weight: bold"><span style="color: #000000">[</span></span><span style="color: #009900">#5070</span> <span style="font-weight: bold"><span style="color: #000000">EQ</span></span> <span style="color: #993399">0</span><span style="font-weight: bold"><span style="color: #000000">]</span></span>
<span style="font-style: italic"><span style="color: #9A1900">N50</span></span>    <span style="font-weight: bold"><span style="color: #0000FF">G1</span></span> <span style="color: #FF6600">Y</span><span style="color: #993399">20</span> <span style="color: #FF6600">Z</span><span style="font-weight: bold"><span style="color: #000000">-</span></span><span style="color: #993399">5</span>
<span style="font-style: italic"><span style="color: #9A1900">N60</span></span><span style="font-weight: bold"><span style="color: #000080"> O100 else</span></span>
<span style="font-style: italic"><span style="color: #9A1900">N70</span></span>    <span style="font-weight: bold"><span style="color: #0000FF">G0</span></span> <span style="color: #FF6600">Z</span><span style="color: #993399">30</span>
<span style="font-style: italic"><span style="color: #9A1900">N80</span></span><span style="font-weight: bold"><span style="color: #000080"> O100 endif</span></span>
<span style="font-style: italic"><span style="color: #9A1900">N90</span></span> <span style="font-weight: bold"><span style="color: #0000FF">G1</span></span> <span style="color: #FF6600">Z</span><span style="color: #993399">10</span>
<span style="font-style: italic"><span style="color: #9A1900">N95</span></span> <span style="font-weight: bold"><span style="color: #0000FF">M2</span></span></tt></pre></div></div>
<div class="paragraph"><p>To pre-compute the move in N90, the interpreter would need to know
where the machine is after line N80 - and that depends on whether the
probe command succeeded or not, which is not known until it&#8217;s actually
executed.</p></div>
<div class="paragraph"><p>So, some operations are incompatible with further read-ahead. These
are called <em>queue busters</em>, and they are:</p></div>
<div class="ulist"><ul>
<li>
<p>
reading a HAL pin&#8217;s value with M66: value of HAL pin not predictable
</p>
</li>
<li>
<p>
loading a new tool with M6: tool geometry not predictable
</p>
</li>
<li>
<p>
executing a probe with G38.n: final position and success/failure not predictable
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_how_queue_busters_are_dealt_with">17.5. How queue-busters are dealt with</h3>
<div class="paragraph"><p>Whenever the interpreter encounters a queue-buster, it needs to stop
read ahead and wait until the relevant result is available. The way
this works is:</p></div>
<div class="ulist"><ul>
<li>
<p>
when such a code is encountered, the interpreter returns a
special return code to task (<em>INTERP_EXECUTE_FINISH</em>).
</p>
</li>
<li>
<p>
this return code signals to task to stop read ahead for now, execute
all queued canonical commands built up so far (including the last one,
which is the queue buster), and then <em>synchronize
the interpreter state with the world model</em>. Technically, this means
updating internal variables to reflect HAL pin values, reload tool
geometries after an M6, and convey results of a probe.
</p>
</li>
<li>
<p>
The interpreter&#8217;s <em>synch()</em> method is called by task and does just
that - read all the world model <em>actual</em> values which are relevant for
further execution.
</p>
</li>
<li>
<p>
at this point, task goes ahead and calls the interpreter for more
  read ahead - until either the program ends or another queue-buster is encountered.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_word_order_and_execution_order">17.6. Word order and execution order</h3>
<div class="paragraph"><p>One or several <em>words</em> may be present on an NGC <em>block</em> if they are
compatible (some are mutually exclusive and must be on different
lines).  The execution model however prescribes a strict ordering of
execution of codes, regardless of their appearance on the source line
(<a href="../gcode/overview.html#gcode:order-of-execution">G-Code Order of Execution</a>).</p></div>
</div>
<div class="sect2">
<h3 id="_parsing">17.7. Parsing</h3>
<div class="paragraph"><p>Once a line is read (in either MDI mode, or from the current NGC
file), it is parsed and flags and parameters are set in a <em>struct
block</em> (struct _setup, member block1). This struct holds all information
about the current source line, but independent of different ordering
of codes on the current line: as long as several codes are compatible,
any source ordering will result in the same variables set in the
struct block. Right after parsing, all codes on a block are checked for
compatibility.</p></div>
</div>
<div class="sect2">
<h3 id="_execution">17.8. Execution</h3>
<div class="paragraph"><p>After successful parsing the block is executed by execute_block(), and
here the different items are handled according to execution order.</p></div>
<div class="paragraph"><p>If a "queue buster" is found, a corresponding flag is set in the
interpreter state (toolchange_flag, input_flag, probe_flag) and the
interpreter returns an INTERP_EXECUTE_FINISH return value, signaling
<em>stop readahead for now, and resynch</em> to the caller (<em>task</em>).
If no queue busters are found
after all items are executed, INTERP_OK is returned, signalling that
read-ahead may continue.</p></div>
<div class="paragraph"><p>When read ahead continues after the synch, task starts executing
interpreter read() operations again.  During the next read operation,
the above mentioned flags are checked and corresponding variables are
set (because the a synch() was just executed, the values are now
current). This means that the next command already executes in the
properly set variable context.</p></div>
</div>
<div class="sect2">
<h3 id="_procedure_execution">17.9. Procedure execution</h3>
<div class="paragraph"><p>O-word procedures complicate handling of queue busters a bit. A queue
buster might be found somewhere in a nested procedure, resulting in a
semi-finished procedure call when INTERP_EXECUTE_FINISH is
returned. Task makes sure to synchronize the world model, and continue
parsing and execution as long as there is still a procedure executing
(call_level &gt; 0).</p></div>
</div>
<div class="sect2">
<h3 id="remap:how-tool-change-currently-works">17.10. How tool change currently works</h3>
<div class="paragraph"><p>The actions happening in LinuxCNC are a bit involved, but it&#8217;s necessary
to get the overall idea what currently happens before you set out to
adapt those workings to your own needs.</p></div>
<div class="paragraph"><p>Note that remapping an existing code completely disables all internal
processing for that code. That means that beyond your desired
behavior - probably described through an NGC Oword or Python
procedure, you need to replicate those internal actions of the
interpreter which together result in a complete replacement of the
existing code. The prolog and epilog code is the place to do this.</p></div>
<div class="paragraph"><div class="title">How tool information is communicated</div><p>Several processes are <em>interested</em> in tool information: task and its
interpreter, as well as the user interface. Also, the <em>halui</em> process.</p></div>
<div class="paragraph"><p>Tool information is held in the <em>emcStatus</em> structure, which is
 shared by all parties. One of its fields is the <em>toolTable</em> array,
 which holds the description as loaded from the tool table file (tool
 number, diameter, frontangle, backangle and orientation for lathe,
 tool offset information).</p></div>
<div class="paragraph"><p>The authoritative source and only process actually <em>setting</em> tool
information in this structure is the <em>iocontrol</em> process. All others
processes just consult this structure. The interpreter holds actually
a local copy of the tool table.</p></div>
<div class="paragraph"><p>For the curious, the current emcStatus structure can be accessed by
<a href="remap.html#remap:executing-python-statements">Python statements</a>. The
interpreter&#8217;s perception of the tool currently loaded for instance is
accessed by:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>;py,from interpreter import *
;py,print this.tool_table[0]</code></pre>
</div></div>
<div class="paragraph"><p>To see fields in the global emcStatus structure, try this:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>;py,from emctask import *
;py,print emcstat.io.tool.pocketPrepped
;py,print emcstat.io.tool.toolInSpindle
;py,print emcstat.io.tool.toolTable[0]</code></pre>
</div></div>
<div class="paragraph"><p>You need to have LinuxCNC started from a terminal window to see the
results.</p></div>
</div>
<div class="sect2">
<h3 id="_how_tx_prepare_tool_works">17.11. How Tx (Prepare Tool) works</h3>
<div class="paragraph" id="remap:interpreter-action-on-t"><div class="title">Interpreter action on a Tx command</div><p>All the interpreter does is evaluate the toolnumber parameter, looks up
its corresponding pocket, remembers it in the <code>selected_pocket</code>
variable for later, and  queues a canon command
(SELECT_POCKET). See <em>Interp::convert_tool_select</em> in <em>src/emc/rs274/interp_execute.cc</em>.</p></div>
<div class="paragraph"><div class="title">Task action on SELECT_POCKET</div><p>When task gets around to handle a SELECT_POCKET, it sends a
EMC_TOOL_PREPARE message to the iocontrol process, which handles most
tool-related actions in LinuxCNC.</p></div>
<div class="paragraph"><p>In the current implementation, task actually waits for iocontrol to
complete the changer positioning operation, which is not necessary IMO
- it defeats the idea that changer preparation and code execution can
proceed in parallel.</p></div>
<div class="paragraph"><div class="title">Iocontrol action on EMC_TOOL_PREPARE</div><p>When iocontrol sees the select pocket command, it does the related HAL
pin wiggling - it sets the "tool-prep-number" pin to indicate which
tool is next, raises the "tool-prepare" pin, and waits for the
"tool-prepared" pin to go high.</p></div>
<div class="paragraph"><p>When the changer responds by asserting "tool-prepared", it considers
the prepare phase to be completed and signals task to
continue. (again, this <em>wait</em> istn strictly necessary IMO)</p></div>
<div class="paragraph"><div class="title">Building the prolog and epilog for Tx</div><p>See the Python functions <code>prepare_prolog</code> and <code>prepare_epilog</code> in
<code>configs/sim/axis/remap/toolchange/python/toolchange.py</code>.</p></div>
</div>
<div class="sect2">
<h3 id="_how_m6_change_tool_works">17.12. How M6 (Change tool) works</h3>
<div class="paragraph"><p>You need to understand this fully before you can adapt it. It is very
relevant to writing a prolog and epilog handler for a remapped
M6. Remapping an existing codes means you disable the internal steps
taken normally, and replicate them as far as needed for your own
purposes.</p></div>
<div class="paragraph"><p>Even if you are not familiar with C, I suggest you look at the
<em>Interp::convert_tool_change</em> code in
<em>src/emc/rs274/interp_convert.cc</em>.</p></div>
<div class="paragraph" id="remap:interpreter-action-on-m6"><div class="title">Interpreter action on a M6 command</div><p>When the interpreter sees an M6, it:</p></div>
<div class="olist arabic" id="remap:send-tool-load-msg"><ol class="arabic">
<li>
<p>
checks whether a T command has already been executed (test
<em>settings-&gt;selected_pocket</em> to be &gt;= 0) and fail with <em>Need tool
prepared -Txx- for toolchange</em> message if not.
</p>
</li>
<li>
<p>
check for cutter compensation being active, and fail with <em>Cannot
change tools with cutter radius compensation on</em> if so.
</p>
</li>
<li>
<p>
stop the spindle except if the "TOOL_CHANGE_WITH_SPINDLE_ON" ini
option is set.
</p>
</li>
<li>
<p>
generate a rapid <em>Z up</em> move if if the "TOOL_CHANGE_QUILL_UP" ini
option is set.
</p>
</li>
<li>
<p>
if TOOL_CHANGE_AT_G30 was set:
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
move the A, B and C indexers if applicable
</p>
</li>
<li>
<p>
generate rapid move to the G30 position
</p>
</li>
</ol></div>
</li>
<li>
<p>
execute a CHANGE_TOOL canon command,with the selected pocket as
parameter. CHANGE_TOOL will:
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
generate a rapid move to TOOL_CHANGE_POSITION if so set in ini
</p>
</li>
<li>
<p>
enqueue an EMC_TOOL_LOAD NML message to task.
</p>
</li>
</ol></div>
</li>
<li>
<p>
set the numberer parameters 5400-5413 according to the new tool
</p>
</li>
<li>
<p>
signal to task to stop calling the interpreter for readahead by
returning INTERP_EXECUTE_FINISH since M6 is a queue buster.
</p>
</li>
</ol></div>
<div class="paragraph"><div class="title">What task does when it sees a CHANGE_TOOL command</div><p>Again, not much more than passing the buck to iocontrol by sending it
an EMC_TOOL_LOAD message, and waiting until iocontrol has done its
thing.</p></div>
<div class="olist arabic" id="remap:iocontrol-action-on-load"><div class="title">Iocontrol action on EMC_TOOL_LOAD</div><ol class="arabic">
<li>
<p>
it asserts the "tool-change" pin
</p>
</li>
<li>
<p>
it waits for the "tool-changed" pin to become active
</p>
</li>
<li>
<p>
when that has happened:
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
deassert "tool-change"
</p>
</li>
<li>
<p>
set "tool-prep-number" and "tool-prep-pocket" pins to zero
</p>
</li>
<li>
<p>
execute the <em>load_tool()</em> function with the pocket as parameter.
</p>
</li>
</ol></div>
</li>
</ol></div>
<div class="paragraph"><p>The last step actually sets the tooltable entries in the <em>emcStatus</em>
structure. The actual action taken depends on whether the
RANDOM_TOOLCHANGER ini option was set, but at the end of the process
<em>toolTable[0]</em> reflects the tool currently in the spindle.</p></div>
<div class="paragraph"><p>When that has happened:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
iocontrol signals task to go ahead
</p>
</li>
<li>
<p>
task tells the interpreter to execute a <em>synch()</em> operation, to see
what has changed
</p>
</li>
<li>
<p>
the interpreter <em>synch()</em> pulls all information from the world model
needed, among it the changed tool table.
</p>
</li>
</ol></div>
<div class="paragraph"><p>From there on, the interpreter has complete  knowledge of the world
model and continues with read ahead.</p></div>
<div class="paragraph"><div class="title">Building the prolog and epilog for M6</div><p>See the Python functions <code>change_prolog</code> and <code>change_epilog</code> in
<code>configs/sim/axis/remap/toolchange/python/toolchange.py</code>.</p></div>
</div>
<div class="sect2">
<h3 id="_how_m61_change_tool_number_works">17.13. How M61 (Change tool number) works</h3>
<div class="paragraph"><p>M61 requires a non-negative `Q`parameter (tool number). If zero, this
means <em>unload tool</em>, else <em>set current tool number to Q</em>.</p></div>
<div class="paragraph"><div class="title">Building the replacement for M61</div><p>An example Python redefinition for M61 can be found in the
<code>set_tool_number</code> function in
<code>configs/sim/axis/remap/toolchange/python/toolchange.py</code>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_status">18. Status</h2>
<div class="sectionbody">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
the RELOAD_ON_CHANGE feature is fairly broken. Restart after
changing a Python file.
</p>
</li>
<li>
<p>
M61 (remapped or not) is broken in iocontrol and requires
iocontrol-v2 to actually work.
</p>
</li>
</ol></div>
</div>
</div>
<div class="sect1">
<h2 id="_changes">19. Changes</h2>
<div class="sectionbody">
<div class="ulist"><ul>
<li>
<p>
the method to return error messages and fail used to be
  <em>self.set_errormsg(text)</em> followed by <em>return INTERP_ERROR</em>. This
  has been replaced by merely returning a string from a Python handler
  or oword subroutine. This sets the error message and aborts the
  program. Previously there was no clean way to abort a Python oword
  subroutine.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1">
<h2 id="_debugging">20. Debugging</h2>
<div class="sectionbody">
<div class="paragraph"><p>In the <em>[EMC]</em> section of the ini file the <em>DEBUG</em> parameter can be changed to
get various levels of debug messages when LinuxCNC is started from a terminal.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Debug level, 0 means no messages. See src/emc/nml_intf/debugflags.h for others
DEBUG = 0x00000002 # configuration
DEBUG = 0x7FFFDEFF # no interp,oword
DEBUG = 0x00008000 # py only
DEBUG = 0x0000E000 # py + remap + Oword
DEBUG = 0x0000C002 # py + remap + config
DEBUG = 0x0000C100 # py + remap + Interpreter
DEBUG = 0x0000C140 # py + remap + Interpreter + NML msgs
DEBUG = 0x0000C040 # py + remap + NML
DEBUG = 0x0003E100 # py + remap + Interpreter + oword + signals + namedparams
DEBUG = 0x10000000 # EMC_DEBUG_USER1 - trace statements
DEBUG = 0x20000000 # EMC_DEBUG_USER2 - trap into Python debugger
DEBUG = 0x10008000 # USER1, PYTHON
DEBUG = 0x30008000 # USER1,USER2, PYTHON # USER2 will cause involute to try to connect to pydev
DEBUG = 0x7FFFFFFF # All debug messages</code></pre>
</div></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2022-11-24 07:38:35 MST
</div>
</div>
</body>
</html>
