<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.10" />
<title>HAL Tools</title>
<link rel="stylesheet" href="..//asciidoc.css" type="text/css" />


<link rel="stylesheet" href="..//linuxcnc.css" type="text/css" />
<script type="text/javascript" src="..//asciidoc.js"></script>
<script type="text/javascript">
/*<![CDATA[*/
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="book">
<div id="header">
<h1>HAL Tools</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="sec:halcmd">1. Halcmd</h2>
<div class="sectionbody">
<div class="paragraph"><p>Halcmd is a command line tool for manipulating the HAL. There is a
rather complete man page for halcmd, which will be installed if you
have installed LinuxCNC from either source or a package. The manpage
provides usage info:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>man halcmd</code></pre>
</div></div>
<div class="paragraph"><p>If you have compiled LinuxCNC for “run-in-place”, you must source
the rip-environment script to make the man page available:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>cd toplevel_directory_for_rip_build
. scripts/rip-environment
man halcmd</code></pre>
</div></div>
<div class="paragraph"><p>The <a href="tutorial.html#cha:hal-tutorial">HAL Tutorial</a> has a number of examples of halcmd
usage, and is a good tutorial for halcmd.</p></div>
<div class="paragraph"><p><a id="sec:halmeter"></a></p></div>
</div>
</div>
<div class="sect1">
<h2 id="_halmeter">2. Halmeter</h2>
<div class="sectionbody">
<div class="paragraph"><p>Halmeter is a <em>voltmeter</em> for the HAL. It lets you look at a pin,
signal, or parameter, and displays the current value of that item. It
is pretty simple to use. Start it by typing <strong>halmeter</strong> in an X
windows shell. Halmeter is a GUI application. It will pop up
a small window, with two buttons labeled <em>Select</em> and <em>Exit</em>. Exit is
easy - it shuts down the program. Select pops up a larger window, with
three tabs. One tab lists all the pins currently defined in the HAL.
The next lists all the signals, and the last tab lists all the
parameters. Click on a tab, then click on a pin/signal/parameter. Then
click on <em>OK</em>. The lists will disappear, and the small window will
display the name and value of the selected item. The display is updated
approximately 10 times per second. If you click <em>Accept</em> instead of
<em>OK</em>, the small window will display the name and value of the selected
item, but the large window will remain on the screen. This is
convenient if you want to look at a number of different items quickly.</p></div>
<div class="paragraph"><p>You can have many halmeters running at the same time, if you want to
monitor several items. If you want to launch a halmeter without tying
up a shell window, type <em>halmeter &amp;</em> to run it in the background.
You can also make halmeter start
displaying a specific item immediately, by adding <em>pin|sig|par[am]
&lt;name&gt;</em> to the command line. It will display the pin, signal, or
parameter
&lt;name&gt; as soon as it starts. (If there is no such item, it will simply
start normally.) And finally, if you specify an item to display, you
can add <em>-s</em> before the pin|sig|param to tell halmeter to use a small
window. The item name will be displayed in the title bar instead of
under the value, and there will be no buttons. Useful when you want a
lot of meters in a small amount of screen space.</p></div>
<div class="paragraph"><p>Refer to <a href="tutorial.html#sec:tutorial-halmeter">Halmeter Tutorial</a> section for more
information.</p></div>
<div class="paragraph"><p>Halmeter can be loaded from a terminal or from Axis. Halmeter is
faster than Halshow at displaying values. Halmeter has two windows, one
to pick the pin, signal, or parameter to monitor and one that displays
the value. Multiple Halmeters can be open at the same time. If you use
a script to open multiple Halmeters you can set the position of each
one with -g X Y relative to the upper left corner of your screen.
For example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>loadusr halmeter pin hm2.0.stepgen.00.velocity-fb -g 0 500</code></pre>
</div></div>
<div class="paragraph"><p>See the man page for more options. See section <a href="tools.html#sec:halmeter">Halmeter</a>.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/hal-meter01.png" alt="Halmeter" />
</div>
<div class="title">Figure 1. Halmeter</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/hal-meter02.png" alt="Halmeter" />
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_halshow">3. Halshow</h2>
<div class="sectionbody">
<div class="paragraph"><p>Halshow (<a href="halshow.html#cha:halshow">complete usage description</a>)
can be started from the command line to show details for selected
components, pins, parameters, signals, functions, and threads of a running HAL.
The WATCH tab provides a continuous display of selected pin, parameters, and
signal items.  The File menu provides buttons to 1) save the watch items to
a watch list and to load and existing watch list.  The watch list items can
also be loaded automatically on startup.  For command line usage:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>halshow --help
Usage:
  halshow [Options] [watchfile]
  Options:
           --help    (this help)
           --fformat format_string_for_float
           --iformat format_string_for_int

Notes:
       Create watchfile in halshow using: 'File/Save Watch List'
       linuxcnc must be running for standalone usage</code></pre>
</div></div>
<div class="paragraph"><p>LinuxCNC must be running for standalone usage</p></div>
<div class="paragraph"><p>A watchfile created using the <em>File/Save Watch List</em> menu item
is formatted as a single line with tokens "pin+", "param+", "sig=+"
followed by the appropriate pin, param, or signal name.  The
token-name pairs are separated by a space character.</p></div>
<div class="paragraph"><p>Example:
   pin+joint.0.pos-hard-limit pin+joint.1.pos-hard-limit sig+estop-loop</p></div>
<div class="paragraph"><p>A watchfile created using the <em>File/Save Watch List (multiline)</em> menu item
is formatted with separate lines for each item identified with token-name
pairs as described above.</p></div>
<div class="paragraph"><p>Example:
   pin+joint.0.pos-hard-limit
   pin+joint.1.pos-hard-limit
   sig+estop-loop</p></div>
<div class="paragraph"><p>When loading a watchfile with the <em>File/Load Watch List</em> menu item, the
token-name pairs may appear as single or mulitple lines.  Blank lines and
lines beginning with a # character are ignored.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="sec:halscope">4. Halscope</h2>
<div class="sectionbody">
<div class="paragraph"><p>Halscope is an <em>oscilloscope</em> for the HAL. It lets you capture the
value of pins, signals, and parameters as a function of time. Complete
operating instructions should be located here eventually. For now,
refer to section  <a href="tutorial.html#sec:tutorial-halscope">[sec:tutorial-halscope]</a> in the tutorial chapter,
which explains the basics.</p></div>
<div class="paragraph"><p>The halscope File menu selector provides buttons to save a configuration
or open a previously saved configuration.  When halscope is terminated,
the last configuration is saved in a file named autosave.halscope.</p></div>
<div class="paragraph"><p>Configuration files may also be specified when starting halscope from
the commandline.  Commandline help (-h) usage:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>halscope -h
Usage:
  halscope [-h] [-i infile] [-o outfile] [num_samples]</code></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_sim_pin">5. Sim Pin</h2>
<div class="sectionbody">
<div class="paragraph"><p>sim_pin is a command line utility to display and update any number of
writable pins, parameters or signals.  Usage:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>  Usage:
         sim_pin [Options] name1 [name2 ...] &amp;

  Options:
         --help                (this text)
         --title title_string  (window title, default: sim_pin)

  Note:  LinuxCNC (or a standalone Hal application) must be running
         A named item can specify a pin, param, or signal
         The item must be writable, e.g.:
            pin:    IN or I/O (and not connected to a signal with a writer)
            param:  RW
            signal: connected to a writable pin

         Hal item types bit,s32,u32,float are supported

         When a bit item is specifed, a pushbutton is created
         to manage the item in one of three manners specified
         by radio buttons:
             toggle: Toggle value when button pressed
             pulse:  Pulse item to 1 once when button pressed
             hold:   Set to 1 while button pressed
         The bit pushbutton mode can be specifed on the command
         line by formatting the item name:
             namei/mode=[toggle | pulse | hold]
         If the mode begins with an uppercase letter, the radio
         buttons for selecting other modes are not shown</code></pre>
</div></div>
<div class="paragraph"><p>For complete information, see the man page:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>man sim_pin</code></pre>
</div></div>
<div class="paragraph"><p>Example (with LinuxCNC running):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>halcmd loadrt mux2 names=example; halcmd net sig_example example.in0
sim_pin example.sel example.in1 sig_example &amp;</code></pre>
</div></div>
<div class="imageblock">
<div class="content">
<img src="images/sim_pin.png" alt="sim_pin is a command line utility to display and update any number of writable pins, parameters or signals" />
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_simulate_probe">6. Simulate Probe</h2>
<div class="sectionbody">
<div class="paragraph"><p>simulate_probe is a simple gui to simulate activation of the pin
motion.probe-input.  Usage:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>simulate_probe &amp;</code></pre>
</div></div>
<div class="imageblock">
<div class="content">
<img src="images/simulate_probe.png" alt="simulate_probe is a simple gui to simulate activation of the pin motion.probe-input" />
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hal_histogram">7. Hal Histogram</h2>
<div class="sectionbody">
<div class="paragraph"><p>hal-histogram is a command line utility to display histograms for hal pins.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Usage:
   hal-histogram --help | -?
or
   hal-histogram [Options] [pinname]

Options:
  --minvalue  minvalue (minimum bin, default: 0)
  --binsize   binsize  (binsize, default: 100)
  --nbins     nbins    (number of bins, default: 50)

  --logscale  0|1      (y axis log scale, default: 1)
  --text      note     (text display, default: "" )
  --show               (show count of undisplayed nbins, default off)
  --verbose            (progress and debug, default off)

Notes:
  1) LinuxCNC (or another Hal application) must be running
  2) If no pinname is specified, default is: motion-command-handler.time
  3) This app may be opened for 5 pins
  4) pintypes float, s32, u32, bit are supported
  5) The pin must be associated with a thread supporting floating point
     For a base thread, this may require using:
     loadrt motmod ... base_thread_fp=1</code></pre>
</div></div>
<div class="imageblock">
<div class="content">
<img src="images/hal-histogram.png" alt="hal-histogram is a command line utility to display histograms for hal pins" />
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_halreport">8. Halreport</h2>
<div class="sectionbody">
<div class="paragraph"><p>halreport is a command-line utility that generates a report about hal
connections for a running LinuxCNC (or other hal) application.  The
report shows all signal connections and flags potential problems.
Information included:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
System description and kernel version.
</p>
</li>
<li>
<p>
Signals and all connected output, io, and input pins.
</p>
</li>
<li>
<p>
Each pin&#8217;s component_function, thread, and addf-order.
</p>
</li>
<li>
<p>
Userspace component pins having non-ordered functions.
</p>
</li>
<li>
<p>
Identification of unknown functions for unhandled components.
</p>
</li>
<li>
<p>
Signals   with no output.
</p>
</li>
<li>
<p>
Signals   with no inputs.
</p>
</li>
<li>
<p>
Functions with no addf.
</p>
</li>
<li>
<p>
Warning tags for components marked as deprecated/obsolete in docs.
</p>
</li>
<li>
<p>
Real names for pins that use alias names.
</p>
</li>
</ol></div>
<div class="paragraph"><p>The report can be generated from the command line and directed to
an output file (or stdout if no outfilename is specified):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>Usage:
  halreport -h | --help (this help)
or
  halreport [outfilename]</code></pre>
</div></div>
<div class="paragraph"><p>To generate the report for every LinuxCNC startup, include halreport
and an output filename as an [APPLICATIONS]APP entry in the ini file.
Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[APPLICATIONS]
APP = halreport /tmp/halreport.txt</code></pre>
</div></div>
<div class="paragraph"><p>The function addf-ordering can be important for servo loops where
the sequence of the functions computed at each servo period is
important.  Typically, the order is: read input pins, do the
motion command-handler and motion-controller functions, perform
pid calculations, and finally write output pins.</p></div>
<div class="paragraph"><p>For each signal in a critical path, the addf-order of the output
pin should be numerically lower than the addf-order of the
critical input pins that it connects to.</p></div>
<div class="paragraph"><p>For routine signal paths that handle switch inputs, user-space
pins, etc., the addf-ordering is often not critical.  Moreover,
the timing of user-space pin value changes cannot be controlled
or guaranteed at the intervals typically employed for hal threads.</p></div>
<div class="paragraph"><p>Example report file excerpts showing a pid loop for a hostmot2
stepgen operated in velocity mode on a trivkins machine with
joint.0 corresponding to the X axis coordinate:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>SIG:    pos-fb-0
  OUT:    h.00.position-fb                     hm2_7i92.0.read        servo-thread 001
          (=hm2_7i92.0.stepgen.00.position-fb)
    IN:     X_pid.feedback                     X_pid.do-pid-calcs     servo-thread 004
    IN:     joint.0.motor-pos-fb               motion-command-handler servo-thread 002
            ....................               motion-controller      servo-thread 003
...
SIG:    pos-cmd-0
  OUT:    joint.0.motor-pos-cmd                motion-command-handler servo-thread 002
          .....................                motion-controller      servo-thread 003
    IN:     X_pid.command                      X_pid.do-pid-calcs     servo-thread 004
...
SIG:    motor-cmd-0
  OUT:    X_pid.output                         X_pid.do-pid-calcs     servo-thread 004
    IN:     h.00.velocity-cmd                  hm2_7i92.0.write       servo-thread 008
            (=hm2_7i92.0.stepgen.00.velocity-cmd)</code></pre>
</div></div>
<div class="paragraph"><p>In the example above, the HALFILE uses halcmd aliases to simplify pin names
for an hostmot2 fpga board with commands like:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>alias pin hm2_7i92.0.stepgen.00.position-fb h.00.position-fb</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Questionable component function detection may occur for 1)
unsupported (deprecated) components, 2) user-created components
that use multiple functions or unconventional function naming, or
3) gui-created userspace components that lack distinguishing
characteristics such as a prefix based on the gui program name.
Questionable functions are tagged with a question mark "?".</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Component pins that cannot be associated with a known thread
function report the function as "Unknown".</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">halreport generates a connections report for a running hal
application to aid in designing and verifying connections.  Pin
types and current values are not shown.  For this information use
applications like halshow, halmeter, halscope or the <em>show</em>
command available with comand-line halcmd program.</td>
</tr></table>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2022-11-24 07:38:35 MST
</div>
</div>
</body>
</html>
