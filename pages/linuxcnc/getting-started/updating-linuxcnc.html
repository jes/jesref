<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.10" />
<title>Updating LinuxCNC</title>
<link rel="stylesheet" href="..//asciidoc.css" type="text/css" />


<link rel="stylesheet" href="..//linuxcnc.css" type="text/css" />
<script type="text/javascript" src="..//asciidoc.js"></script>
<script type="text/javascript">
/*<![CDATA[*/
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="book">
<div id="header">
<h1>Updating LinuxCNC</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph" id="cha:updating-linuxcnc"><p>Updating LinuxCNC to a new minor release (ie to a new version in
the same stable series, for example from 2.7.0 to 2.7.1) is an
automatic process if your PC is connected to the internet. You will
see an update prompt after a minor release along with other software
updates. If you don&#8217;t have an internet connection to your PC see
<a href="updating-linuxcnc.html#getting-started:update-no-network">Updating without Network</a>.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_upgrade_to_the_new_version">1. Upgrade to the new version</h2>
<div class="sectionbody">
<div class="paragraph"><p>This section describes how to upgrade LinuxCNC from version 2.7 to the
new 2.8.0 version.  It assumes that you have an existing 2.7 install that you
want to update.</p></div>
<div class="paragraph"><p>To upgrade LinuxCNC from a version older than 2.7, you have to first
<a href="http://linuxcnc.org/docs/2.7/html/getting-started/updating-linuxcnc.html">upgrade
your old install to 2.7</a>, then follow these instructions to upgrade to
the new version.</p></div>
<div class="paragraph"><p>If you do not have an old version of LinuxCNC to upgrade, then you&#8217;re
best off making a fresh install of the new version as described in the
section <a href="getting-linuxcnc.html#cha:getting-linuxcnc">Getting LinuxCNC</a>.</p></div>
<div class="paragraph"><p>Furthermore, if you are running Ubuntu Precise or Debian Wheezy it is
well worth considering making a backup of the "linuxcnc" directory on
removeable media and performing a
<a href="getting-linuxcnc.html#cha:getting-linuxcnc">clean install of a newer OS and LinuxCNC version</a>
as these releases were EOL in 2017 and 2018 respectively.
If you are running on Ubuntu Lucid then you will have to do this, as
Lucid is no longer supported by LinuxCNC (it was EOL in 2013)</p></div>
<div class="paragraph"><p>To upgrade major versions like 2.7 to 2.8 when you have a network connection at
the machine you need to disable the old linuxcnc.org apt sources and add a new
linuxcnc.org apt source for 2.7, then upgrade LinuxCNC.</p></div>
<div class="paragraph"><p>The details will depend on which platform you&#8217;re running on.  Open a
<a href="../common/linux-faq.html#faq:terminal">terminal</a> then type <code>lsb_release -ic</code> to find this information
out:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>lsb_release -ic
Distributor ID: Debian
Codename:       wheezy</code></pre>
</div></div>
<div class="paragraph"><p>You should be running on Debian Stretch or Wheezy (as above), or Ubuntu
Precise. Packages are also avaialble for Debian Jessie or Debian Buster
if you happen to already be running one of those.</p></div>
<div class="paragraph"><p>You will also need to check which realtime kernel is being used:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>uname -r
4.19.0-9-rt-amd64</code></pre>
</div></div>
<div class="paragraph"><p>If you see (as above) <code>-rt-</code> in the kernel name then you are running the
preempt-rt kernel and should install the "uspace" version of linuxcnc.
You should also install uspace for "sim" configs on non-realtime kernels</p></div>
<div class="paragraph"><p>If you see <code>-rtai-</code> in the kernel name then you are running RTAI
realtime. See below for the linuxcnc version to install.</p></div>
<div class="sect2">
<h3 id="_setting_apt_sources">1.1. Setting apt sources</h3>
<div class="ulist"><ul>
<li>
<p>
Open the <code>Software Sources</code> window. The process for doing this
  differs slightly on the three supported platforms:
</p>
<div class="ulist"><ul>
<li>
<p>
Debian:
</p>
<div class="ulist"><ul>
<li>
<p>
Click on <code>Applications Menu</code>, then <code>System</code>, then
  <code>Synaptic Package Manager</code>.
</p>
</li>
<li>
<p>
In Synaptic, click on the <code>Settings</code> menu, then click <code>Repositories</code>
  to open the <code>Software Sources</code> window.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Ubuntu:
</p>
<div class="ulist"><ul>
<li>
<p>
Click on the <code>Dash Home</code> icon in the top left.
</p>
</li>
<li>
<p>
In the <code>Search</code> field, type "software", then click on the <code>Ubuntu
  Software Center</code> icon.
</p>
</li>
<li>
<p>
In the Ubuntu Software Center window, click on the <code>Edit</code> menu,
  then click on <code>Software Sources...</code> to open the <code>Software Sources</code>
  window.
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
<li>
<p>
In the <code>Software Sources</code> window, select the <code>Other Software</code> tab.
</p>
</li>
<li>
<p>
Delete or un-check all the old linuxcnc.org entries (leave all
  non-linuxcnc.org lines as they are).
</p>
</li>
<li>
<p>
Click the <code>Add</code> button and add a new apt line. The line will be
  slightly different on the different platforms:
</p>
</li>
</ul></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top"> Platform                </th>
<th align="left" valign="top"> apt source line</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">Debian Stretch</p></td>
<td align="left" valign="top"><p class="table"><code>deb http://linuxcnc.org stretch base 2.8-rtpreempt</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Debian Wheezy</p></td>
<td align="left" valign="top"><p class="table"><code>deb http://linuxcnc.org wheezy base 2.8-rt</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Ubuntu Precise</p></td>
<td align="left" valign="top"><p class="table"><code>deb http://linuxcnc.org precise base 2.8-rt</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Debian Jessie - preempt</p></td>
<td align="left" valign="top"><p class="table"><code>deb http://linuxcnc.org jessie base 2.8-rtpreempt</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Debian Jessie - RTAI</p></td>
<td align="left" valign="top"><p class="table"><code>deb http://linuxcnc.org jessie base 2.8-rt</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Debian Buster - preempt</p></td>
<td align="left" valign="top"><p class="table"><code>deb http://linuxcnc.org buster base 2.8-rtpreempt</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">Debian Buster - RTAI</p></td>
<td align="left" valign="top"><p class="table"><code>deb http://linuxcnc.org buster base 2.8-rt</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="imageblock" style="text-align:left;">
<div class="content">
<img src="images/upgrading-to-2.8.png" alt="Setting apt sources" />
</div>
</div>
<div class="ulist"><ul>
<li>
<p>
Click <code>Add Source</code>, then <code>Close</code> in the Software Sources window.
  If it pops up a window informing you that the information about
  available software is out-of-date, click the <code>Reload</code> button.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_upgrading_to_the_new_version">1.2. Upgrading to the new version</h3>
<div class="paragraph"><p>Now your computer knows where to get the new version of the software,
next we need to install it.</p></div>
<div class="paragraph"><p>The process again differs depending on your platform.</p></div>
<div class="sect3">
<h4 id="_debian_wheezy_amp_stretch_and_ubuntu_lucid">1.2.1. Debian Wheezy &amp; Stretch and Ubuntu Lucid</h4>
<div class="paragraph"><p>Debian Wheezy and Stretch both use the Synaptic Package Manager.</p></div>
<div class="ulist"><ul>
<li>
<p>
Open Synaptic using the instructions in <a href="updating-linuxcnc.html#_setting_apt_sources">Setting   apt sources</a> above.
</p>
</li>
<li>
<p>
Click the <code>Reload</code> button.
</p>
</li>
<li>
<p>
Use the Search function to search for <code>linuxcnc</code>.
</p>
</li>
<li>
<p>
The package is called "linuxcnc" for RTAI kernels and "linuxcnc-uspace"
  for preempt-rt.
</p>
</li>
<li>
<p>
Click the check box to mark the new linuxcnc and linuxcnc-doc-*
  packages for upgrade. The package manager may select a number of
  additional packages to be installed, to satisfy dependencies that the
  new linuxcnc package has.
</p>
</li>
<li>
<p>
Click the <code>Apply</code> button, and let your computer install the new
  package. The old linuxcnc package will be automatically upgraded to
  the new one.
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_ubuntu_precise">1.3. Ubuntu Precise</h3>
<div class="ulist"><ul>
<li>
<p>
Click on the <code>Dash Home</code> icon in the top left.
</p>
</li>
<li>
<p>
In the <code>Search</code> field, type "update", then click on the <code>Update Manager</code>
  icon.
</p>
</li>
<li>
<p>
Click the <code>Check</code> button to fetch the list of packages available.
</p>
</li>
<li>
<p>
Click the <code>Install Updates</code> button to install the new versions of
  all packages.
</p>
</li>
</ul></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started:update-no-network">2. Updating without Network</h2>
<div class="sectionbody">
<div class="paragraph"><p>To update without a network connection you need to download the deb then install
it with dpkg. The debs can be found in <a href="http://linuxcnc.org/dists/">http://linuxcnc.org/dists/</a>
You have to drill down from the above link to find the correct deb for your
installation. Open a <a href="../common/linux-faq.html#faq:terminal">terminal</a> and type in <em>lsb_release -ic</em>
to find the name of your OS.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>&gt; lsb_release -ic
Distributor ID: Debian
Codename:       buster</code></pre>
</div></div>
<div class="paragraph"><p>Pick the OS from the list then pick the major version you want like
2.8-rt for RTAI or 2.8-rtpreempt for preempt-rt.</p></div>
<div class="paragraph"><p>Next pick the type of computer you have: binary-amd64 for any 64-bit x86,
binary-i386 for 32 bit, binary-armhf for RaspBerry Pi.</p></div>
<div class="paragraph"><p>Next pick the version you want from the bottom of the list like
<em>linuxcnc-uspace_2.8.0_amd64.deb</em>. (choose the latest by date)
Download the deb and copy it to your home directory. You can rename the
file to something a bit shorter with the file manager like
<em>linuxcnc_2.8.0.deb</em> then open a terminal and install it with the
package manager with this command:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>sudo dpkg -i linuxcnc_2.8.0.deb</code></pre>
</div></div>
</div>
</div>
<div class="sect1">
<h2 id="_updating_configuration_files_for_2_8_x">3. Updating Configuration Files (for 2.8.x)</h2>
<div class="sectionbody">
<div class="paragraph"><p>The new version of LinuxCNC differs from version 2.7 in some ways that
may require changes to your machine configuration.</p></div>
<div class="paragraph"><p>The main difference is that LinuxCNC no longer makes any assumptions about
which joint controls which axis. This change is generally termed
"joints-axes" after the name of the development branch where the changes
started.
This change has been in development since at least 2010, and has finally
been merged.</p></div>
<div class="sect2">
<h3 id="_distribution_configurations_updates_for_joints_axes">3.1. Distribution Configurations (updates for joints_axes)</h3>
<div class="paragraph"><p>The LinuxCNC distribution includes many example configurations organized in
directory hierarchies named: by_machine, by_interface, and sim (simulated
machines).  These configurations are often used as starting points for making a
new configuration, as examples for study, or as complete simulated machines that
can run without special hardware or real-time kernels.</p></div>
<div class="paragraph"><p>The configuration files in these directory trees have been updated for the
changes required for the joints_axes updates.</p></div>
</div>
<div class="sect2">
<h3 id="_automatic_updates_update_ini_script_for_joints_axes">3.2. Automatic updates (update_ini script for joints_axes)</h3>
<div class="paragraph"><p>Since the joints_axes updates require a number of changes to user ini files and
their related halfiles, a script named update_ini is provided to automatically
convert user configurations.</p></div>
<div class="paragraph"><p>This script is invoked when a user starts an existing configuration for the
first time after updating LinuxCNC.  The script searches the user ini file for
a [EMC]VERSION item.   If this item 1) does not exist, or 2) exists and is set
to the historical CVS value "$Revision$", or is a numerical value less than
1.1, then the update_ini script will popup a dialog to offer to edit the user
files to create an updated configuration.  If the user accepts, the
configuration will be updated.</p></div>
<div class="paragraph"><p>For example, if the user configuration is named bigmill.ini, the bigmill.ini file
and its local associated hal files will be edited to incorporate joints_axes
changes.  All files of the initial configuration will be saved in a new directory
named after the original configuration with a ".old" suffix (bigmill.old in the
example).</p></div>
<div class="paragraph"><p>The update_ini script handles all common user items that are found in basic
machines employing identity kinematics.  Less common items used in more complex
machines may not be converted automatically.  Examples of complex machine
configurations include:</p></div>
<div class="ulist"><ul>
<li>
<p>
gantries with two joints for an axis
</p>
</li>
<li>
<p>
machines with jogwheels
</p>
</li>
<li>
<p>
robots with non-identity kinematics
</p>
</li>
<li>
<p>
configurations using haltcl files
</p>
</li>
</ul></div>
<div class="paragraph"><p>The following subsections and the section for <em>Hal Changes</em> list items that
may require additional user edits to ini or hal files.</p></div>
</div>
<div class="sect2">
<h3 id="_multiple_spindle_support">3.3. Multiple Spindle Support</h3>
<div class="paragraph"><p>LinuxCNC now supports up to 8 spindles (and can be recompiled for more)
Existing G-code will run without modification and most configurations
will default to single spindles. To specify more than one spindle
set the [TRAJ]SPINDLES= entry in the INI file <strong>and</strong> include the num_spindles=
parameter for the motion module (set with either [EMCMOT]EMCMOT = motmod num_spindles=
or included in a halfile loadrt entry for motmod).</p></div>
<div class="paragraph"><p>The motion module num_spindles= parameter and the [TRAJ]SPINDLES= settings
<strong>must</strong> match.</p></div>
<div class="paragraph"><p>The spindle control pin names have been changed to make spindles look
more like axes and joints. motion.spindle-speed-out is now spindle.0.speed-out
for example. The automatic update script will take care of these changes.
To control extra spindles the G and M-codes which control spindle speed
now accept an additional "$" argument, for example M3 $2 to start the
third spindle. "$" was chosen to avoid clashes with any existing code
letters. It should be possible to create custom G-codes to match any
other multi-spindle controller.
See the G-code and M-code manuals for code changes, and man motion for
the HAL pin changes.</p></div>
</div>
<div class="sect2">
<h3 id="_traj_velocities_accelerations_names">3.4. TRAJ velocities, accelerations names</h3>
<div class="paragraph"><p>With incorporation of joints_axes functionality, some names were
changed to clarify available functionality.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>was: [TRAJ]MAX_VELOCITY         is: [TRAJ]MAX_LINEAR_VELOCITY
was: [TRAJ]DEFAULT_VELOCITY     is: [TRAJ]DEFAULT_LINEAR_VELOCITY

was: [TRAJ]MAX_ACCELERATION     is: [TRAJ]MAX_LINEAR_ACCELERATION
was: [TRAJ]DEFAULT_ACCELERATION is: [TRAJ]DEFAULT_LINEAR_ACCELERATION</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_kinematics_modules">3.5. Kinematics modules</h3>
<div class="paragraph"><p>The gentrivkins and gantrykins kinematics modules have been removed as their
functionality is now available in the updated trivkins module.</p></div>
<div class="paragraph"><p>The gentrivkins module has only been available in prior joints_axes
branches.  To convert, it is necessary to change the name.</p></div>
<div class="paragraph"><p>Hal file examples:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>was: loadrt gentrivkins
 is: loadrt trivkins

was: loadrt gentrivkins coordinates=xyyz
 is: loadrt trivkins    coordinates=xyyz</code></pre>
</div></div>
<div class="paragraph"><p>Configurations using gantrykins should be updated to use trivkins with the
kinstype= parameter set to BOTH (for KINEMATICS_BOTH).</p></div>
<div class="paragraph"><p>Hal file example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>was: loadrt gantrykins coordinates=xyyz
 is: loadrt trivkins   coordinates=xyyz kinstype=BOTH</code></pre>
</div></div>
<div class="paragraph"><p>See the trivkins man page for additional information (<em>$ man trivkins</em>)</p></div>
<div class="paragraph"><p>Note: the most supported usage for specifying kinematics in joints_axes
is to set values in the configuration ini file [KINS} section and then
reference them within the specified [HAL]HALFILES ( .hal .tcl files).  For
example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>inifile:    [KINS]
            KINEMATICS = trivkins
            JOINTS = 3
            ...

halfile:    loadrt [KINS]KINEMATICS

haltclfile: loadrt $::KINS(KINEMATICS)</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_lathe_configurations">3.6. Lathe Configurations</h3>
<div class="paragraph"><p>Prior to joints_axes incorporation, lathes were often configured as if they
were three axis (XYZ) machines with an unused axis (Y).  This was convenient
for sharing Hal files (especially for simulation configs) but required
specification of [TRAJ]AXES =3, a <em>dummy</em> AXIS_Y section, and provisions for
homing the unused Y coordinate.  These arrangements are no longer required
or recommended.</p></div>
<div class="paragraph"><p>Historical lathe configurations used the default options for the trivkins
kinematics module.  These default options configure all axis letters
(XYZABCUVW).  With joints_axes incorporation, a more appropriate kinematics
specification sets the coordinates to the exact ones used (XZ) and sets the
number of joints accordingly to 2.  There is no need for an ini file [AXIS_Y]
section and only two [JOINT_N] sections need be defined.</p></div>
<div class="paragraph"><p>Example ini file items for a lathe (only sections relevant to kinematics
are shown):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[KINS]
KINEMATICS = trivkins coordinates=xz
JOINTS = 2

[TRAJ]
COORDINATES = XZ
...

[AXIS_X]
...

[AXIS_Z]
...

[JOINT_0]
...

[JOINT_1]
...</code></pre>
</div></div>
<div class="paragraph"><p>Note that some simulation configurations may still use the historical lathe
configuration precedents.</p></div>
</div>
<div class="sect2">
<h3 id="_consistent_joints_axes_specifications">3.7. Consistent Joints/Axes specifications</h3>
<div class="paragraph"><p>Ini file items that affect joints and axes usage must be consistent.</p></div>
<div class="paragraph"><p>The motion kinematics module typically loaded with <em>[KINS]KINEMATICS=</em> must
use a number of joints equal to the number specified with <em>[KINS]JOINTS=</em>.</p></div>
<div class="paragraph"><p>The kinematics module must implement axis letters that are consistent with the
specification used by the task module item <em>[TRAJ]COORDINATES=</em>.</p></div>
<div class="paragraph"><p>Examples:</p></div>
<div class="paragraph"><p>Three axis Cartesian machine using trivkins (KINEMATICS_IDENTITY):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>  [KINS]KINEMATICS  = trivkins
  [KINS]JOINTS      = 3
  [TRAJ]COORDINATES = XYZ</code></pre>
</div></div>
<div class="paragraph"><p>Two axis lathe using trivkins (KINEMATICS_IDENTITY) with non-consecutive
axis letters:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>  [KINS]KINEMATICS  = trivkins coordinates=XZ
  [KINS]JOINTS      = 2
  [TRAJ]COORDINATES = XZ</code></pre>
</div></div>
<div class="paragraph"><p>Gantry using trivkins with duplicated axis letters and KINEMATICS_BOTH to
allow individual joint positioning (for homing):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>  [KINS]KINEMATICS  = trivkins coordinates=XYYZ kinstype=BOTH
  [KINS]JOINTS      = 4
  [TRAJ]COORDINATES = XYYZ</code></pre>
</div></div>
<div class="paragraph"><p>Gantry using trivkins (KINEMATICS_BOTH) with duplicated axis letters
and a rotary axis with skipped axis letters (A,B skipped):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>  [KINS]KINEMATICS  = trivkins coordinates=XYYZC kinstype=BOTH
  [KINS]JOINTS      = 5
  [TRAJ]COORDINATES = XYYZC</code></pre>
</div></div>
<div class="paragraph"><p>Linear Delta Robot with non-identity kins (KINEMATICS_BOTH) working in Cartesian frame
with an additional rotary coordinate:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>  [KINS]KINEMATICS  = lineardeltakins
  [KINS]JOINTS      = 4
  [TRAJ]COORDINATES = XYZA</code></pre>
</div></div>
<div class="paragraph"><p>Note: Some general-purpose kinematics modules (like trivkins) implement
      identity kinematics with support for coordinate specification (axis letters).
      Axis letters may be omitted.  Axis letters may be duplicated.
      Joints are assigned to axis letters in a defined manner (<em>$ man trivkins</em>).</p></div>
<div class="paragraph"><p>Note: For trivkins module loading, do not include spaces about the = sign or letters:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>This:     [KINS]KINEMATICS = trivkins coordinates=XZ
NOT This: [KINS]KINEMATICS = trivkins coordinates = X Z</code></pre>
</div></div>
<div class="paragraph"><p>Note: Custom kinematics modules that implement non-identity kinematics (like
      lineardeltakins) define machine-specific relationships between a set
      of coordinates and a set of joints.  Typically, custom kinematics modules
      compute the joints-axes relationships within the custom module but it is
      important to use consistent settings for the related ini items: <em>[KINS]JOINTS</em>
      and <em>[TRAJ]COORDINATES</em>.  The details will usually be explained in the
      module man page (for example, <em>$ man lineardeltakins</em>).</p></div>
</div>
<div class="sect2">
<h3 id="_home_sequences">3.8. Home sequences</h3>
<div class="paragraph"><p><strong>Negative</strong> values may be used for the ini file items
named [JOINT_n]HOME_SEQUENCE.  Prior to joints_axes incorporation a value
of -1 or the ommission of the item indicated no sequence was applicable.
Now, only omission of the item is used for that purpose.
See the chapter: <a href="../config/ini-homing.html#cha:homing-configuration"><em>Homing Configuration</em></a>
for more information.</p></div>
</div>
<div class="sect2">
<h3 id="_locking_rotary_indexer_updates_for_joints_axes">3.9. Locking rotary indexer (updates for joints_axes)</h3>
<div class="paragraph"><p>With joints_axes, an indexer is a joint that can be homed (joint mode)
but must also be unlocked from gcode.  This requires a one-to-one
correspondence between a single joint and an axis.</p></div>
<div class="paragraph"><p>Specify the joint number that corresponds to a rotary axis (L = A,B, or C)
with an ini file setting for the axis:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>  [AXIS_L]LOCKING_INDEXER_JOINT = joint_number_for_indexer</code></pre>
</div></div>
<div class="paragraph"><p>Specify that the joint is a locking indexer with an ini file setting
for the joint (N is the joint_number_for_indexer):</p></div>
<div class="listingblock">
<div class="content">
<pre><code>  [JOINT_N]LOCKING_INDEXER = 1</code></pre>
</div></div>
<div class="paragraph"><p>Hal pins can be created to coordinate use of a locking indicator joint:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>   joint.N.unlock      (BIT output from Hal)
   joint.N.is-unlocked (BIT input  to   Hal)</code></pre>
</div></div>
<div class="paragraph"><p>To create these hal pins for locking joints, specify all joints that
are used as locking indexers with the <em>unlock_joints_mask</em> parameter for
the motmod module.  (bit0(LSB)==&gt;joint0, bit1==&gt;joint1, etc.)</p></div>
<div class="listingblock">
<div class="content">
<pre><code>  [EMCMOT]
  EMCMOT = motmod unlock_joints_mask=BITMASK</code></pre>
</div></div>
<div class="paragraph"><p>As an example, consider a machine using trivkins kinematics with coordinates
XYZB where B is a locking indexer.  For trivkins, joint numbers (starting
with 0) are assigned consecutively to the coordinates specified (axis
coordinate letters may be omitted).  For this example, X==&gt;joint0, Y==&gt;joint1,
Z==&gt;joint2, B==&gt;joint3.  The mask to specify joint 3 is 000001000 (binary) ==
0x08 (hexadecimal)</p></div>
<div class="paragraph"><p>The required ini file entries for this trivkins XYZB example are:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>  [KINS]
  JOINTS = 4
  KINEMATICS = trivkins coordinates=XYZB
  ...

  [TRAJ]
  COORDINATES = XYZB
  ...

  [EMCMOT]
  EMCMOT = motmod unlock_joints_mask=0x08
  ...

  [AXIS_B]
  LOCKING_INDEXER_JOINT = 3
  ...

  [JOINT_3]
  LOCKING_INDEXER = 1
  ...</code></pre>
</div></div>
<div class="paragraph"><p>For more complex kinematics, select the joint number as required&#8201;&#8212;&#8201;there must
be a one-to-one correspondence between the rotary axis and the joint number.</p></div>
<div class="paragraph"><p>(See the motion man page (<em>$ man motion</em>) for more information on motmod)</p></div>
</div>
<div class="sect2">
<h3 id="_stricter_ini_file_syntax">3.10. Stricter INI file syntax</h3>
<div class="paragraph"><p>Lines with numeric INI variables are no longer allowed to have trailing
text.  In earlier versions of LinuxCNC any text after the number was
silently ignored, but as of this version such text is totally disallowed.
This includes hash characters ("#"), which in this position are a part
of the value, not a comment character.</p></div>
<div class="paragraph"><p>For example, lines like this will no longer be accepted:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>MAX_VELOCITY = 7.5 # This is the max velocity of the axis.</code></pre>
</div></div>
<div class="paragraph"><p>They could be transformed into pairs of lines like this:</p></div>
<div class="listingblock">
<div class="content">
<pre><code># This is the max velocity of the axis.
MAX_VELOCITY = 7.5</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_traj_settings">3.11. [TRAJ] settings</h3>
<div class="paragraph"><p>In 2.7.x versions, trajectory planning ([TRAJ]) settings included:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[TRAJ]
DEFAULT_ACCELERATION
MAX_ACCELERATION</code></pre>
</div></div>
<div class="paragraph"><p>Interim work prepared for distinct linear and angular items by
renaming these items as:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[TRAJ]
DEFAULT_LINEAR_ACCEL
MAX_LINEAR_ACCEL</code></pre>
</div></div>
<div class="paragraph"><p>As these abbreviated names were inconsistent with other name
conventions and the implementation of the update_ini script,
the interim naming has been corrected to use:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[TRAJ]
DEFAULT_LINEAR_ACCELERATION
MAX_LINEAR_ACCELERATION</code></pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Support for specifying trajectory planning angular default and maximum
accelerations has not been implemented.</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hal_changes_updates_for_joints_axes_2_8_x">4. Hal Changes (updates for joints_axes 2.8.x)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_wheel_or_mpg_manual_pulse_generator_jogging">4.1. Wheel or MPG (manual pulse generator) jogging</h3>
<div class="paragraph"><p>Prior to incorporation of joints_axes updates, wheel jogging was
supported in joint mode only and controlled with hal pins:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>   bit   IN  axis.M.jog-enable
   float IN  axis.M.jog-scale
   s32   IN  axis.M.jog-counts
   bit   IN  axis.M.jog-vel-mode</code></pre>
</div></div>
<div class="paragraph"><p>where <em>M</em> is a number corresponding to an axis letter (0==&gt;X, 1==&gt;Y, etc.)</p></div>
<div class="paragraph"><p>With incorporation of joints_axes updates, wheel jogging is available
for joints in joint mode and for each axis coordinate in teleop mode.  The
controlling hal pins provided are:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>   bit   IN  joint.N.jog-enable
   float IN  joint.N.jog-scale
   s32   IN  joint.N.jog-counts
   bit   IN  joint.N.jog-vel-mode

   bit   IN  axis.L.jog-enable
   float IN  axis.L.jog-scale
   s32   IN  axis.L.jog-counts
   bit   IN  axis.L.jog-vel-mode</code></pre>
</div></div>
<div class="paragraph"><p>where <em>N</em> is a joint number and <em>L</em> is an axis letter.</p></div>
<div class="paragraph"><p>To use an MPG in identity kins configurations where there is a one-to-one
correspondence of a joint number and an axis letter, it may be convenient to
connect the corresponding hal pins.  For example, if joint 1 corresponds
exactly to axis letter y:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>   net jora_1_y_enable   =&gt; joint.1.jog-enable =&gt; axis.y.jog-enable
   net jora_1_y_scale    =&gt; joint.1.jog-scale  =&gt; axis.y.jog-scale
   net jora_1_y_counts   =&gt; joint.1.jog-counts =&gt; axis.y.jog-counts
   net jora_1_y_vel-mode =&gt; joint.1.jog-counts =&gt; axis.y.jog-vel-mode</code></pre>
</div></div>
<div class="paragraph"><p>(The signal names jora_1_y_* are examples, names prior to conversion
for joints_axes will depend upon the specific configuration details.)</p></div>
<div class="paragraph"><p>Configurations with non-identity kinematics and configurations that use
duplicated axis letters (for example, gantries using more than one joint for an
axis coordinate) will require appropriate independent control logic to support
both joint and teleop (world) jogging.</p></div>
</div>
<div class="sect2">
<h3 id="_ini_hal_pins">4.2. Ini Hal pins</h3>
<div class="paragraph"><p>Hal pins are created for ini file items for both joints ([JOINT_N] stanzas)
and axes ([AXIS_L] stanzas):</p></div>
<div class="literalblock">
<div class="content">
<pre><code>For N = 0 ... [KINS](JOINTS -1)
Ini File Item              hal pin name
[JOINT_N]BACKLASH          ini.N.backlash
[JOINT_N]FERROR            ini.N.ferror
[JOINT_N]MIN_FERROR        ini.N.min_ferror
[JOINT_N]MIN_LIMIT         ini.N.min_limit
[JOINT_N]MAX_LIMIT         ini.N.max_limit
[JOINT_N]MAX_VELOCITY      ini.N.max_velocity
[JOINT_N]MAX_ACCELERATION  ini.N.max_acceleration
[JOINT_N]HOME              ini.N.home
[JOINT_N]HOME_OFFSET       ini.N.home_offset</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>For L = x y z a b c u v w:
Ini File Item              hal pin name
[AXIS_L]MIN_LIMIT          ini.L.min_limit
[AXIS_L]MAX_LIMIT          ini.L.max_limit
[AXIS_L]MAX_VELOCITY       ini.L.max_velocity
[AXIS_L]MAX_ACCELERATION   ini.L.max_acceleration</code></pre>
</div></div>
<div class="paragraph"><p>Note: In prior versions of LinuxCNC (before joints_axes updates), the
      hal pin names <em>ini.N.*</em> referred to axes with 0==&gt;x, 1==&gt;y, etc.
      (pins were created for all 9 axes)
      See the man page (<em>$ man milltask</em>) for more information</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hal_changes_other_2_8_x">5. Hal Changes (Other 2.8.x)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_halcompile">5.1. halcompile</h3>
<div class="paragraph"><p>The number of names= instances was formerly limited to 16.  Now,
for realtime components (loadrt) the instances are assigned
dynamically with no built-in limit.  The limit of 16 still
applies to names= items for userspace (loadusr) components.</p></div>
<div class="paragraph"><p>For components using <em>personality</em>, the maximum number is now
settable by a command line option -P|--personalities.</p></div>
</div>
<div class="sect2">
<h3 id="_parameter_to_pin_changes">5.2. Parameter to Pin changes</h3>
<div class="paragraph"><p>The following hal output pins were changed from parameters to pins
so that they can be connected to signals:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>   motion.servo.last-period    (servo last period in clks)
   motion.servo.last-period_ns (kernel-dependent availability)</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_interface_changes_for_joints_axes_2_8_x">6. Interface changes for joints_axes 2.8.x</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_python_linuxcnc_module">6.1. python linuxcnc module</h3>
<div class="paragraph"><p>The jog() interface includes a <em>joint-flag</em> to specify joint (True)
or teleop (False) jogging:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>jog(command, joint-flag, axis-or-joint-number, velocity[, distance]])

jog(linuxcnc.JOG_STOP, joint-flag, axis-or-joint-number)
jog(linuxcnc.JOG_CONTINUOUS, joint-flag, joint-flag, velocity)
jog(linuxcnc.JOG_INCREMENT, joint-flag, axis-or-joint-number, velocity, distance)</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_guis_updates_for_joints_axes_2_8_x">7. GUIs (updates for joints_axes 2.8.x)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_notes_on_joint_axis_jogging_homing_and_kinematics">7.1. Notes on joint/axis jogging, homing, and kinematics</h3>
<div class="paragraph"><p>With incorporation of joints_axes updates, LinuxCNC enforces the
distinctions of joints and axes (coordinate letters)&#8201;&#8212;&#8201;but some
guis (like the axis gui) may hide some of the distinctions for
simple machines.</p></div>
<div class="paragraph"><p>In most cases, you can think of joints as <em>motors</em>.</p></div>
<div class="paragraph"><p>The relationships between joints and axis coordinates are
determined by the mathmatical kinematics functions that describe a
machine&#8217;s motion.</p></div>
<div class="paragraph"><p>World coordinates (X,Y,Z,A,B,C,U,V,W) are determined by applying
<em>FORWARD</em> kinematics operations to joint (motor) positions.</p></div>
<div class="paragraph"><p>When moving in world space (e.g., gcode movements) the required
joint (motor) positions are determined by applying <em>INVERSE</em>
kinematics operations to the coordinates requested for motion
in world space.</p></div>
<div class="paragraph"><p>Moving in world space is possible only <em>after</em> homing.</p></div>
<div class="paragraph"><p>For simple machines (like mills and lathes) there is a one-to-one
equivalence of joints and axis coordinate letters.  For example,
on an XYZ mill, the relationships are typically: axisX==joint0,
axisY==joint1, axisZ=joint2.  This correspondence is
characterized as <em>IDENTITY</em> kinematics  and the kinematics module
used is usually trivkins (trivial kinematics).  (See the trivkins
man page <em>$ man trivkins</em>)</p></div>
<div class="paragraph"><p>Joint jogging (by joint number 0,1,&#8230;) is used in joint mode
(usually used only <em>BEFORE</em> homing).  When homing is completed,
the jogging mode is <em>AUTOMATICALLY</em> switched from joint mode to
world mode and axis jogging (coordinate letter X,Y,&#8230;) is used.
This is appropriate for all gcode moves requested by MDI commands
or by gcode programs.</p></div>
<div class="paragraph"><p>Although jogging in joint mode is often never required after
homing, some guis (like axis) provide a keyboard shortcut (<em>$</em>)
to allow toggling between joint and world (teleop) modes for
machines that use <em>non-IDENTITY</em> kinematics.</p></div>
<div class="paragraph"><p>In many common situations, joint jogging is never needed since
homing is accomplished using home switches and/or the various homing
methods provided by LinuxCNC.  One simply turns on
the machine, issues the Home-All command, the machine homes and
changes to world mode automatically. See
<a href="../config/ini-homing.html#cha:homing-configuration">Homing Configuration</a></p></div>
<div class="paragraph"><p>Machines that do not use home switches may require manual jogging
in joint mode before homing each and every joint.  It is also
possible to use immediate homing (see the homing docs) for joints
that do not require homing to a fixed position.</p></div>
<div class="paragraph"><p>Although a gui may hide joints/axes distinctions for <em>IDENTITY</em>
kinematics machines, it is usually important to complete homing
in order to run programs or use features provided by a gui.</p></div>
<div class="paragraph"><p>By default, the trivkins module declares itself as having
<em>IDENTITY</em> kinematics.  The distinctions of joint/world
operations can be made visible in the axis gui when using
trivkins by setting the kinemetics type to a <em>non-IDENTITY</em> type
using <em>kinstype=both</em>.   The <em>both</em> setting indicates that both
forward and inverse kinematics functions are available and gui
provisions that hide the distinctions of joints and axis letters
should not be employed.  For example, for an xyz configuration,
specify:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[KINS]
KINEMATICS = trivkins coordinates=xyz kinstype=both</code></pre>
</div></div>
<div class="paragraph"><p>With this setting, identity kinematics will be used but the axis
gui will:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
show joint numbers prior to homing
</p>
</li>
<li>
<p>
show axis letters after successful homing
</p>
</li>
<li>
<p>
support toggling between joint and teleop modes with the <em>$</em> key
</p>
</li>
</ol></div>
</div>
<div class="sect2">
<h3 id="_halui">7.2. Halui</h3>
<div class="paragraph"><p>Halui now supports teleop jogging resulting in some changed pin names and
numerous new names for jogging-related pins.</p></div>
<div class="paragraph"><p>See the man page (<em>$ man halui</em>) for all pin names.</p></div>
<div class="sect3">
<h4 id="_teleop_jogging_also_called_axis_or_world_jogging">7.2.1. TELEOP jogging (also called axis or world jogging)</h4>
<div class="paragraph"><p>New pins for teleop jogging are:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>      new: halui.axis.jog-speed
      new: halui.axis.jog-deadband

      new: halui.axis.L.plus
      new: halui.axis.L.minus
           ... etc.</code></pre>
</div></div>
<div class="paragraph"><p>where <em>L</em> is a letter corresponding to one of the axis letters specified by
[TRAJ]COORDINATES or <em>selected</em> for the axis selected by the
halui.axis.L.select pins.</p></div>
</div>
<div class="sect3">
<h4 id="_joint_jogging">7.2.2. Joint jogging</h4>
<div class="paragraph"><p>All pins for joint jogging were renamed for specificity:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>      was: halui.jog-speed          is: halui.joint.jog-speed
      was: halui.jog-deadband       is: halui.joint.jog-deadband

      was: halui.jog.N.plus         is: halui.joint.N.plus
      was: halui.jog.N.minus        is: halui.joint.N.minus
           ...  etc.                    ... etc.</code></pre>
</div></div>
<div class="paragraph"><p>where <em>N</em> is a joint number (0 &#8230; num_noints-1) or <em>selected</em>
for the joint selected by the halui.joint.N.select pins.</p></div>
</div>
<div class="sect3">
<h4 id="_aditional_pin_renames">7.2.3. Aditional pin renames</h4>
<div class="paragraph"><p>The hal pins for <em>selected</em> joints were renamed for consistency
with related pins.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>      was: halui.joint.selected.is_homed
       is: halui.joint.selected.is-homed

      was: halui.joint.selected.on-soft-limit
       is: halui.joint.selected.on-soft-min-limit</code></pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_axis_gui">7.3. AXIS GUI</h3>
<div class="sect3">
<h4 id="_identity_kinematics">7.3.1. Identity Kinematics</h4>
<div class="paragraph"><p>The axis gui continues to support identity kinematics configurations.  This gui
hides the distinctions of axes and joints in order to simplify the display and
usage of simple machines.</p></div>
</div>
<div class="sect3">
<h4 id="_special_case_kinematics">7.3.2. Special case kinematics</h4>
<div class="paragraph"><p>Some machines, typically gantrys, may use a configuration with more than
one joint assigned to an axis letter.  This can be done with the trivkins
kinematics module using repeated coordinate letters.  For example, a
machine configured with ini settings:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[KINS]
KINEMATICS = trivkins coordinates=XYYZ kinstype=BOTH
...
[TRAJ]
COORDINATES = XYYZ
...</code></pre>
</div></div>
<div class="paragraph"><p>This machine, after homing, has a one-to-one correspondence between a single
axis letter (Y) and a pair of joints (1,2).  Using <em>kinematics=BOTH</em> allows
control of individual joints in joint mode <em>if/when required</em>.</p></div>
</div>
<div class="sect3">
<h4 id="_non_identity_kinematics">7.3.3. Non-identity kinematics</h4>
<div class="paragraph"><p>The axis gui supports configurations using non-identity kinematics with:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Key binding (<em>$</em>) to toggle joint or teleop mode
</p>
</li>
<li>
<p>
Preview Tab display of joints or axes according to joint or teleop mode
</p>
</li>
<li>
<p>
Preview Tab display of <em>Home</em> and <em>Limit</em> icons in joint mode
</p>
</li>
<li>
<p>
Preview Tab display of <em>All-homed</em> and 'Any-limit icons in teleop mode
</p>
</li>
<li>
<p>
DRO Tab display of joint or axes according to joint or teleop mode
</p>
</li>
<li>
<p>
Jogging is supported in both joint and teleop motion modes
</p>
</li>
<li>
<p>
External changes to the joint/teleop motion mode are detected.
</p>
</li>
</ol></div>
</div>
<div class="sect3">
<h4 id="_home_icons">7.3.4. Home icons</h4>
<div class="paragraph"><p>For identity kinematics, <em>Home</em> icons are shown for the correspoinding
(one-to-one) axis letter when a joint is homed.</p></div>
<div class="paragraph"><p>For non-identity kinematics, <em>Home</em> icons are shown for individual joints when
a joint is homed in joint display mode.  An <em>All-homed</em> icon is displayed for
all axis letters when ALL joints are homed in world display mode.</p></div>
</div>
<div class="sect3">
<h4 id="_limit_icons">7.3.5. Limit icons</h4>
<div class="paragraph"><p>For identity kinematics, <em>Limit</em> icons are shown for the corresponding
(one-to-one) axis letter when a joint limit is active.</p></div>
<div class="paragraph"><p>For non-identity kinematics, <em>Limit</em> icons are shown for individual joints when
the joint limit is active in joint display mode.  An <em>Any-Limit</em> icon is displayed
if any joint is at a limit in teleop display mode.</p></div>
</div>
<div class="sect3">
<h4 id="_key_bindings_for_a_fourth_axis">7.3.6. Key bindings for a fourth axis</h4>
<div class="paragraph"><p>In the AXIS gui, jogging keys are assigned to axes in a configurable
fashion.  For 3-axis machines, XYZA machines, and lathes the default is
the same as in 2.7.  For other machines, the 4 pairs of jogging keys are
assigned to the first 4 axes that exist in the order XYZ ABC UVW.
These assignments can be controlled by new inifile directives in the
<a href="../config/ini-config.html#sec:display-section">[DISPLAY] section of the inifile</a></p></div>
<div class="paragraph"><p>Note that the parameters used for jogging may not be appropriate for both modes
for machines with non-identity kinematics.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_tklinuxcnc">7.4. tklinuxcnc</h3>
<div class="paragraph"><p>The tklinuxcnc gui supports both identity and non-identity kinematics, includes
gui radiobuttons and a key binding (<em>$</em>) for toggling joint and teleop modes.
External changes to joint or teleop motion mode are detected.
Jogging is supported in both joint and teleop motion modes.
Note that the parameters used for jogging may not be appropriate for both modes
for machines with non-identity kinematics.</p></div>
<div class="paragraph"><p>OpenGL is not used by tklinuxcnc so it may be used to isolate problems and
system dependencies that are exposed with more modern guis like axis.</p></div>
<div class="paragraph"><p>The rudimentary backplot gui provided is available for use with identity kinematics
(xyz) machine configurations.</p></div>
<div class="sect3">
<h4 id="_emcsh_commands">7.4.1. emcsh commands</h4>
<div class="paragraph"><p>The code of emcsh.cc provides the set of tcl commands used by tklinuxcnc.  The
commands are available to tcl applications as the tcl package named <em>Linuxcnc</em>.
A number of commands previously required the use of a numeric argument to
specify an axis coordinate (0--&gt;X, 1--&gt;Y, &#8230;, 8--&gt;W).  These commands have
been simplified to use an argument that is just the coordinate letter.</p></div>
<div class="paragraph"><p>Commands now using a coordinate letter argument are:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
emc_pos_offset
</p>
</li>
<li>
<p>
emc_abs_cmd_pos
</p>
</li>
<li>
<p>
emc_abs_act_pos
</p>
</li>
<li>
<p>
emc_rel_cmd_pos
</p>
</li>
<li>
<p>
emc_rel_act_pos
</p>
</li>
<li>
<p>
emc_tool_offset
</p>
</li>
<li>
<p>
emc_probed_pos
</p>
</li>
</ol></div>
</div>
</div>
<div class="sect2">
<h3 id="_touchy">7.5. touchy</h3>
<div class="paragraph"><p>The touchy gui continues to support the identity kinematics configurations
that it supported prior to joints_axes incorporation.  Jogging is done in
teleop mode.</p></div>
</div>
<div class="sect2">
<h3 id="_gscreen">7.6. gscreen</h3>
<div class="paragraph"><p>The gscreen gui continues to support the identity kinematics configurations
that it supported prior to joints_axes incorporation.  Jogging is done in
teleop mode.</p></div>
</div>
<div class="sect2">
<h3 id="_gmoccapy">7.7. gmoccapy</h3>
<div class="paragraph"><p>The gmoccapy gui continues to support the identity kinematics configurations
that it supported prior to joints_axes incorporation.  Jogging is done in
teleop mode.</p></div>
</div>
<div class="sect2">
<h3 id="_code_shuttlexpress_code_driver_renamed_to_code_shuttle_code">7.8. <code>shuttlexpress</code> driver renamed to <code>shuttle</code></h3>
<div class="paragraph"><p>The HAL driver for the Contour Designs ShuttleXpress device has been
renamed from "shuttlexpress" to just "shuttle".  If your hal files include
some variant of "loadusr shuttlexpress", replace "shuttlexpress" with
"shuttle".</p></div>
<div class="paragraph"><p>Support has been added for the ShuttlePRO, a bigger version of the
ShuttleXpress, so the old driver name is no longer accurate.</p></div>
</div>
<div class="sect2">
<h3 id="_linuxcncrsh">7.9. linuxcncrsh</h3>
<div class="paragraph"><p>"Home All" is now supported with the set home subcommand
by using -1 for the joint number</p></div>
<div class="paragraph"><p>The jogging commands have been altered to accomodate both joint (free)
and teleop (world) jogging.</p></div>
<div class="listingblock">
<div class="content">
<pre><code>    was: set jog      joint_number             speed
     is: set jog      joint_number|axis_letter speed

    was: set jog_incr joint_number             speed increment
     is: set jog_incr joint_number|axis_letter speed increment

    was: set jog_stop
     is: set jog_stop joint_number|axis_letter</code></pre>
</div></div>
<div class="paragraph"><p>Note: Test for teleop mode using command: get teleop_enable
      if TELEOP_ENABLE=YES, use axis_letter
      else                  use joint_number</p></div>
<div class="paragraph"><p>Note: Formerly, the command <em>set jog 0 1.234</em> would jog the zeroth
axis (X) with requested speed=1.234 in any mode (free or teleop).
This command now attemps to jog the zeroth joint (Joint0) provided
the mode is free (not teleop).  To jog the X axis, the mode
must be teleop and the corresponding command is: <em>set jog x 1.234</em></p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tools">8. Tools</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_calibration_emccalib_tcl">8.1. Calibration (emccalib.tcl)</h3>
<div class="paragraph"><p>The calibration/tuning tool now supports stanzas:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>[JOINT_N], [AXIS_L], [SPINDLE_S], [TUNE]</code></pre>
</div></div>
<div class="paragraph"><p>where N is a joint number (0 .. ([KINS]JOINTS-1) ),
L is an axis coordinate letter (X,Y,Z,A,B,C,U,V,W),
and S is a spindle number (0 .. 9)</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The number of allowed spindles is 8 but legacy configurations
may include a stanza [SPINDLE_9] unrelated to an actual spindle
number.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The [TUNE] stanza may be used for specifying tunable items
not relevant to the other supported stanzas.</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_obsolete_guis_removed_for_2_8_x">9. Obsolete Guis (removed for 2.8.x)</h2>
<div class="sectionbody">
<div class="paragraph"><p>The guis <em>mini</em>, <em>keystick</em>, and <em>xlinuxcnc</em> have been removed in
conjunction with updates for joints_axes.  All related source code,
examples, and documentation are available in the git repository.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_deprecated_guis_marked_at_2_8_x">10. Deprecated Guis (marked at 2.8.x)</h2>
<div class="sectionbody">
<div class="paragraph"><p>The <em>linuxcnclcd</em> gui is a candidate for removal.
Should this component be removed, all related source code, examples,
and documentation will be available in the git repository.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_simulator_configurations_updates_for_joints_axes_2_8_x">11. Simulator configurations (updates for joints axes 2.8.x)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_pre_joints_axes">11.1. Pre-joints_axes</h3>
<div class="paragraph"><p>Prior to joints_axes incorporation, the halfiles used in sim configs
typically supported a common milling machine&#8201;&#8212;&#8201;a Cartesian system with
trivial kinematics and three axes named <em>X Y Z</em>.  Typical halfile
entries:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[HAL]
HALFILE = core_sim.hal
HALFILE = sim_spindle_encoder.hal
HALFILE = axis_manualtoolchange.hal
HALFILE = simulated_home.hal</code></pre>
</div></div>
<div class="paragraph"><p>Lathe configs often shared the same halfiles and used the expedient
method of specifying 3 axes with <em>Y</em> unused.  More complex sim configs
provided specific sets of halfiles according to the configuration
purpose.</p></div>
</div>
<div class="sect2">
<h3 id="_post_joints_axes">11.2. Post-joints_axes</h3>
<div class="paragraph"><p>With the incorporation of joints_axes functionality, many sims provided
in the distribution now take advantage of a general purpose halfile that
supports numerous configurations automatically.  A typical sim config
HALFILE specification is:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[HAL]
HALFILE = LIB:basic_sim.tcl</code></pre>
</div></div>
<div class="paragraph"><p>The basic_sim.tcl HALFILE supports a number of commonly required
functions for any number of joints as specified by:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[KINS]
...
JOINTS = number_of_joints
...</code></pre>
</div></div>
<div class="paragraph"><p>Functions supported include:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<em>ddts</em>&#8201;&#8212;&#8201;differentiator hal components are loaded and connected
for each joint (and xy, xyz for trivkins machines)
</p>
</li>
<li>
<p>
<em>simulated_home</em>&#8201;&#8212;&#8201;a sim_home_switch hal component is loaded and
connected for each joint.  The homing conditions are specified by the
usual [JOINT_n]HOME_* ini file items.
</p>
</li>
<li>
<p>
<em>use_hal_manualtoolchange</em>&#8201;&#8212;&#8201;the user space hal_manualtoolchange
component is loaded and connected.
</p>
</li>
<li>
<p>
<em>sim_spindle</em>&#8201;&#8212;&#8201;the sim_spindle component is loaded and connected to
additional loaded hal components to simulate the inertia of a rotating
spindle mass.
</p>
</li>
</ol></div>
<div class="paragraph"><p>The functions are activated by default but can be excluded using
options: <em>-no_make_ddts</em>, <em>-no_simulated_home</em>, <em>-no_use_hal_manualtoolchange</em>,
<em>-no_sim_spindle</em>.</p></div>
<div class="paragraph"><p>For example, to omit creation of ddts:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>HALFILE = LIB:basic_sim.tcl -no_make_ddts</code></pre>
</div></div>
<div class="paragraph"><p>Omitting one or more of the core functions allows testing without without
the function or addition of new HALFILEs to implement or expand on the
functionality.</p></div>
<div class="sect3">
<h4 id="_equivalent_hal_commands_file">11.2.1. Equivalent Hal commands file</h4>
<div class="paragraph"><p>When LIB:basic_sim.tcl is used, an equivalent halfile is created (in the
configuration directory) to show the halcmd commands issued.   The file
name is based on the name of the inifile with <em>_cmds</em> appended to
the basename and a conventional <em>.hal</em> file extension. Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>inifilename:            example.ini
equivalent_halfilename: example_cmds.hal</code></pre>
</div></div>
<div class="paragraph"><p>The equivalent halfile file supersedes previous instances of files with
the same filename.  Inifile variables substitutions specified in the
inifile and interpreted by halcmd are automatically substituted in the
created halfile.  If there are [HAL]HALFILEs specified before
LIB:basic_sim.tcl, their halcmd commands are included too.</p></div>
<div class="paragraph"><p>The equivalent halfile can be used to create a new configuration based on
the original configuration made with LIB:basic_sim.tcl with the
following steps:</p></div>
<div class="paragraph"><p>1) Run the simulator configuration to create a new equivalent halfile,
for example: <em>example_cmds.hal</em>.</p></div>
<div class="paragraph"><p>To use this new equivalent halfile in the original simulator
configuration inifile (or a copy of it), edit to change:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[HAL]
HALFILE = LIB:basic_sim.tcl other_parameters</code></pre>
</div></div>
<div class="paragraph"><p>to:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>[HAL]
HALFILE = ./example_cmds.hal</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_notes">11.2.2. Notes</h4>
<div class="paragraph"><p>All components and connections made by LIB:basic_sim.tcl can be viewed
using halcmd.  The entire hal configuration (except for userspace
components loaded with loadusr) can be saved to a file using:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>$ halcmd save &gt; hal.save</code></pre>
</div></div>
<div class="paragraph"><p>Use of LIB:basic_sim.tcl reduces the effort needed to make a simulation
config since it handles most of the required component loading and hal
connections.</p></div>
<div class="paragraph"><p>The sim config <em>Sample Configurations/sim/axis/minimal_xyz.ini</em>
demonstrates a working xyz configuration that uses LIB:basic_sim.tcl
with a minimal number of ini file settings.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_miscellaneous_updates_for_2_8_x">12. Miscellaneous updates for 2.8.x</h2>
<div class="sectionbody">
<div class="paragraph"><p>Commits to unreleased branches may make changes that affect testers
and early-adopters of the unreleased software.</p></div>
<div class="sect2">
<h3 id="_motion_pins">12.1. Motion pins</h3>
<div class="paragraph"><p>New pins (see the motion man page for more info):</p></div>
<div class="paragraph"><p>---
axis.L.jog-accel-fraction
joint.N.jog-accel-fraction
---</p></div>
</div>
<div class="sect2">
<h3 id="_hal_pins">12.2. Hal pins</h3>
<div class="paragraph"><p>Name changes:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>was: axis.L.vel-cmd
 is: axis.l.teleop-vel-cmd</code></pre>
</div></div>
<div class="paragraph"><p>New pins:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>motion.homing-inhibit (see motion manpage)</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_hal_component_updates">12.3. Hal component updates</h3>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
siggen: new pin <em>reset</em> to set output signal values to predefined state
</p>
</li>
<li>
<p>
biquad: pins <em>type,f0,Q,s1,s2</em> were formerly params
</p>
</li>
<li>
<p>
userkins: template for user-built kinematics modules using halcompile
</p>
</li>
</ol></div>
</div>
<div class="sect2">
<h3 id="_xhc_hb04_pendant_support">12.4. XHC-HB04 Pendant Support</h3>
<div class="sect3">
<h4 id="_xhc_hb04_util_comp_helper_component">12.4.1. xhc_hb04_util.comp (helper component)</h4>
<div class="paragraph"><p>Remove unused pin <em>jogenable-off</em></p></div>
<div class="paragraph"><p>Add pin <em>amux-enable</em> so that the multiplexed acceleration reductions are now
enabled by the ANDing the pins: <em>is-manual</em> and <em>amux-enable</em>.  These two pins
are  typically connected to <em>halui.mode.is-manual</em> and <em>halui.mode.is-teleop</em>
respectively.</p></div>
</div>
<div class="sect3">
<h4 id="_xhc_hb04_tcl_optional_lib_configuration_halfile">12.4.2. xhc_hb04.tcl (optional LIB configuration halfile)</h4>
<div class="paragraph"><p>Remove signal pendant:jogenable-off for removed pin <em>pendant_util.jogenable-off</em></p></div>
<div class="paragraph"><p>Support new motion pins for reduced accelerations
(axis.L.jog-accel-fraction, joint.N.jog-accel-fraction) for wheel jogging.
The use of [APPLICATIONS]APP=xhc-hb04-accels is no longer supported.
Reduced accels are applied for wheel jogging only (not for nml commands
issued by guis).</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_xhc_whb04b_6_pendant_support">12.5. XHC-WHB04B-6 pendant support</h3>
<div class="paragraph"><p>See the documentation for the xhc-whb04b-6 component.</p></div>
</div>
<div class="sect2">
<h3 id="_bldc3_hall">12.6. bldc3_hall</h3>
<div class="paragraph"><p>The bldc_hall3 component has been removed. The <strong>bldc</strong> component is more
flexible and better tested.</p></div>
</div>
<div class="sect2">
<h3 id="_joint_n_home_sequence_starting_values">12.7. [JOINT_n]HOME_SEQUENCE Starting values</h3>
<div class="paragraph"><p>Starting sequence values may be 0, 1 (or -1) only.  See the
"Homing Configuration" documentation for more information.</p></div>
</div>
<div class="sect2">
<h3 id="_joint_n_home_sequence_negative_values">12.8. [JOINT_n]HOME_SEQUENCE Negative values</h3>
<div class="paragraph"><p>Joints using a negative HOME_SEQUENCE are not allowed to jog in joint
mode in order to prevent misalignment (racking) in common gantry
configurations.  As always, machines with any kinematics type must be
homed prior to enabling conventional world mode jogging.</p></div>
</div>
<div class="sect2">
<h3 id="_twopass_support_for_complex_loadrt_config_items">12.9. TWOPASS support for complex loadrt config= items</h3>
<div class="paragraph"><p>Added twopass support for loadrt config modparams with multiple
settings separated by blanks and enclosed with quotes.  Example:</p></div>
<div class="listingblock">
<div class="content">
<pre><code>loadrt hm2_eth board_ip=10.10.10.10 config="num_encoders=2 num_pwmgens=2 num_stepgens=3"</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_changes_beyond_2_8_x">13. Changes beyond 2.8.x</h2>
<div class="sectionbody">
<div class="paragraph"><p>Future versions of this document will note changes made to the development
branch subsequent to 2.8.x release(s).</p></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2022-11-24 07:38:35 MST
</div>
</div>
</body>
</html>
