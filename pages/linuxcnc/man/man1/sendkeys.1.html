<!-- Creator     : groff version 1.22.4 -->
<!-- CreationDate: Thu Nov 24 19:23:36 2022 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="generator" content="groff -Thtml, see www.gnu.org">
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<meta name="Content-Style" content="text/css">
<style type="text/css">
       p       { margin-top: 0; margin-bottom: 0; vertical-align: top }
       pre     { margin-top: 0; margin-bottom: 0; vertical-align: top }
       table   { margin-top: 0; margin-bottom: 0; vertical-align: top }
       h1      { text-align: center }
</style>
<title>SENDKEYS</title>

 <link rel="stylesheet" href="../../asciidoc.css" type="text/css" /> <link rel="stylesheet" href="../../linuxcnc.css" type="text/css" />
</head>
<body>

<h1 align="center">SENDKEYS</h1>

<a href="#NAME">NAME</a><br>
<a href="#SYNOPSIS">SYNOPSIS</a><br>
<a href="#DESCRIPTION">DESCRIPTION</a><br>
<a href="#PINS">PINS</a><br>
<a href="#PARAMETERS">PARAMETERS</a><br>
<a href="#EXAMPLE">EXAMPLE</a><br>
<a href="#AUTHOR">AUTHOR</a><br>
<a href="#LICENSE">LICENSE</a><br>

<hr>


<h2>NAME
<a name="NAME"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">sendkeys - send
input events based on pins or scancodes from HAL</p>

<h2>SYNOPSIS
<a name="SYNOPSIS"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em"><b>loadusr
sendkeys config=s8t5, 16, t12</b></p>

<h2>DESCRIPTION
<a name="DESCRIPTION"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">This component
is intended as a partner component to matrix_kb or the
hostmot2 7i73 driver. It accepts the key-up and key-down
event codes from either of these and converts them to
keystokes sent from a virtual keyboard.</p>

<p style="margin-left:11%; margin-top: 1em">It also allows
for keystrokes to be generated by individual HAL pins.</p>

<p style="margin-left:11%; margin-top: 1em">The
<b>config</b> parameter to the <b>loadusr</b> HAL command
defines how many scancodes will be supported and how many
individual pins are created. <b>config=s16</b> would support
the 16 scancodes of a 4x4 matrix. <b>config=t10</b> would
create 10 individual HAL pin triggers. <b>config=s16t10</b>
would create one instance with both the above.</p>

<p style="margin-left:11%; margin-top: 1em">Multiple
configs separated by commas will create multiple instances
of the component. The accepted codes can be seen in the
extract from the linux headers here:
http://wiki.linuxcnc.org/cgi-bin/wiki.pl?Scancodes</p>

<p style="margin-left:11%; margin-top: 1em">The component
requires the user to have write permissions to /dev/uinput
which is not available by default. To give access:</p>

<p style="margin-left:11%; margin-top: 1em">Create the
uinput group and add the LinuxCNC user to it:</p>

<p style="margin-left:17%; margin-top: 1em">sudo groupadd
-f uinput <br>
sudo gpasswd -a username uinput</p>

<p style="margin-left:11%; margin-top: 1em">Create a new
entry in .B/etc/udev/rules.d/99-input.rules</p>

<p style="margin-left:17%; margin-top: 1em">sudo echo
KERNEL==&quot;uinput&quot;, GROUP=&quot;uinput&quot;,
MODE:=&quot;0660&quot; | sudo tee
/etc/udev/rules.d/88-input.rules</p>

<p style="margin-left:11%; margin-top: 1em">Then reboot the
machine. You can test that is has worked:</p>

<p style="margin-left:17%; margin-top: 1em">ls -l
/dev/uinput <br>
crw-rw---- 1 root uinput 10, 223 Nov 11 15:35
/dev/uinput</p>

<p style="margin-left:11%; margin-top: 1em">It is possible
to link the 7i73 codes to both the matrix_kb comp and this
comp, so that some codes operate HAL pins and some send
keystrokes. Where the option exists it is <i>MUCH</i> better
to use HAL pins for things like jogging and machine control.
This component should really be used only for text entry and
GUI operations.</p>

<p style="margin-left:11%; margin-top: 1em">Each key on the
matrix is allocated a scan code. The simplest way to
configure the component is to load the component and open a
halmeter showing sendkeys.0.current-event. Note the code for
each physical key. (If keys do not give consistent results
then you probably need to toggle the value of the
matrix_kb.0.negative-logic pin and/or invert io pins).</p>

<p style="margin-left:11%; margin-top: 1em">Then edit the
HAL file to assign a key event to each scancode. For
example:</p>

<p style="margin-left:11%; margin-top: 1em">setp
sendkeys.0.scan-event-21 34</p>

<p style="margin-left:11%; margin-top: 1em">To set a button
to type the letter &quot;G&quot; The key events related to
each physical key need to be set up prior to the component
activating, but after the component is loaded.</p>

<p style="margin-left:11%; margin-top: 1em">To achieve this
there is a pin <b>sendkeys</b>./N/.<b>init</b> which should
be set to &quot;true&quot; once the events to be sent for
each scancode and pin have been set up.</p>

<p style="margin-left:11%; margin-top: 1em">To generate
keystrokes from other sources note that a keydown is simply
0xC0 &amp; keycode and keyup is 0x80 &amp; keycode.</p>

<h2>PINS
<a name="PINS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>sendkeys.N.keycode</b>
u32 in Connect to scancode generator.</p>


<p style="margin-left:11%; margin-top: 1em"><b>sendkeys.N.current-event</b>
s32 out shows the current scancode without keyup / keydown
markers.</p>


<p style="margin-left:11%; margin-top: 1em"><b>sendkeys.N.init</b>
bit in set this pin TRUE once all the event parameters have
been set.</p>

<h2>PARAMETERS
<a name="PARAMETERS"></a>
</h2>



<p style="margin-left:11%; margin-top: 1em"><b>sendkeys.N.scan-event-MM</b>
u32 in assign the uinput event codes associated with each
scancode.</p>


<p style="margin-left:11%; margin-top: 1em"><b>sendkeys.N.pin-event-MM</b>
u32 in assign the uinput codes associated with each HAL bit
pin.</p>

<h2>EXAMPLE
<a name="EXAMPLE"></a>
</h2>


<p style="margin-left:17%; margin-top: 1em">loadusr -W
sendkeys config=16t2 <br>
net scancodes hm2_7i73.0.0.keycode =&gt;
sendkeys.0.keycode</p>

<p style="margin-left:17%; margin-top: 1em">setp
sendkeys.0.scan-event-00 34 # Key G <br>
setp sendkeys.0.scan-event-01 2 # Key 1 <br>
setp sendkeys.0.scan-event-02 3 # Key 2 <br>
setp sendkeys.0.scan-event-03 4 # Key 3 <br>
setp sendkeys.0.scan-event-04 50 # Key M <br>
setp sendkeys.0.scan-event-05 05 # Key 4 <br>
setp sendkeys.0.scan-event-06 06 # Key 5 <br>
setp sendkeys.0.scan-event-07 07 # Key 6 <br>
setp sendkeys.0.scan-event-08 31 # Key S <br>
setp sendkeys.0.scan-event-09 8 # Key 7 <br>
setp sendkeys.0.scan-event-10 9 # Key 8 <br>
setp sendkeys.0.scan-event-11 10 # Key 9 <br>
setp sendkeys.0.scan-event-12 20 # Key T <br>
setp sendkeys.0.scan-event-13 11 # Key 0 <br>
setp sendkeys.0.scan-event-14 52 # Key Dot <br>
setp sendkeys.0.scan-event-15 14 # Backspace <br>
setp sendkeys.0.pin-event-00 29 # Left Ctrl <br>
setp sendkeys.0.pin-event-01 57 # Space <br>
setp sendkeys.0.init 1</p>

<p style="margin-left:17%; margin-top: 1em">#Send Ctl +
Space from one trigger <br>
net clear-errors parport.0.pin.00.in sendkeys.0.trigger-00
sendkeys.0.trigger-01</p>

<h2>AUTHOR
<a name="AUTHOR"></a>
</h2>


<p style="margin-left:11%; margin-top: 1em">andypugh</p>

<h2>LICENSE
<a name="LICENSE"></a>
</h2>

 
<p style="margin-left:11%; margin-top: 1em">GPL-2.0+</p>
<hr>
</body>
</html>
